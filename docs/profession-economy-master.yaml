# =============================================================================
# REALM OF CROWNS — PROFESSION & ECONOMY MASTER REFERENCE
# =============================================================================
# This is the SINGLE SOURCE OF TRUTH for all professions, resources, recipes,
# and their interdependencies. Every agent prompt references this document.
#
# FORMAT: YAML-style structured data optimized for AI dependency tracing.
# To trace a chain: Find any item → check its recipe.inputs → trace each
# input back to its source (gathered or crafted) → repeat until you hit
# a raw gathered resource.
#
# LAST UPDATED: 2026-02-19
# STATUS: All 7 gathering professions formalized and LIVE. RANCHER livestock system LIVE.
# COOK recipes expanded: +3 livestock recipes, +7 fish recipes (3 Journeyman, 4 Craftsman).
# FISHERMAN Craftsman tier LIVE: River Trout (22g), Lake Perch (25g) at fishing spots for L7+.
# TANNER profession LIVE — 15 recipes (3 processing + 12 finished goods), two-step pipeline
# (pelts → leather → goods). HUNTER tiers expanded: Apprentice+Journeyman+Craftsman all LIVE,
# Animal Pelts (L3+), Wolf Pelts + Bear Hides (L7+). Cured Leather shared intermediate for TAILOR.
# Quiver/Ranger's Quiver create TANNER→HUNTER feedback loop (tools boost pelt gatherer).
# Single-town residency LIVE — one free cottage in home town, 500g relocation with 30-day
# cooldown, building construction restricted to home town, remote market listing from storage.
# EQUIPMENT SYSTEM LIVE — 6 slots (WEAPON, OFF_HAND, HEAD, BODY, LEGS, TOOL), dedicated
# TOOL slot separate from weapons, tool yield bonus + bare-hands penalty on gathering,
# equip/unequip free action, computed combat stats, simulation bot tool management.
# BLACKSMITH specializations LIVE — Toolsmith, Weaponsmith, Armorer branches at L7.
# TAILOR profession LIVE — 18 recipes (5 processing + 13 armor), cloth armor with magicResist.
# RANCHER Craftsman tier LIVE: Fine Wool (L7+ Sheep Pen), Silkworm Cocoons (Silkworm House).
# Armor triangle: BLACKSMITH (plate/STR) vs TANNER (leather/DEX) vs TAILOR (cloth/magicResist).
# SIMULATION DIAGNOSTIC (2026-02-18): 8 supply chain fixes applied. make-cloth-padding removed.
# Listing threshold lowered (keep 2), ITEM_TO_SPOT_TYPE expanded, idle=neutral, errors[] populated.
# =============================================================================


# =============================================================================
# SECTION 1: PUBLIC GATHERING SPOTS & RAW RESOURCES
# =============================================================================
# These are the 8 public spot types across 69 towns (after 2026-02-17 redesign).
# Every resource can be gathered by ANY player (no profession req for public spots).
# Gathering professions get TIER-SCALED BONUS YIELD at their specialty spots.
# grain_field, vegetable_patch, berry are now FARMER PRIVATE FIELDS ONLY.
# hunting_ground added as new public spot type (4 towns).
# =============================================================================

gathering_spot_types:

  orchard:
    resource: Apple
    item_id: apple
    category: FOOD
    base_value: 3
    yield: 1-3
    edible: true
    hp_restore: 5
    description: "A crisp, red apple. Eaten raw or used in cooking."
    gather_professions: [FARMER]       # These professions get bonus yield here
    craft_consumers: [COOK, BREWER]    # These professions use this as input
    regions: [Heartlands, Crossroads, Suncoast]

  # berry_thicket: REMOVED as public spot (2026-02-17)
  # Wild Berries now produced by FARMER private fields (berry_field asset, T2)

  herb_garden:
    resource: Wild Herbs
    item_id: wild_herbs
    category: FOOD
    base_value: 5
    yield: 1-2
    edible: true
    hp_restore: 3
    description: "Fragrant wild herbs. Used in cooking, brewing, and alchemy."
    gather_professions: [HERBALIST]
    craft_consumers: [COOK, BREWER, ALCHEMIST]
    regions: [Heartlands, Silverwood, Crossroads, Shadowmere]

  fishing_pond:
    resource: Raw Fish
    item_id: raw_fish
    category: FOOD
    base_value: 4
    yield: 1-3
    edible: true
    hp_restore: 8
    description: "A fresh-caught fish. Better cooked, but edible raw in a pinch."
    gather_professions: [FISHERMAN]
    craft_consumers: [COOK]
    regions: [Crossroads, Shadowmere, Suncoast]
    tiered_resources:  # UPDATED: 2026-02-20
      L3-6: Raw Fish only
      L7-8: { Raw Fish: 30%, River Trout: 35%, Lake Perch: 35% }
    premium_resources:
      river_trout:
        name: River Trout
        item_id: river_trout
        category: MATERIAL
        base_value: 22
        description: "A prized freshwater fish with firm, flavorful flesh."
        min_level: 7
      lake_perch:
        name: Lake Perch
        item_id: lake_perch
        category: MATERIAL
        base_value: 25
        description: "A large, meaty lake fish for fine cuisine."
        min_level: 7

  forest:
    resource: Wood Logs
    item_id: wood_logs
    category: MATERIAL
    base_value: 5
    yield: 1-3
    edible: false
    description: "Rough-cut timber. Used by woodworkers, fletchers, and builders."
    gather_professions: [LUMBERJACK]
    craft_consumers: [WOODWORKER, FLETCHER, MASON, SCRIBE, COOK]
    regions: [Silverwood, Crossroads, Frozen Reaches]

  mine:
    resource: Iron Ore
    item_id: iron_ore
    category: MATERIAL
    base_value: 6
    yield: 1-2
    edible: false
    description: "Raw iron ore. Must be smelted before a blacksmith can work it."
    gather_professions: [MINER]
    craft_consumers: [SMELTER]
    regions: [Ironvault, Ashenfang, Frozen Reaches]

  quarry:
    resource: Stone Blocks
    item_id: stone_blocks
    category: MATERIAL
    base_value: 7
    yield: 1-2
    edible: false
    description: "Rough-hewn stone. Used by masons and builders."
    gather_professions: [MINER]
    craft_consumers: [MASON, JEWELER]
    regions: [Ironvault, Ashenfang, Frozen Reaches]

  clay_pit:
    resource: Clay
    item_id: clay
    category: MATERIAL
    base_value: 4
    yield: 1-3
    edible: false
    description: "Wet clay from the riverbank. Used in pottery, building, and alchemy."
    gather_professions: [MINER]
    craft_consumers: [MASON, ALCHEMIST]
    regions: [Ashenfang, Shadowmere, Suncoast]

  coal_mine:
    resource: Coal
    item_id: coal
    category: MATERIAL
    base_value: 12
    yield: 1-2
    edible: false
    description: "Fuel for steel forging. Mined from private coal mines by MINER L5+."
    gather_professions: [MINER]
    craft_consumers: [BLACKSMITH]
    asset_based: true
    level_required: 5
    status: LIVE

  silver_mine:
    resource: Silver Ore
    item_id: silver_ore
    category: MATERIAL
    base_value: 30
    yield: 1-2
    edible: false
    description: "Precious ore for advanced smithing. Mined from private claims by MINER L7+."
    gather_professions: [MINER]
    craft_consumers: [BLACKSMITH]
    asset_based: true
    level_required: 7
    status: LIVE

  hardwood_grove:
    resource: Hardwood
    item_id: hardwood
    category: MATERIAL
    base_value: 25
    yield: 1-2
    edible: false
    description: "Dense old-growth timber. Harvested from private groves by LUMBERJACK L7+."
    gather_professions: [LUMBERJACK]
    craft_consumers: [BLACKSMITH]
    asset_based: true
    level_required: 7
    status: LIVE

  # --- HERBALIST T3 RESOURCES (L7+ at herb spots, weighted random) ---
  medicinal_herbs:
    resource: Medicinal Herbs
    item_id: medicinal_herbs
    category: MATERIAL
    base_value: 28
    yield: 1-3
    edible: false
    description: "Potent herbs with proven healing properties. Gathered by HERBALIST L7+ at herb spots (35% chance)."
    gather_professions: [HERBALIST]
    craft_consumers: [ALCHEMIST]
    level_required: 7
    status: LIVE

  glowcap_mushrooms:
    resource: Glowcap Mushrooms
    item_id: glowcap_mushrooms
    category: MATERIAL
    base_value: 32
    yield: 1-3
    edible: false
    description: "Luminescent fungi prized by alchemists. Gathered by HERBALIST L7+ at herb spots (35% chance)."
    gather_professions: [HERBALIST]
    craft_consumers: [ALCHEMIST]
    level_required: 7
    status: LIVE

  hunting_ground:
    resource: Wild Game Meat
    item_id: wild_game_meat
    category: FOOD
    base_value: 5
    yield: 1-3
    edible: true
    hp_restore: 8
    description: "Venison, boar, and rabbit harvested from the wilds. Lean and flavorful."
    gather_professions: [HUNTER]
    craft_consumers: [COOK, TANNER]
    regions: [Ironvault, Frozen Reaches, Twilight March]
    towns: [Alehearth, Frostfang, "Harmony Point", "The Crosswinds Inn"]
    status: LIVE  # Added 2026-02-17
    tiered_resources:  # ADDED: HUNTER tiered pelts
      L3-6: "Wild Game Meat only + Animal Pelts (bonus drop)"
      L7-8: { "Wild Game Meat": "40%", "Animal Pelts": "20%", "Wolf Pelts": "20%", "Bear Hides": "20%" }
    premium_resources:
      animal_pelts:
        name: Animal Pelts
        item_id: animal_pelts
        category: MATERIAL
        base_value: 8
        description: "Common animal pelts. Cured into leather by a Tanner."
        min_level: 3
        craft_consumers: [TANNER]
      wolf_pelts:
        name: Wolf Pelts
        item_id: wolf_pelts
        category: MATERIAL
        base_value: 28
        description: "Thick, durable wolf pelts. Prized by Tanners for superior leather."
        min_level: 7
        craft_consumers: [TANNER]
      bear_hides:
        name: Bear Hides
        item_id: bear_hides
        category: MATERIAL
        base_value: 35
        description: "Massive bear hides. Only the most skilled Tanners can work these."
        min_level: 7
        craft_consumers: [TANNER]

  # --- FARMER PRIVATE FIELD ONLY (no public spots) ---
  # grain_field: REMOVED as public spot (2026-02-17). Grain now FARMER-private-field only.
  #   Towns reassigned: Millhaven→orchard, Greenhollow→orchard, Sandrift→fishing
  # vegetable_patch: REMOVED as public spot (2026-02-17). Vegetables now FARMER-private-field only.
  #   Towns reassigned: Whitefield→orchard, Peddler's Rest→orchard


# =============================================================================
# SECTION 2: PLANNED GATHERING SPOTS (NOT YET IMPLEMENTED)
# UPDATED: 2026-02-17 — hunting_ground moved to Section 1 (now live)
# grain_field, vegetable_patch now FARMER private fields only (not public spots)
# =============================================================================
# Remaining spots that still need to be added.
# Priority: Add when implementing the paired crafting profession.
# =============================================================================

planned_gathering_spots:

  pasture:
    status: SUPERSEDED
    note: "TANNER now sources pelts from HUNTER (Animal Pelts, Wolf Pelts, Bear Hides) not RANCHER Raw Hide. Pasture as public spot no longer needed for TANNER."
    original_resource: Raw Hide
    craft_consumers: [TANNER]
    replacement: "HUNTER hunting_ground tiered resources (L3+ Animal Pelts, L7+ Wolf Pelts / Bear Hides)"

  # RANCHER livestock products (auto-produced by animals in daily tick):
  # - Eggs (chicken) → COOK (Scrambled Eggs, Farm Breakfast)
  # - Milk (cow) → COOK (Creamy Porridge, Farm Breakfast)
  # - Wool (sheep) → TAILOR (Woven Cloth → cloth armor)
  # - Fine Wool (sheep L7+) → TAILOR (Fine Cloth → superior cloth armor)
  # - Silkworm Cocoons (silkworm_house) → TAILOR (Silk Fabric → top-tier cloth armor)
  # - Raw Hide → TANNER → LEATHERWORKER (future leather chain)
  # RANCHER buildings: chicken_coop (cap 5), dairy_barn (cap 3), sheep_pen (cap 4), silkworm_house (auto-producer)
  # Livestock require Grain feed every 3 ticks. No feed → hunger → death.

  # hunting_ground: MOVED to Section 1 (2026-02-17) — now LIVE with 4 towns
  #   gather_professions: [HUNTER]
  #   craft_consumers: [COOK, TANNER]
  #   assign_to_regions: [Silverwood, Frozen Reaches]


# =============================================================================
# SECTION 3: PROFESSIONS — FULL REGISTRY
# =============================================================================
# 28 professions: 7 Gathering, 15 Crafting, 6 Service
# Max 3 professions per character.
# Profession unlocks at character Level 3.
# =============================================================================

professions:

  # ---------------------------------------------------------------------------
  # GATHERING PROFESSIONS (7)
  # These DON'T craft. They gather raw resources with bonus yield.
  # ---------------------------------------------------------------------------

  FARMER:
    type: GATHERING
    unlock_level: 3
    description: "Tends crops and orchards. Tier-scaled bonus yield at agricultural gathering spots."
    bonus_spots: [orchard, berry_thicket, grain_field, vegetable_patch]
    tier_unlocks:
      APPRENTICE: { level: "3-4", spots: [grain_field, vegetable_patch], yield_bonus: "+0%" }
      JOURNEYMAN: { level: "5-6", spots: [orchard, berry], yield_bonus: "+25%" }
      CRAFTSMAN: { level: "7-8", spots: [hop_field, vineyard], yield_bonus: "+50%", status: EXISTS_IN_GAME }
      EXPERT: { level: "9-10", spots: [cotton_field, flax_field], yield_bonus: "+75%", status: NOT_YET_IMPLEMENTED }
      MASTER: { level: "11-12", spots: [rare_herb, exotic_fruit], yield_bonus: "+100%", status: NOT_YET_IMPLEMENTED }
      GRANDMASTER: { level: "13+", spots: [legendary_crop, magical_seedling], yield_bonus: "+150%", status: NOT_YET_IMPLEMENTED }
    feeds_into: [COOK, BREWER]
    status: EXISTS_IN_GAME
    notes: "Tier-scaled bonus replaced flat +50%. APPRENTICE/JOURNEYMAN/CRAFTSMAN spots live; EXPERT+ Coming Soon."

  RANCHER:
    type: GATHERING
    unlock_level: 3
    description: "Raises livestock in buildings. Animals auto-produce Eggs, Milk, Wool every 3 ticks if fed Grain."
    asset_based: true
    buildings:
      chicken_coop: { baseCost: 100, levelRequired: 3, capacity: 5, animal: chicken, product: Eggs }
      dairy_barn: { baseCost: 150, levelRequired: 3, capacity: 3, animal: cow, product: Milk }
      sheep_pen: { baseCost: 120, levelRequired: 5, capacity: 4, animal: sheep, product: Wool }
    livestock:
      chicken: { price: 30, maxAge: 120, feedCost: 1, product: Eggs, yield: "1-2" }
      cow: { price: 80, maxAge: 180, feedCost: 2, product: Milk, yield: 1 }
      sheep: { price: 50, maxAge: 150, feedCost: 1, product: Wool, yield: 1 }
    feed_mechanics:
      feed_interval: "every 3 ticks (currentDay % 3 === 0)"
      feed_item: Grain
      hunger_per_miss: 25
      starving_threshold: 50   # Production halved
      death_threshold: 100     # Animal dies
    death_causes: [starvation, old_age, disease, predator]
    random_events:
      disease: { chance: "1%", health_loss: 25 }
      predator: { chance: "0.5%", instant_kill: true }
    tier_unlocks:
      APPRENTICE: { level: "3-4", spots: [chicken_coop, dairy_barn], crops: [Eggs, Milk], assetBased: true }
      JOURNEYMAN: { level: "5-6", spots: [sheep_pen], crops: [Wool], assetBased: true }
      CRAFTSMAN: { level: "7-8", spots: [sheep_pen, silkworm_house], crops: [Wool, "Fine Wool", "Silkworm Cocoons"], assetBased: true }
      EXPERT: { status: NOT_YET_IMPLEMENTED }
      MASTER: { status: NOT_YET_IMPLEMENTED }
      GRANDMASTER: { status: NOT_YET_IMPLEMENTED }
    feeds_into: [TANNER, TAILOR, COOK]
    status: EXISTS_IN_GAME
    craftsman_details:
      fine_wool: "L7+ sheep at Sheep Pen produce Fine Wool alongside regular Wool (bonus product)"
      silkworm_house: { baseCost: 250, levelRequired: 7, product: "Silkworm Cocoons", auto_producing: true, note: "Non-livestock building — no animals to buy/feed. Auto-produces Silkworm Cocoons every 3 ticks." }
    notes: "APPRENTICE + JOURNEYMAN + CRAFTSMAN LIVE. Buildings as OwnedAsset (cropState=READY permanently). Livestock in separate Prisma model. Feed/produce automatic in daily tick Step 4d. Craftsman tier adds Fine Wool (sheep bonus) and Silkworm Cocoons (Silkworm House auto-producer)."

  FISHERMAN:
    type: GATHERING
    unlock_level: 3
    description: "Catches fish from rivers, lakes, and the sea."
    bonus_spots: [fishing_pond]
    tier_unlocks:  # UPDATED: 2026-02-20 — Craftsman tier LIVE
      APPRENTICE: { level: "3-4", spots: [fishing], yield_bonus: "+0%", resources: [Raw Fish] }
      JOURNEYMAN: { level: "5-6", spots: [fishing], yield_bonus: "+25%", resources: [Raw Fish] }
      CRAFTSMAN: { level: "7-8", spots: [fishing], yield_bonus: "+50%", resources: [Raw Fish, River Trout, Lake Perch], weights: "30/35/35" }
    feeds_into: [COOK]
    status: EXISTS_IN_GAME
    notes: "APPRENTICE through CRAFTSMAN LIVE. Craftsman unlocks River Trout (22g) and Lake Perch (25g) at fishing spots."

  LUMBERJACK:
    type: GATHERING
    unlock_level: 3
    description: "Fells trees and prepares timber."
    bonus_spots: [forest, hardwood_grove]
    tier_unlocks:
      APPRENTICE: { level: "3-10", spots: [forest], yield_bonus: "+0%" }
      JOURNEYMAN: { level: "11-25", spots: [hardwood_grove], yield_bonus: "+25%", asset_based: true }
    feeds_into: [WOODWORKER, FLETCHER, MASON, SCRIBE, COOK, BLACKSMITH]
    status: EXISTS_IN_GAME
    notes: "Hardwood Grove (L7+ asset) now LIVE for BLACKSMITH supply chain."

  MINER:
    type: GATHERING
    unlock_level: 3
    description: "Extracts ore, stone, gems, and clay from the earth."
    bonus_spots: [mine, quarry, clay_pit, coal_mine, silver_mine]
    tier_unlocks:
      APPRENTICE: { level: "3-10", spots: [mine, quarry, clay], yield_bonus: "+0%" }
      JOURNEYMAN: { level: "11-25", spots: [coal_mine], yield_bonus: "+25%", asset_based: true }
      CRAFTSMAN: { level: "26+", spots: [silver_mine], yield_bonus: "+50%", asset_based: true }
    feeds_into: [SMELTER, MASON, JEWELER, BLACKSMITH]
    status: EXISTS_IN_GAME
    notes: "Coal Mine (L5+ asset), Silver Mine (L7+ asset) now LIVE for BLACKSMITH supply chain."

  HERBALIST:
    type: GATHERING
    unlock_level: 3
    description: "Forages for medicinal and magical herbs."
    bonus_spots: [herb_garden]              # UPDATED: 2026-02-15 — berry_thicket reassigned to FARMER
    tier_unlocks:
      APPRENTICE: { level: "3-4", spots: [herb], yield_bonus: "+0%", resource: "Wild Herbs" }
      JOURNEYMAN: { level: "5-6", spots: [herb], yield_bonus: "+25%", resource: "Wild Herbs" }
      CRAFTSMAN: { level: "7-8", spots: [herb], yield_bonus: "+50%", resources: ["Wild Herbs (30%)", "Medicinal Herbs (35%)", "Glowcap Mushrooms (35%)"] }
    feeds_into: [ALCHEMIST, COOK, BREWER]
    status: EXISTS_IN_GAME
    notes: "All tiers through CRAFTSMAN now LIVE. L7+ HERBALIST gathers tiered resources at herb spots (weighted random). Medicinal Herbs (28g) and Glowcap Mushrooms (32g) feed ALCHEMIST T3 recipes."

  HUNTER:
    type: GATHERING
    unlock_level: 3
    description: "Tracks and hunts wild game for meat and pelts."
    bonus_spots: [hunting_ground]
    tier_unlocks:
      APPRENTICE: { level: "3-4", spots: [hunting_ground], yield_bonus: "+0%", resources: ["Wild Game Meat", "Animal Pelts"] }
      JOURNEYMAN: { level: "5-6", spots: [hunting_ground], yield_bonus: "+25%", resources: ["Wild Game Meat", "Animal Pelts"] }
      CRAFTSMAN: { level: "7-8", spots: [hunting_ground], yield_bonus: "+50%", resources: ["Wild Game Meat", "Animal Pelts", "Wolf Pelts", "Bear Hides"], weights: "40/20/20/20" }
    feeds_into: [COOK, TANNER, FLETCHER]
    status: EXISTS_IN_GAME
    notes: "All tiers through CRAFTSMAN LIVE. Apprentice gathers Wild Game Meat + Animal Pelts (8g). Craftsman unlocks Wolf Pelts (28g) and Bear Hides (35g) at hunting grounds. Pelts feed TANNER leather pipeline."

  # ---------------------------------------------------------------------------
  # CRAFTING PROFESSIONS (15)
  # These transform gathered/intermediate resources into finished goods.
  # Each consumes daily action. Each requires the profession to craft.
  # ---------------------------------------------------------------------------

  COOK:
    type: CRAFTING
    unlock_level: 3
    description: "Transforms raw ingredients into meals that restore HP and grant buffs. The most connected crafter — buys from FARMER, FISHERMAN, HERBALIST, LUMBERJACK, and RANCHER."
    depends_on_gatherers: [FARMER, FISHERMAN, RANCHER, HUNTER, HERBALIST, LUMBERJACK]
    raw_inputs: [apple, wild_berries, wild_herbs, raw_fish, river_trout, lake_perch, grain, vegetables, game_meat, wood_logs, eggs, milk]
    intermediate_inputs: [flour]          # Things COOK makes and reuses
    output_categories: [FOOD, DRINK]
    status: EXISTS_IN_GAME                # UPDATED: 2026-02-20 — 25 recipes (15 original + 3 livestock + 7 fish)
    tier_recipes:  # UPDATED: 2026-02-20
      APPRENTICE: [Flour, Apple Sauce, Porridge, Berry Jam, Herbal Tea, Vegetable Stew, Scrambled Eggs, Creamy Porridge]
      JOURNEYMAN: [Bread Loaf, Apple Pie, Grilled Fish, Fish Stew, Smoked Fish, Seasoned Roast Veg, Berry Tart, Farm Breakfast]
      CRAFTSMAN: [Harvest Feast, "Fisherman's Banquet", Spiced Pastry, Pan-Seared Trout, Perch Feast, "Fisherman's Pie", Smoked Trout Rations]
    # See SECTION 4 for full recipe tree

  BREWER:
    type: CRAFTING
    primary_stat: CON
    unlock_level: 3
    description: "Transforms grain, fruit, and herbs into ales, ciders, wines, and cordials. Beverages grant stat buffs."
    depends_on_gatherers: [FARMER, HERBALIST]
    raw_inputs: [grain, apples, wild_berries, wild_herbs, hops, grapes]
    intermediate_inputs: []
    output_categories: [DRINK]
    status: EXISTS_IN_GAME          # UPDATED: 2026-02-17 — 9 recipes (3 per tier)
    recipes:
      tier_1_apprentice:            # L3-L4
        - { name: Ale, level: 3, inputs: "3x Grain", output: "2x Ale", buff: "+1 CON 30min" }
        - { name: Apple Cider, level: 3, inputs: "3x Apples", output: "2x Apple Cider", buff: "+1 CHA 30min" }
        - { name: Berry Cordial, level: 4, inputs: "3x Wild Berries + 1x Grain", output: "2x Berry Cordial", buff: "HP regen +2 30min" }
      tier_2_journeyman:            # L5-L6
        - { name: Strong Ale, level: 5, inputs: "4x Grain + 1x Wild Herbs", output: "2x Strong Ale", buff: "+2 STR 30min" }
        - { name: Mulled Cider, level: 5, inputs: "3x Apples + 2x Wild Herbs", output: "2x Mulled Cider", buff: "+2 WIS 30min" }
        - { name: Herbal Brew, level: 6, inputs: "3x Wild Herbs + 2x Grain", output: "2x Herbal Brew", buff: "HP regen +3 30min" }
      tier_3_craftsman:             # L7-L8 (requires FARMER Craftsman Hops/Grapes)
        - { name: Hopped Beer, level: 7, inputs: "3x Grain + 2x Hops", output: "2x Hopped Beer", buff: "+3 CON +1 STR 40min" }
        - { name: Grape Wine, level: 7, inputs: "4x Grapes", output: "2x Grape Wine", buff: "+3 CHA +1 WIS 40min" }
        - { name: Pale Ale, level: 8, inputs: "3x Grain + 2x Hops + 1x Wild Herbs", output: "2x Pale Ale", buff: "+2 STR +2 DEX 40min" }
    economy_chain: "FARMER/HERBALIST gather ingredients -> BREWER crafts beverages -> Tavern/Market sells"

  SMELTER:
    # SMELTER profession LIVE — 11 recipes, ore→ingot processing (2026-02-19)
    type: CRAFTING
    unlock_level: 3
    primary_stat: CON
    description: "Smelts raw ore into usable metal ingots and alloys."
    depends_on_gatherers: [MINER]
    raw_inputs: [Copper Ore, Iron Ore, Iron Ore Chunks, Silver Ore, Gold Ore, Mithril Ore, Adamantine Ore, Silite Sand, Coal, Arcane Reagents]
    intermediate_inputs: []
    output_categories: [MATERIAL]
    outputs_used_by: [BLACKSMITH, ARMORER, JEWELER, WOODWORKER, MASON]
    workshop: SMELTERY
    recipe_count: 11
    status: EXISTS_IN_GAME
    tier_recipes:
      apprentice:
        - { id: smelt-copper, level: 1, inputs: "3x Copper Ore + 1x Coal", output: "2x Copper Ingot" }
        - { id: smelt-ore-chunks, level: 3, inputs: "4x Iron Ore Chunks + 2x Coal", output: "1x Iron Ingot" }
        - { id: forge-nails, level: 5, inputs: "1x Copper Ingot", output: "50x Nails" }
        - { id: forge-iron-fittings, level: 8, inputs: "3x Iron Ore Chunks + 1x Coal", output: "4x Iron Fittings" }
        - { id: smelt-iron, level: 10, inputs: "3x Iron Ore + 2x Coal", output: "2x Iron Ingot" }
      journeyman:
        - { id: smelt-glass, level: 15, inputs: "5x Silite Sand", output: "3x Glass" }
        - { id: smelt-silver, level: 20, inputs: "3x Silver Ore + 1x Coal", output: "2x Silver Ingot" }
        - { id: smelt-gold, level: 25, inputs: "3x Gold Ore + 1x Coal", output: "1x Gold Ingot" }
      craftsman:
        - { id: smelt-steel, level: 30, inputs: "2x Iron Ingot + 3x Coal", output: "1x Steel Ingot" }
      expert:
        - { id: smelt-mithril, level: 55, inputs: "5x Mithril Ore + 3x Coal", output: "1x Mithril Ingot" }
      master:
        - { id: smelt-adamantine, level: 75, inputs: "8x Adamantine Ore + 5x Coal + 1x Arcane Reagents", output: "1x Adamantine Ingot" }
    notes: "Critical bottleneck — BLACKSMITH, ARMORER, and JEWELER all need ingots from SMELTER"

  BLACKSMITH:
    type: CRAFTING
    unlock_level: 5
    primary_stat: STR
    description: "Forges weapons, tools, and armor from raw ores and wood."
    depends_on_gatherers: [MINER, LUMBERJACK]
    raw_inputs: [Iron Ore Chunks, Coal, Silver Ore, Wood Logs, Hardwood]
    intermediate_inputs: [iron_ingot]    # From SMELTER (for higher-level weapon recipes)
    output_categories: [WEAPON, TOOL, ARMOR]
    status: LIVE
    has_specializations: true
    specializations:
      TOOLSMITH:
        name: "Toolsmith"
        description: "Craft premium gathering tools with higher durability and yield bonuses."
        exclusive_recipes: [Silver Pickaxe, Hardwood Hatchet, Hunter's Knife, Reinforced Hoe]
      WEAPONSMITH:
        name: "Weaponsmith"
        description: "Forge advanced weapons with superior damage stats."
        exclusive_recipes: [Silver Longsword, Silver Dagger, Silver Battleaxe, War Pick]
      ARMORER:
        name: "Armorer"
        description: "Craft heavy armor and shields for maximum protection."
        exclusive_recipes: [Silver-Studded Plate, Silver Helm, Hardwood Tower Shield, Reinforced Chain Leggings]
    specialization_level: 7
    specialization_permanent: true
    recipe_count: 28  # 16 shared + 12 branch-exclusive
    recipe_tiers:
      apprentice: "7 recipes (L3-L4) — shared, using Iron Ore Chunks + Wood Logs"
      journeyman: "9 recipes (L5-L6) — shared, adding Coal as fuel"
      specialist: "12 recipes (L7-L8) — 4 per branch, using Silver Ore + Hardwood"
    notes: "Two pathways: (1) Raw-ore recipes (L3-L8) for early crafting, (2) Ingot-based weapon recipes (L1-L75) for endgame via SMELTER chain"

  ARMORER:
    # ARMORER profession LIVE — 25 recipes, metal plate armor (2026-02-19)
    type: CRAFTING
    unlock_level: 5
    primary_stat: STR
    description: "Crafts metal armor and shields from ingots and leather."
    depends_on_gatherers: []
    depends_on_crafters: [SMELTER, TANNER]
    intermediate_inputs: [Copper Ingot, Iron Ingot, Steel Ingot, Mithril Ingot, Adamantine Ingot, Cured Leather, Bear Leather]
    output_categories: [ARMOR]
    workshop: SMITHY (shared with BLACKSMITH)
    recipe_count: 25
    status: EXISTS_IN_GAME
    tier_recipes:
      apprentice:
        - { id: craft-copper-helm, level: 1, slot: HEAD }
        - { id: craft-copper-chestplate, level: 1, slot: CHEST }
        - { id: craft-copper-gauntlets, level: 1, slot: HANDS }
        - { id: craft-copper-greaves, level: 1, slot: LEGS }
        - { id: craft-copper-shield, level: 1, slot: OFF_HAND }
      journeyman:
        - { id: craft-iron-helm, level: 10, slot: HEAD }
        - { id: craft-iron-chestplate, level: 10, slot: CHEST }
        - { id: craft-iron-gauntlets, level: 10, slot: HANDS }
        - { id: craft-iron-greaves, level: 10, slot: LEGS }
        - { id: craft-iron-shield, level: 10, slot: OFF_HAND }
      craftsman:
        - { id: craft-steel-helm, level: 30, slot: HEAD }
        - { id: craft-steel-chestplate, level: 30, slot: CHEST }
        - { id: craft-steel-gauntlets, level: 30, slot: HANDS }
        - { id: craft-steel-greaves, level: 30, slot: LEGS }
        - { id: craft-steel-shield, level: 30, slot: OFF_HAND }
      expert:
        - { id: craft-mithril-helm, level: 55, slot: HEAD }
        - { id: craft-mithril-chestplate, level: 55, slot: CHEST }
        - { id: craft-mithril-gauntlets, level: 55, slot: HANDS }
        - { id: craft-mithril-greaves, level: 55, slot: LEGS }
        - { id: craft-mithril-shield, level: 55, slot: OFF_HAND }
      master:
        - { id: craft-adamantine-helm, level: 75, slot: HEAD }
        - { id: craft-adamantine-chestplate, level: 75, slot: CHEST }
        - { id: craft-adamantine-gauntlets, level: 75, slot: HANDS }
        - { id: craft-adamantine-greaves, level: 75, slot: LEGS }
        - { id: craft-adamantine-shield, level: 75, slot: OFF_HAND }
    supply_chain: "MINER → SMELTER → ARMORER, HUNTER → TANNER → ARMORER"
    notes: "Shares SMITHY workshop with BLACKSMITH. Uses Cured Leather (T1-3) and Bear Leather (T4-5) as secondary inputs."

  WOODWORKER:
    # WOODWORKER profession LIVE — 25 recipes (11 processing + 14 finished goods)
    # UPDATED: 2026-02-19 — WOODWORKER implemented with full recipe tree (25 recipes)
    type: CRAFTING
    unlock_level: 3
    description: "Shapes timber into furniture, tools, shields, and building components. Central processing hub of the wood economy."
    depends_on_gatherers: [LUMBERJACK]
    raw_inputs: [wood_logs, softwood, hardwood, exotic_wood]
    intermediate_inputs: [nails]
    output_categories: [TOOL, FURNITURE, MATERIAL, ARMOR, WEAPON]
    outputs_used_by: [FLETCHER, MINER, FISHERMAN, TANNER, BLACKSMITH]
    status: EXISTS_IN_GAME
    recipe_count: 25
    tier_recipes:
      apprentice:
        level_range: "3-10"
        processing: ["saw-rough-planks", "mill-softwood", "ww-carve-wooden-dowels", "ww-shape-wooden-handle", "ww-carve-bow-stave"]
        finished_goods: ["ww-wooden-pickaxe", "ww-fishing-rod", "ww-carving-knife", "ww-wooden-chair"]
      journeyman:
        level_range: "11-25"
        processing: ["mill-hardwood", "shape-beams", "make-barrel", "make-furniture", "ww-craft-wooden-frame"]
        finished_goods: ["ww-tanning-rack", "ww-fine-fishing-rod", "ww-wooden-table", "ww-storage-chest", "ww-wooden-bed-frame", "ww-wooden-shield"]
      craftsman:
        level_range: "26-50"
        processing: ["mill-exotic"]
        finished_goods: ["ww-wooden-shelf", "ww-reinforced-crate", "ww-hardwood-tower-shield", "ww-practice-bow"]

  TANNER:
    type: CRAFTING
    primary_stat: DEX
    unlock_level: 3
    description: "Cures pelts into leather and crafts leather goods. Two-step pipeline: pelts → leather → finished goods."
    depends_on_gatherers: [HUNTER]
    related_professions: [HUNTER]
    raw_inputs: [animal_pelts, wolf_pelts, bear_hides]
    intermediate_inputs: [cured_leather, wolf_leather, bear_leather]
    output_categories: [MATERIAL, ARMOR, TOOL, CONSUMABLE]
    outputs_used_by: [LEATHERWORKER, ARMORER, TAILOR]
    status: EXISTS_IN_GAME
    tier_recipes:
      APPRENTICE: ["Cured Leather", "Leather Cap", "Leather Satchel"]
      JOURNEYMAN: ["Leather Vest", "Leather Belt", "Leather Armor", "Leather Bracers"]
      CRAFTSMAN: ["Leather Greaves", "Quiver", "Wolf Leather (processing)", "Bear Leather (processing)", "Wolf Leather Armor", "Wolf Leather Hood", "Bear Hide Cuirass", "Ranger's Quiver"]
    recipe_count: 15  # 3 processing + 4 apprentice + 4 journeyman + 4 craftsman
    notes: "Two-step pipeline: HUNTER pelts → TANNER cures into leather → TANNER crafts into goods. Cured Leather is shared intermediate (TAILOR will buy). Leather armor offers less defense than metal but grants DEX bonuses — player choice."

  # LEATHERWORKER profession LIVE — 13 recipes (2026-02-19)
  LEATHERWORKER:
    type: CRAFTING
    unlock_level: 5
    primary_stat: DEX
    description: "Crafts leather accessories, gloves, boots, bags, and utility items. Uses TANNER outputs (Cured/Wolf/Bear Leather) + WOODWORKER parts (Wooden Frame, Handle, Nails). Covers HANDS, FEET, BACK slots — does NOT duplicate TANNER armor (HEAD, CHEST, LEGS, OFF_HAND)."
    depends_on_gatherers: []
    depends_on_crafters: [TANNER, WOODWORKER]
    intermediate_inputs: [cured_leather, wolf_leather, bear_leather, wooden_frame, wooden_handle, nails]
    output_categories: [ARMOR, ACCESSORY, TOOL, CONSUMABLE]
    workshop: TANNERY  # shared with TANNER
    status: EXISTS_IN_GAME
    tier_recipes:
      APPRENTICE: ["Leather Gloves", "Leather Boots", "Leather Backpack", "Leather Waterskin"]
      JOURNEYMAN: ["Wolf Leather Gloves", "Wolf Leather Boots", "Toolbelt", "Leather Repair Kit", "Ranger's Pack"]
      CRAFTSMAN: ["Bear Hide Vambraces", "Bear Leather Boots", "Hunter's Kit", "Explorer's Pack"]
    recipe_count: 13
    notes: "Fills the gaps TANNER doesn't cover. Armor values intentionally lower than TANNER — LEATHERWORKER makes utility, not defense. DEX bonuses on all armor pieces (leather stat identity). Supply chain: HUNTER → TANNER → LEATHERWORKER. Workshop: TANNERY (shared, no new building needed)."

  TAILOR:
    type: CRAFTING
    primary_stat: CHA
    unlock_level: 3
    description: "Weaves cloth from wool and silk, then sews robes and garments. Cloth armor has low AC but high magicResist — the mage/healer/diplomat's choice."
    depends_on_gatherers: [RANCHER]
    related_professions: [RANCHER, TANNER]
    raw_inputs: [wool, fine_wool, silkworm_cocoons, cotton]
    intermediate_inputs: [woven_cloth, fine_cloth, silk_fabric, cloth, cured_leather]
    output_categories: [MATERIAL, ARMOR]
    outputs_used_by: [ARMORER]
    status: EXISTS_IN_GAME
    tier_recipes:
      APPRENTICE: ["Spin Cloth (legacy)", "Weave Cloth", "Cloth Hood", "Cloth Sash", "Cloth Robe", "Wool Trousers"]
      JOURNEYMAN: ["Scholar's Robe", "Traveler's Cloak", "Merchant's Hat", "Herbalist's Apron"]
      CRAFTSMAN: ["Weave Fine Cloth", "Process Silk", "Archmage's Robe", "Diplomat's Regalia", "Silk Hood of Insight", "Noble's Leggings", "Enchanted Cloak"]
    recipe_count: 17  # 4 processing + 13 armor (make-cloth-padding removed — Cloth Padding unused)
    notes: "Marketplace-dependent dual-supply crafter: buys Wool/Fine Wool/Silkworm Cocoons from RANCHER, buys Cured Leather from TANNER. Intermediates: Woven Cloth (T1), Fine Cloth (T3), Silk Fabric (T3). Legacy spin-cloth kept for WOODWORKER housing-bed recipe. Armor triangle: BLACKSMITH (plate, high armor/STR) vs TANNER (leather, armor+DEX) vs TAILOR (cloth, low armor + high magicResist + INT/WIS/CHA)."

  ALCHEMIST:
    type: CRAFTING
    unlock_level: 5
    primary_stat: INT
    description: "Brews potions, salves, and elixirs from herbs, berries, and minerals."
    depends_on_gatherers: [HERBALIST, FARMER]
    raw_inputs: [wild_herbs, wild_berries, clay, medicinal_herbs, glowcap_mushrooms]
    intermediate_inputs: []
    output_categories: [POTION]
    tier_unlocks:
      APPRENTICE: { level: "3-4", recipes: ["Minor Healing Potion", "Antidote", "Berry Salve"] }
      JOURNEYMAN: { level: "5-6", recipes: ["Healing Potion", "Elixir of Strength", "Elixir of Wisdom", "Poison Resistance Tonic"] }
      CRAFTSMAN: { level: "7-8", recipes: ["Greater Healing Potion", "Elixir of Fortitude", "Glowcap Extract", "Universal Antidote"] }
    status: EXISTS_IN_GAME
    notes: "11 recipes across 3 tiers. First dedicated HERBALIST consumer. Potions marked isPotion=true, sold at Apothecary building. Supply chain: HERBALIST/FARMER → ALCHEMIST → Market."

  ENCHANTER:
    # ENCHANTER profession LIVE — 9 recipes, enchantment scrolls (2026-02-19)
    type: CRAFTING
    unlock_level: 7
    primary_stat: INT
    description: "Imbues items with magical properties via enchantment scrolls."
    depends_on_gatherers: [MINER, HERBALIST]
    depends_on_crafters: [SMELTER, ALCHEMIST]
    intermediate_inputs: [Arcane Reagents, Coal, Gemstones, Rare Herbs, Silver Ingot, Iron Ingot]
    output_categories: [ENCHANTMENT]
    workshop: ENCHANTING_TOWER
    recipe_count: 9
    status: EXISTS_IN_GAME
    tier_recipes:
      apprentice:
        - { id: ench-fortified, level: 5, output: Fortified Enchantment Scroll }
      journeyman:
        - { id: ench-flaming, level: 10, output: Flaming Enchantment Scroll }
        - { id: ench-frost, level: 10, output: Frost Enchantment Scroll }
        - { id: ench-lightning, level: 15, output: Lightning Enchantment Scroll }
        - { id: ench-swift, level: 15, output: Swift Enchantment Scroll }
        - { id: ench-poisoned, level: 20, output: Poisoned Enchantment Scroll }
        - { id: ench-warding, level: 20, output: Warding Enchantment Scroll }
      craftsman:
        - { id: ench-holy, level: 30, output: Holy Enchantment Scroll }
        - { id: ench-shadow, level: 30, output: Shadow Enchantment Scroll }
    supply_chain: "HERBALIST → Arcane Reagents; MINER → Coal/Gemstones; SMELTER → Ingots → ENCHANTER"
    notes: "9 enchantment scrolls (6 offensive, 3 utility). Scroll application to equipment is a separate future feature."

  JEWELER:
    # JEWELER profession LIVE — 12 recipes, jewelry & accessories (2026-02-19)
    type: CRAFTING
    unlock_level: 5
    primary_stat: DEX
    description: "Cuts gems and crafts jewelry, rings, necklaces, circlets, and brooches."
    depends_on_gatherers: [MINER]
    depends_on_crafters: [SMELTER]
    intermediate_inputs: [Copper Ingot, Iron Ingot, Silver Ingot, Gold Ingot, Mithril Ingot, Gemstones, Arcane Reagents]
    output_categories: [ACCESSORY]
    workshop: JEWELER_WORKSHOP
    recipe_count: 12
    status: EXISTS_IN_GAME
    tier_recipes:
      apprentice:
        - { id: jewel-copper-ring, level: 1, output: Copper Ring }
        - { id: jewel-copper-necklace, level: 1, output: Copper Necklace }
      journeyman:
        - { id: jewel-iron-ring, level: 10, output: Iron Ring }
        - { id: jewel-brooch-protection, level: 15, output: Brooch of Protection }
        - { id: jewel-silver-ring, level: 20, output: Silver Ring }
        - { id: jewel-silver-necklace, level: 20, output: Silver Necklace }
        - { id: jewel-circlet-focus, level: 25, output: Circlet of Focus }
      craftsman:
        - { id: jewel-gold-ring, level: 30, output: Gold Ring }
        - { id: jewel-gold-necklace, level: 30, output: Gold Necklace }
        - { id: jewel-brooch-speed, level: 30, output: Brooch of Speed }
      expert:
        - { id: jewel-crown-wisdom, level: 50, output: Crown of Wisdom }
        - { id: jewel-mithril-ring, level: 55, output: Mithril Ring }
    supply_chain: "MINER → SMELTER → JEWELER (ingots + gems)"
    notes: "Full set of rings, necklaces, circlets, and brooches. Uses Gemstones from MINER + ingots from SMELTER."

  # FLETCHER profession LIVE — 13 recipes (2026-02-19)
  FLETCHER:
    type: CRAFTING
    primary_stat: DEX
    unlock_level: 5
    description: "Crafts bows, arrows, and quivers. Supply chain: WOODWORKER (Bow Stave, Planks, Dowels) + TANNER (Cured/Wolf/Bear Leather)."
    depends_on_gatherers: [LUMBERJACK, HUNTER]
    depends_on_crafters: [WOODWORKER, TANNER]
    raw_inputs: [softwood_planks, hardwood_planks, wooden_dowels, wooden_handle, bow_stave]
    intermediate_inputs: [cured_leather, wolf_leather, bear_leather, bowstring]
    output_categories: [WEAPON, AMMO, ACCESSORY]
    workshops: [Thornwatch, Thornden, Bonepile, Windbreak]
    status: EXISTS_IN_GAME
    recipe_count: 13
    tier_recipes:
      apprentice:
        level_range: "1-10"
        recipes: ["fletch-bowstring", "fletch-arrows", "fletch-shortbow", "fletch-hunting-bow"]
      journeyman:
        level_range: "11-25"
        recipes: ["fletch-longbow", "fletch-war-arrows", "fletch-war-bow", "fletch-quiver"]
      craftsman:
        level_range: "26-50"
        recipes: ["fletch-barbed-arrows", "fletch-composite-bow", "fletch-rangers-quiver", "fletch-flight-arrows", "fletch-rangers-longbow"]
    damage_progression: "Practice Bow (5, WW) → Shortbow (6) → Hunting Bow (8) → Longbow (14) → War Bow (16) → Composite Bow (22) → Ranger's Longbow (26)"

  MASON:
    # MASON profession LIVE — 12 recipes, stone processing + housing (2026-02-19)
    type: CRAFTING
    unlock_level: 5
    primary_stat: STR
    description: "Works stone into building materials and structures."
    depends_on_gatherers: [MINER]
    depends_on_crafters: [SMELTER]
    intermediate_inputs: [Raw Stone, Stone Blocks, Sandstone, Clay, Coal, Marble, Iron Ingot]
    output_categories: [BUILDING_MATERIAL, HOUSING]
    workshop: MASON_YARD
    recipe_count: 12
    status: EXISTS_IN_GAME
    tier_recipes:
      apprentice:
        - { id: cut-stone, level: 1, output: Cut Stone }
        - { id: cut-stone-blocks, level: 3, output: Cut Stone }
        - { id: cut-sandstone, level: 5, output: Cut Sandstone }
        - { id: fire-clay, level: 5, output: Bricks }
        - { id: carve-stone-slab, level: 8, output: Stone Slab }
      journeyman:
        - { id: fire-bricks, level: 10, output: Bricks }
        - { id: housing-stone-hearth, level: 10, output: Stone Hearth }
        - { id: shape-clay-pot, level: 12, output: Clay Pot }
        - { id: housing-brick-oven, level: 15, output: Brick Oven }
        - { id: housing-stone-fountain, level: 25, output: Stone Fountain }
      craftsman:
        - { id: polish-marble, level: 30, output: Polished Marble }
        - { id: housing-marble-statue, level: 35, output: Marble Statue }
    supply_chain: "MINER → Raw Stone/Clay/Marble → MASON → Cut Stone/Bricks/Polished Marble → Housing items"
    notes: "12 recipes (8 processing + 4 housing). Stone Slab and Clay Pot templates added. Only 3 towns have MASON_YARD."

  SCRIBE:
    # SCRIBE profession LIVE — 7 recipes, scrolls & maps (2026-02-19)
    type: CRAFTING
    unlock_level: 5
    primary_stat: INT
    description: "Creates scrolls, books, maps, and written works."
    depends_on_gatherers: [LUMBERJACK, HERBALIST]
    depends_on_crafters: [WOODWORKER]
    intermediate_inputs: [Softwood Planks, Common Herbs, Medicinal Herbs, Flowers, Arcane Reagents]
    output_categories: [SCROLL, MAP]
    workshop: SCRIBE_STUDY
    recipe_count: 7
    status: EXISTS_IN_GAME
    tier_recipes:
      apprentice:
        - { id: scribe-area-map, level: 5, output: Area Map }
      journeyman:
        - { id: scribe-scroll-fire, level: 10, output: Scroll of Fire }
        - { id: scribe-identification-scroll, level: 10, output: Identification Scroll }
        - { id: scribe-scroll-ice, level: 15, output: Scroll of Ice }
        - { id: scribe-scroll-healing, level: 20, output: Scroll of Healing }
        - { id: scribe-dungeon-map, level: 20, output: Dungeon Map }
        - { id: scribe-scroll-lightning, level: 25, output: Scroll of Lightning }
    supply_chain: "HERBALIST → herbs/reagents; LUMBERJACK → WOODWORKER → Softwood Planks → SCRIBE"
    notes: "7 consumable recipes (3 offensive scrolls, 1 healing scroll, 2 maps, 1 utility). 10 towns have SCRIBE_STUDY."

  # ---------------------------------------------------------------------------
  # SERVICE PROFESSIONS (6)
  # These don't craft items — they provide services, run businesses,
  # or interact with other game systems.
  # ---------------------------------------------------------------------------

  MERCHANT:
    type: SERVICE
    unlock_level: 3
    description: "Trades goods with bonuses. Lower market fees, better buy/sell prices."
    mechanics: "Reduced market listing fees. CHA bonus on auction bids. Can run a shop."
    status: EXISTS_IN_GAME

  INNKEEPER:
    type: SERVICE
    unlock_level: 5
    description: "Runs a tavern. Sells food/drink, provides rest bonuses."
    mechanics: "Stocks food from COOKs and drinks from BREWERs. Rest bonus for visitors."
    depends_on: [COOK, BREWER]
    status: PLANNED

  HEALER:
    type: SERVICE
    unlock_level: 5
    description: "Heals other players. Uses potions from ALCHEMISTs."
    mechanics: "Can heal other characters. Consumes potions. Earns gold per heal."
    depends_on: [ALCHEMIST]
    status: PLANNED

  STABLE_MASTER:
    type: SERVICE
    unlock_level: 5
    description: "Manages mounts and speeds up travel."
    mechanics: "Reduces travel time for customers. Can breed/sell mounts."
    status: PLANNED

  BANKER:
    type: SERVICE
    unlock_level: 7
    description: "Manages gold storage, loans, and interest."
    mechanics: "Secure gold storage. Can issue loans. Earns interest."
    status: PLANNED

  COURIER:
    type: SERVICE
    unlock_level: 3
    description: "Delivers items between towns for other players."
    mechanics: "Can carry items for others. Faster travel. Delivery quests."
    status: PLANNED


# =============================================================================
# SECTION 4: COOK RECIPE TREE (FIRST CRAFTING PROFESSION)
# =============================================================================
# COOK is the first crafting profession to be fully implemented.
# It establishes the pattern for all other crafting professions.
#
# Design principles:
# - Every recipe uses resources that exist (or will exist) as gathered items
# - Progressive complexity: T1 = 1 input, T2 = 2 inputs, T3 = 2-3 inputs
# - Intermediate ingredients (Flour) are crafted by COOK and reused in higher tiers
# - Crafted food > raw food in both HP restore and sell value
# - Food grants buffs at higher tiers (economic incentive to level COOK)
# =============================================================================

cook_recipes:

  # --- INTERMEDIATES (craft these to use in higher-tier recipes) ---

  flour:
    id: flour
    name: Flour
    description: "Finely ground grain. The foundation of all baking."
    category: INGREDIENT
    base_value: 5
    tier: 1
    level_required: 3
    profession: COOK
    xp_reward: 8
    inputs:
      - item_id: grain
        quantity: 2
      - item_id: wood_logs
        quantity: 1
    outputs:
      - item_id: flour
        quantity: 1
    notes: "Intermediate ingredient. Not edible. Used in Bread, Pie, Pastry, Feast."

  # --- TIER 1: APPRENTICE (Level 3-4) ---
  # Single input, basic food. First things a new COOK makes.

  apple_sauce:
    id: apple_sauce
    name: Apple Sauce
    description: "Sweet stewed apples. Simple comfort food."
    category: FOOD
    base_value: 8
    tier: 1
    level_required: 3
    profession: COOK
    xp_reward: 10
    inputs:
      - item_id: apple
        quantity: 3
      - item_id: wood_logs
        quantity: 1
    outputs:
      - item_id: apple_sauce
        quantity: 1
    effects:
      hp_restore: 15
    crafting_note: "3 Apples (9g raw) → 1 Apple Sauce (8g + 15 HP). Value is in the HP, not resale."

  porridge:
    id: porridge
    name: Porridge
    description: "Thick, hearty grain porridge. Keeps you going all day."
    category: FOOD
    base_value: 7
    tier: 1
    level_required: 3
    profession: COOK
    xp_reward: 10
    inputs:
      - item_id: grain
        quantity: 2
      - item_id: wood_logs
        quantity: 1
    outputs:
      - item_id: porridge
        quantity: 1
    effects:
      hp_restore: 12

  berry_jam:
    id: berry_jam
    name: Berry Jam
    description: "Sweet preserved berries. Delicious on bread."
    category: INGREDIENT
    base_value: 6
    tier: 1
    level_required: 3
    profession: COOK
    xp_reward: 8
    inputs:
      - item_id: wild_berries
        quantity: 3
      - item_id: wood_logs
        quantity: 1
    outputs:
      - item_id: berry_jam
        quantity: 1
    notes: "Intermediate + edible. Can eat for 8 HP or use in Tier 2 recipes."
    effects:
      hp_restore: 8

  grilled_fish:
    id: grilled_fish
    name: Grilled Fish
    description: "Simply grilled over an open flame. Much better than raw."
    category: FOOD
    base_value: 10
    tier: 1
    level_required: 3
    profession: COOK
    xp_reward: 10
    inputs:
      - item_id: raw_fish
        quantity: 2
      - item_id: wood_logs
        quantity: 1
    outputs:
      - item_id: grilled_fish
        quantity: 1
    effects:
      hp_restore: 20

  herbal_tea:
    id: herbal_tea
    name: Herbal Tea
    description: "A soothing brew of wild herbs. Restores body and spirit."
    category: DRINK
    base_value: 10
    tier: 1
    level_required: 3
    profession: COOK
    xp_reward: 10
    inputs:
      - item_id: wild_herbs
        quantity: 2
      - item_id: wood_logs
        quantity: 1
    outputs:
      - item_id: herbal_tea
        quantity: 1
    effects:
      hp_restore: 10
      buff: "calm"
      buff_duration_ticks: 1
      buff_description: "+1 WIS for 1 tick"

  vegetable_stew:
    id: vegetable_stew
    name: Vegetable Stew
    description: "A thick, warming stew of root vegetables."
    category: FOOD
    base_value: 8
    tier: 1
    level_required: 3
    profession: COOK
    xp_reward: 10
    inputs:
      - item_id: vegetables
        quantity: 3
      - item_id: wood_logs
        quantity: 1
    outputs:
      - item_id: vegetable_stew
        quantity: 1
    effects:
      hp_restore: 15

  # --- TIER 2: JOURNEYMAN (Level 5-6) ---
  # Two inputs OR uses an intermediate from Tier 1.

  bread_loaf:
    id: bread_loaf
    name: Bread Loaf
    description: "A crusty golden loaf. The staff of life."
    category: FOOD
    base_value: 12
    tier: 2
    level_required: 5
    profession: COOK
    xp_reward: 15
    inputs:
      - item_id: flour
        quantity: 2
      - item_id: wood_logs
        quantity: 1
    outputs:
      - item_id: bread_loaf
        quantity: 1
    effects:
      hp_restore: 20
    dependency_chain: "Grain →[COOK]→ Flour →[COOK]→ Bread Loaf"

  apple_pie:
    id: apple_pie
    name: Apple Pie
    description: "Warm apple pie with a flaky crust. A countryside classic."
    category: FOOD
    base_value: 18
    tier: 2
    level_required: 5
    profession: COOK
    xp_reward: 18
    inputs:
      - item_id: flour
        quantity: 1
      - item_id: apple
        quantity: 3
      - item_id: wood_logs
        quantity: 1
    outputs:
      - item_id: apple_pie
        quantity: 1
    effects:
      hp_restore: 30
    dependency_chain: "Grain →[COOK]→ Flour + Apples →[COOK]→ Apple Pie"

  fish_stew:
    id: fish_stew
    name: Fish Stew
    description: "A hearty chowder with fresh fish and herbs."
    category: FOOD
    base_value: 16
    tier: 2
    level_required: 5
    profession: COOK
    xp_reward: 18
    inputs:
      - item_id: raw_fish
        quantity: 2
      - item_id: wild_herbs
        quantity: 1
      - item_id: wood_logs
        quantity: 1
    outputs:
      - item_id: fish_stew
        quantity: 1
    effects:
      hp_restore: 28
      buff: "well_fed"
      buff_duration_ticks: 2
      buff_description: "+1 CON for 2 ticks"

  seasoned_roast_vegetables:
    id: seasoned_roast_vegetables
    name: Seasoned Roast Vegetables
    description: "Roasted roots glazed with herbal seasoning."
    category: FOOD
    base_value: 14
    tier: 2
    level_required: 5
    profession: COOK
    xp_reward: 15
    inputs:
      - item_id: vegetables
        quantity: 2
      - item_id: wild_herbs
        quantity: 1
      - item_id: wood_logs
        quantity: 1
    outputs:
      - item_id: seasoned_roast_vegetables
        quantity: 1
    effects:
      hp_restore: 22
      buff: "nourished"
      buff_duration_ticks: 1
      buff_description: "+1 STR for 1 tick"

  berry_tart:
    id: berry_tart
    name: Berry Tart
    description: "A crisp pastry shell filled with sweet berry jam."
    category: FOOD
    base_value: 16
    tier: 2
    level_required: 5
    profession: COOK
    xp_reward: 18
    inputs:
      - item_id: flour
        quantity: 1
      - item_id: berry_jam
        quantity: 1
      - item_id: wood_logs
        quantity: 1
    outputs:
      - item_id: berry_tart
        quantity: 1
    effects:
      hp_restore: 25
    dependency_chain: "Grain →[COOK]→ Flour + Berries →[COOK]→ Jam →[COOK]→ Berry Tart"

  # --- TIER 3: EXPERT (Level 7+) ---
  # 2-3 inputs, premium effects, cross-resource ingredients.

  harvest_feast:
    id: harvest_feast
    name: Harvest Feast
    description: "A grand platter of bread, roasted fruit, and herbed vegetables. Fit for a lord."
    category: FOOD
    base_value: 35
    tier: 3
    level_required: 7
    profession: COOK
    xp_reward: 30
    inputs:
      - item_id: bread_loaf
        quantity: 1
      - item_id: apple
        quantity: 2
      - item_id: wild_herbs
        quantity: 2
      - item_id: wood_logs
        quantity: 1
    outputs:
      - item_id: harvest_feast
        quantity: 1
    effects:
      hp_restore: 50
      buff: "feast_spirit"
      buff_duration_ticks: 3
      buff_description: "+2 CON, +1 CHA for 3 ticks"
    dependency_chain: "Grain →[COOK]→ Flour →[COOK]→ Bread + Apples + Herbs →[COOK]→ Harvest Feast"

  fisherman_banquet:
    id: fisherman_banquet
    name: Fisherman's Banquet
    description: "Grilled fish on herb bread with berry glaze. A coastal delicacy."
    category: FOOD
    base_value: 32
    tier: 3
    level_required: 7
    profession: COOK
    xp_reward: 30
    inputs:
      - item_id: grilled_fish
        quantity: 1
      - item_id: bread_loaf
        quantity: 1
      - item_id: berry_jam
        quantity: 1
      - item_id: wood_logs
        quantity: 1
    outputs:
      - item_id: fisherman_banquet
        quantity: 1
    effects:
      hp_restore: 45
      buff: "sea_strength"
      buff_duration_ticks: 3
      buff_description: "+2 STR, +1 DEX for 3 ticks"
    dependency_chain: "Fish →[COOK]→ Grilled Fish + Grain →[COOK]→ Flour →[COOK]→ Bread + Berries →[COOK]→ Jam →[COOK]→ Banquet"

  spiced_pastry:
    id: spiced_pastry
    name: Spiced Pastry
    description: "A delicate pastry layered with herbed honey and berry filling. A luxury trade good."
    category: TRADE_GOOD
    base_value: 40
    tier: 3
    level_required: 7
    profession: COOK
    xp_reward: 25
    inputs:
      - item_id: flour
        quantity: 2
      - item_id: wild_herbs
        quantity: 2
      - item_id: berry_jam
        quantity: 1
      - item_id: wood_logs
        quantity: 1
    outputs:
      - item_id: spiced_pastry
        quantity: 1
    effects:
      hp_restore: 20
    notes: "High sell value, moderate HP. Designed as a trade good — COOKs make these to sell, not eat."
    dependency_chain: "Grain →[COOK]→ Flour + Herbs + Berries →[COOK]→ Jam →[COOK]→ Spiced Pastry"

  # --- LIVESTOCK RECIPES (RANCHER → COOK) --- ADDED 2026-02-17

  scrambled_eggs:
    id: cook-scrambled-eggs
    name: Scrambled Eggs
    description: "Fluffy scrambled eggs. Simple, nutritious farm food."
    category: FOOD
    base_value: 12
    tier: 1
    level_required: 3
    profession: COOK
    xp_reward: 10
    inputs:
      - item_id: eggs
        quantity: 3
    outputs:
      - item_id: scrambled_eggs
        quantity: 2
    effects:
      hp_regen: 3
    dependency_chain: "Chicken →[RANCHER auto]→ Eggs →[COOK]→ Scrambled Eggs"

  creamy_porridge:
    id: cook-creamy-porridge
    name: Creamy Porridge
    description: "Rich porridge made with fresh milk. Hearty and warming."
    category: FOOD
    base_value: 15
    tier: 1
    level_required: 3
    profession: COOK
    xp_reward: 12
    inputs:
      - item_id: grain
        quantity: 2
      - item_id: milk
        quantity: 1
    outputs:
      - item_id: creamy_porridge
        quantity: 2
    effects:
      hp_regen: 2
      buff: "constitution"
      buff_value: 1
    dependency_chain: "FARMER →[gather]→ Grain + Cow →[RANCHER auto]→ Milk →[COOK]→ Creamy Porridge"

  farm_breakfast:
    id: cook-farm-breakfast
    name: Farm Breakfast
    description: "A hearty farmer's breakfast — eggs, porridge, and fresh milk."
    category: FOOD
    base_value: 25
    tier: 2
    level_required: 5
    profession: COOK
    xp_reward: 18
    inputs:
      - item_id: eggs
        quantity: 2
      - item_id: milk
        quantity: 1
      - item_id: grain
        quantity: 1
    outputs:
      - item_id: farm_breakfast
        quantity: 2
    effects:
      hp_regen: 3
      buff: "all_stats"
      buff_value: 1
    dependency_chain: "Chicken →[RANCHER auto]→ Eggs + Cow →[RANCHER auto]→ Milk + FARMER →[gather]→ Grain →[COOK]→ Farm Breakfast"

  # --- FISH RECIPES (FISHERMAN → COOK) --- ADDED 2026-02-20

  # Journeyman Fish (L5-6) — use Raw Fish from FISHERMAN Apprentice

  grilled_fish_v2:   # Updates existing cook-grilled-fish to L5 with herbs
    id: cook-grilled-fish
    name: Grilled Fish
    description: "Fresh fish grilled with wild herbs. Simple, wholesome, and filling."
    category: FOOD
    base_value: 22
    tier: 2
    level_required: 5
    profession: COOK
    xp_reward: 12
    inputs:
      - item_id: raw_fish
        quantity: 2
      - item_id: wild_herbs
        quantity: 1
    outputs:
      - item_id: grilled_fish
        quantity: 2
    effects:
      hp_regen: 2
      duration_ticks: 3
    dependency_chain: "FISHERMAN →[gather]→ Raw Fish + HERBALIST →[gather]→ Wild Herbs →[COOK]→ Grilled Fish"

  fish_stew_v2:   # Updates existing cook-fish-stew inputs
    id: cook-fish-stew
    name: Fish Stew
    description: "A hearty stew of fish, grain, and herbs. Warms the bones on cold nights."
    category: FOOD
    base_value: 28
    tier: 2
    level_required: 5
    profession: COOK
    xp_reward: 15
    inputs:
      - item_id: raw_fish
        quantity: 3
      - item_id: grain
        quantity: 1
      - item_id: wild_herbs
        quantity: 1
    outputs:
      - item_id: fish_stew
        quantity: 2
    effects:
      buff: "constitution"
      buff_value: 2
      duration_ticks: 3
    dependency_chain: "FISHERMAN → Raw Fish + FARMER → Grain + HERBALIST → Wild Herbs →[COOK]→ Fish Stew"

  smoked_fish:
    id: cook-smoked-fish
    name: Smoked Fish
    description: "Fish cured over a wood fire. Keeps for days on the road."
    category: FOOD
    base_value: 18
    tier: 2
    level_required: 6
    profession: COOK
    xp_reward: 15
    inputs:
      - item_id: raw_fish
        quantity: 3
      - item_id: wood_logs
        quantity: 1
    outputs:
      - item_id: smoked_fish
        quantity: 3
    effects:
      hp_regen: 1
      duration_ticks: 5
    dependency_chain: "FISHERMAN → Raw Fish + LUMBERJACK → Wood Logs →[COOK]→ Smoked Fish"

  # Craftsman Fish (L7-8) — use River Trout/Lake Perch from FISHERMAN Craftsman

  pan_seared_trout:
    id: cook-pan-seared-trout
    name: Pan-Seared Trout
    description: "Trout seared to perfection with herbs and apple glaze."
    category: FOOD
    base_value: 40
    tier: 3
    level_required: 7
    profession: COOK
    xp_reward: 25
    inputs:
      - item_id: river_trout
        quantity: 2
      - item_id: wild_herbs
        quantity: 1
      - item_id: apples
        quantity: 1
    outputs:
      - item_id: pan_seared_trout
        quantity: 2
    effects:
      buff: "dexterity"
      buff_value: 3
      hp_regen: 2
      duration_ticks: 4
    dependency_chain: "FISHERMAN L7+ → River Trout + HERBALIST → Wild Herbs + FARMER → Apples →[COOK]→ Pan-Seared Trout"

  perch_feast:
    id: cook-perch-feast
    name: Perch Feast
    description: "Roasted perch with grain bread and herb butter."
    category: FOOD
    base_value: 48
    tier: 3
    level_required: 7
    profession: COOK
    xp_reward: 28
    inputs:
      - item_id: lake_perch
        quantity: 3
      - item_id: grain
        quantity: 2
      - item_id: wild_herbs
        quantity: 1
    outputs:
      - item_id: perch_feast
        quantity: 2
    effects:
      buff: "constitution"
      buff_value: 3
      secondary_buff: "strength"
      secondary_value: 2
      duration_ticks: 4
    dependency_chain: "FISHERMAN L7+ → Lake Perch + FARMER → Grain + HERBALIST → Wild Herbs →[COOK]→ Perch Feast"

  fishermans_pie:
    id: cook-fishermans-pie
    name: Fisherman's Pie
    description: "Golden-crusted pie with two kinds of fish, grain, and eggs."
    category: FOOD
    base_value: 55
    tier: 3
    level_required: 8
    profession: COOK
    xp_reward: 30
    inputs:
      - item_id: river_trout
        quantity: 2
      - item_id: lake_perch
        quantity: 2
      - item_id: grain
        quantity: 2
      - item_id: eggs
        quantity: 1
    outputs:
      - item_id: fishermans_pie
        quantity: 2
    effects:
      buff: "constitution"
      buff_value: 4
      hp_regen: 3
      duration_ticks: 4
    dependency_chain: "FISHERMAN L7+ → River Trout + Lake Perch + FARMER → Grain + RANCHER → Eggs →[COOK]→ Fisherman's Pie"

  smoked_trout_rations:
    id: cook-smoked-trout-rations
    name: Smoked Trout Rations
    description: "Premium smoked trout. Stays fresh for long journeys."
    category: FOOD
    base_value: 25
    tier: 3
    level_required: 8
    profession: COOK
    xp_reward: 25
    inputs:
      - item_id: river_trout
        quantity: 3
      - item_id: wood_logs
        quantity: 2
    outputs:
      - item_id: smoked_trout_rations
        quantity: 4
    effects:
      hp_regen: 2
      duration_ticks: 5
    dependency_chain: "FISHERMAN L7+ → River Trout + LUMBERJACK → Wood Logs →[COOK]→ Smoked Trout Rations"


# =============================================================================
# SECTION 4B: TANNER RECIPE TREE
# =============================================================================
# TANNER is a two-step pipeline profession:
#   Step 1: Cure raw pelts into workable leather (processing)
#   Step 2: Craft leather into armor, tools, and goods
#
# Design principles:
# - HUNTER provides all raw pelts (Animal Pelts L3+, Wolf Pelts / Bear Hides L7+)
# - Cured Leather is a shared intermediate — TAILOR will also buy it
# - Leather armor is lighter than metal: less AC but grants DEX bonuses
# - Quiver / Ranger's Quiver are TOOL items that boost HUNTER yield
# =============================================================================

tanner_recipes:

  # --- PROCESSING RECIPES (pelts → leather) ---

  tan-cure-leather:
    id: tan-cure-leather
    name: Cured Leather
    description: "Animal pelts cured and treated into supple, workable leather."
    category: MATERIAL
    base_value: 18
    tier: 1
    level_required: 3
    profession: TANNER
    xp_reward: 10
    inputs:
      - item_id: animal_pelts
        quantity: 3
    outputs:
      - item_id: cured_leather
        quantity: 2
    notes: "Core intermediate. Used in all Apprentice/Journeyman leather goods. TAILOR will also buy."
    dependency_chain: "HUNTER →[gather]→ Animal Pelts →[TANNER]→ Cured Leather"

  tan-wolf-leather:
    id: tan-wolf-leather
    name: Wolf Leather
    description: "Thick, supple leather cured from wolf pelts. Prized for its durability."
    category: MATERIAL
    base_value: 35
    tier: 3
    level_required: 7
    profession: TANNER
    xp_reward: 20
    inputs:
      - item_id: wolf_pelts
        quantity: 2
    outputs:
      - item_id: wolf_leather
        quantity: 1
    notes: "Premium intermediate for Craftsman-tier leather armor."
    dependency_chain: "HUNTER L7+ →[gather]→ Wolf Pelts →[TANNER L7]→ Wolf Leather"

  tan-bear-leather:
    id: tan-bear-leather
    name: Bear Leather
    description: "Heavy, rugged leather cured from bear hides. Nearly as tough as chainmail."
    category: MATERIAL
    base_value: 42
    tier: 3
    level_required: 7
    profession: TANNER
    xp_reward: 22
    inputs:
      - item_id: bear_hides
        quantity: 2
    outputs:
      - item_id: bear_leather
        quantity: 1
    notes: "Premium intermediate for top-tier leather armor."
    dependency_chain: "HUNTER L7+ →[gather]→ Bear Hides →[TANNER L7]→ Bear Leather"

  # --- TIER 1: APPRENTICE GOODS (Level 3-4) ---

  tan-leather-cap:
    id: tan-leather-cap
    name: Leather Cap
    description: "A simple leather cap offering basic head protection."
    category: ARMOR
    slot: HEAD
    base_value: 30
    tier: 1
    level_required: 3
    profession: TANNER
    xp_reward: 12
    inputs:
      - item_id: cured_leather
        quantity: 2
    outputs:
      - item_id: leather_cap
        quantity: 1
    effects:
      defense: 2
      dexterity_bonus: 0
    dependency_chain: "Animal Pelts →[TANNER]→ Cured Leather →[TANNER]→ Leather Cap"

  tan-leather-satchel:
    id: tan-leather-satchel
    name: Leather Satchel
    description: "A sturdy leather satchel that enhances nimbleness on the road."
    category: CONSUMABLE
    base_value: 35
    tier: 1
    level_required: 3
    profession: TANNER
    xp_reward: 14
    inputs:
      - item_id: cured_leather
        quantity: 2
      - item_id: animal_pelts
        quantity: 1
    outputs:
      - item_id: leather_satchel
        quantity: 1
    effects:
      buff: "dexterity"
      buff_value: 1
      duration_ticks: 5
      buff_description: "+1 DEX for 5 ticks"
    dependency_chain: "Animal Pelts →[TANNER]→ Cured Leather + Animal Pelts →[TANNER]→ Leather Satchel"

  tan-leather-vest:
    id: tan-leather-vest
    name: Leather Vest
    description: "A fitted leather vest providing decent torso protection."
    category: ARMOR
    slot: CHEST
    base_value: 45
    tier: 1
    level_required: 4
    profession: TANNER
    xp_reward: 15
    inputs:
      - item_id: cured_leather
        quantity: 3
    outputs:
      - item_id: leather_vest
        quantity: 1
    effects:
      defense: 3
      dexterity_bonus: 0
    dependency_chain: "Animal Pelts →[TANNER]→ Cured Leather →[TANNER]→ Leather Vest"

  tan-leather-belt:
    id: tan-leather-belt
    name: Leather Belt
    description: "A reinforced leather belt that protects the waist and hips."
    category: ARMOR
    slot: LEGS
    base_value: 25
    tier: 1
    level_required: 4
    profession: TANNER
    xp_reward: 12
    inputs:
      - item_id: cured_leather
        quantity: 2
    outputs:
      - item_id: leather_belt
        quantity: 1
    effects:
      defense: 1
      dexterity_bonus: 0
    dependency_chain: "Animal Pelts →[TANNER]→ Cured Leather →[TANNER]→ Leather Belt"

  # --- TIER 2: JOURNEYMAN GOODS (Level 5-6) ---

  tan-leather-armor:
    id: tan-leather-armor
    name: Leather Armor
    description: "Full leather armor covering the torso. Light and flexible."
    category: ARMOR
    slot: CHEST
    base_value: 65
    tier: 2
    level_required: 5
    profession: TANNER
    xp_reward: 20
    inputs:
      - item_id: cured_leather
        quantity: 4
      - item_id: animal_pelts
        quantity: 2
    outputs:
      - item_id: leather_armor
        quantity: 1
    effects:
      defense: 5
      dexterity_bonus: 1
    dependency_chain: "Animal Pelts →[TANNER]→ Cured Leather + Animal Pelts →[TANNER]→ Leather Armor"

  tan-leather-bracers:
    id: tan-leather-bracers
    name: Leather Bracers
    description: "Reinforced leather arm guards. Favored by archers and rogues."
    category: ARMOR
    slot: OFF_HAND
    base_value: 40
    tier: 2
    level_required: 5
    profession: TANNER
    xp_reward: 18
    inputs:
      - item_id: cured_leather
        quantity: 3
    outputs:
      - item_id: leather_bracers
        quantity: 1
    effects:
      defense: 3
      dexterity_bonus: 1
    dependency_chain: "Animal Pelts →[TANNER]→ Cured Leather →[TANNER]→ Leather Bracers"

  tan-leather-greaves:
    id: tan-leather-greaves
    name: Leather Greaves
    description: "Sturdy leather leg armor for protection without sacrificing speed."
    category: ARMOR
    slot: LEGS
    base_value: 50
    tier: 2
    level_required: 6
    profession: TANNER
    xp_reward: 20
    inputs:
      - item_id: cured_leather
        quantity: 3
      - item_id: animal_pelts
        quantity: 1
    outputs:
      - item_id: leather_greaves
        quantity: 1
    effects:
      defense: 4
      dexterity_bonus: 1
    dependency_chain: "Animal Pelts →[TANNER]→ Cured Leather + Animal Pelts →[TANNER]→ Leather Greaves"

  tan-quiver:
    id: tan-quiver
    name: Quiver
    description: "A well-crafted leather quiver. Improves hunting efficiency."
    category: TOOL
    base_value: 55
    tier: 2
    level_required: 6
    profession: TANNER
    xp_reward: 22
    durability: 35
    inputs:
      - item_id: cured_leather
        quantity: 3
      - item_id: animal_pelts
        quantity: 2
    outputs:
      - item_id: quiver
        quantity: 1
    effects:
      yield_bonus: "+25% hunting yield"
      profession_match: HUNTER
    dependency_chain: "Animal Pelts →[TANNER]→ Cured Leather + Animal Pelts →[TANNER]→ Quiver"
    notes: "TOOL item — equips in TOOL slot. +25% hunting yield for HUNTER profession."

  # --- TIER 3: CRAFTSMAN GOODS (Level 7-8) ---

  tan-wolf-leather-armor:
    id: tan-wolf-leather-armor
    name: Wolf Leather Armor
    description: "Superior armor crafted from wolf leather. Tough yet agile."
    category: ARMOR
    slot: CHEST
    base_value: 120
    tier: 3
    level_required: 7
    profession: TANNER
    xp_reward: 30
    inputs:
      - item_id: wolf_leather
        quantity: 3
      - item_id: cured_leather
        quantity: 2
    outputs:
      - item_id: wolf_leather_armor
        quantity: 1
    effects:
      defense: 8
      dexterity_bonus: 2
    dependency_chain: "Wolf Pelts →[TANNER]→ Wolf Leather + Animal Pelts →[TANNER]→ Cured Leather →[TANNER]→ Wolf Leather Armor"

  tan-wolf-leather-hood:
    id: tan-wolf-leather-hood
    name: Wolf Leather Hood
    description: "A wolf-leather hood with a fierce silhouette. Shields the head and sharpens the senses."
    category: ARMOR
    slot: HEAD
    base_value: 75
    tier: 3
    level_required: 7
    profession: TANNER
    xp_reward: 25
    inputs:
      - item_id: wolf_leather
        quantity: 2
      - item_id: cured_leather
        quantity: 1
    outputs:
      - item_id: wolf_leather_hood
        quantity: 1
    effects:
      defense: 5
      dexterity_bonus: 2
    dependency_chain: "Wolf Pelts →[TANNER]→ Wolf Leather + Cured Leather →[TANNER]→ Wolf Leather Hood"

  tan-bear-hide-cuirass:
    id: tan-bear-hide-cuirass
    name: Bear Hide Cuirass
    description: "A massive chest piece of layered bear leather. Rivals chainmail in protection."
    category: ARMOR
    slot: CHEST
    base_value: 155
    tier: 3
    level_required: 8
    profession: TANNER
    xp_reward: 35
    inputs:
      - item_id: bear_leather
        quantity: 3
      - item_id: cured_leather
        quantity: 2
      - item_id: animal_pelts
        quantity: 1
    outputs:
      - item_id: bear_hide_cuirass
        quantity: 1
    effects:
      defense: 10
      dexterity_bonus: 2
    dependency_chain: "Bear Hides →[TANNER]→ Bear Leather + Animal Pelts →[TANNER]→ Cured Leather →[TANNER]→ Bear Hide Cuirass"

  tan-rangers-quiver:
    id: tan-rangers-quiver
    name: "Ranger's Quiver"
    description: "A masterwork quiver of layered wolf leather. The ranger's most prized tool."
    category: TOOL
    base_value: 105
    tier: 3
    level_required: 8
    profession: TANNER
    xp_reward: 30
    durability: 50
    inputs:
      - item_id: wolf_leather
        quantity: 2
      - item_id: cured_leather
        quantity: 2
      - item_id: bear_hides
        quantity: 1
    outputs:
      - item_id: rangers_quiver
        quantity: 1
    effects:
      yield_bonus: "+40% hunting yield"
      profession_match: HUNTER
    dependency_chain: "Wolf Pelts →[TANNER]→ Wolf Leather + Animal Pelts →[TANNER]→ Cured Leather + Bear Hides →[TANNER]→ Ranger's Quiver"
    notes: "TOOL item — equips in TOOL slot. +40% hunting yield for HUNTER profession. Upgraded Quiver."


# =============================================================================
# SECTION 4C: TAILOR RECIPE TREE
# =============================================================================
# TAILOR is a marketplace-dependent dual-supply crafter:
#   Supply 1: RANCHER provides Wool, Fine Wool, Silkworm Cocoons
#   Supply 2: TANNER provides Cured Leather (for leather-trimmed cloth armor)
#
# Design principles:
# - Cloth armor has LOW armor but HIGH magicResist — for mages, healers, diplomats
# - Armor triangle: BLACKSMITH (plate, high armor/STR) vs TANNER (leather, armor+DEX)
#   vs TAILOR (cloth, low armor + high magicResist + INT/WIS/CHA)
# - Three intermediates: Woven Cloth (T1), Fine Cloth (T3), Silk Fabric (T3)
# - Legacy spin-cloth KEPT for WOODWORKER housing-bed recipe (Cloth Padding removed — unused)
# - Silkworm House is a non-livestock auto-producing building (no animals to buy/feed)
# - Fine Wool is a bonus product from L7+ RANCHER sheep (alongside regular Wool)
# =============================================================================

tailor_recipes:

  # --- ITEMS (new materials and armor added by TAILOR) ---

  tailor_items:
    materials:
      fine_wool:
        name: Fine Wool
        item_id: fine_wool
        category: MATERIAL
        quality: COMMON
        base_value: 30
        source: "RANCHER Craftsman (L7+ Sheep Pen bonus product)"
        description: "Exceptionally soft wool from well-bred sheep. Spun into Fine Cloth by a Tailor."
      silkworm_cocoons:
        name: Silkworm Cocoons
        item_id: silkworm_cocoons
        category: MATERIAL
        quality: COMMON
        base_value: 38
        source: "RANCHER Craftsman (Silkworm House, 250g auto-producer)"
        description: "Delicate silk cocoons harvested from a Silkworm House. Processed into Silk Fabric."
      woven_cloth:
        name: Woven Cloth
        item_id: woven_cloth
        category: MATERIAL
        quality: COMMON
        base_value: 20
        source: "TAILOR processing (Wool → Woven Cloth)"
        description: "Sturdy woven cloth from raw wool. The foundation of all tailored goods."
      fine_cloth:
        name: Fine Cloth
        item_id: fine_cloth
        category: MATERIAL
        quality: FINE
        base_value: 38
        source: "TAILOR processing (Fine Wool → Fine Cloth)"
        description: "Luxurious fabric woven from fine wool. Used in superior garments."
      silk_fabric:
        name: Silk Fabric
        item_id: silk_fabric
        category: MATERIAL
        quality: FINE
        base_value: 45
        source: "TAILOR processing (Silkworm Cocoons → Silk Fabric)"
        description: "Shimmering silk fabric with natural magic affinity. The finest textile in Aethermere."
    armor:
      cloth_hood:
        name: Cloth Hood
        item_id: cloth_hood
        category: ARMOR
        slot: HEAD
        quality: COMMON
        base_value: 25
        effects: { armor: 1, magicResist: 3 }
      cloth_sash:
        name: Cloth Sash
        item_id: cloth_sash
        category: ARMOR
        slot: OFF_HAND
        quality: COMMON
        base_value: 20
        effects: { armor: 1, magicResist: 2 }
      cloth_robe:
        name: Cloth Robe
        item_id: cloth_robe
        category: ARMOR
        slot: CHEST
        quality: COMMON
        base_value: 45
        effects: { armor: 2, magicResist: 5 }
      wool_trousers:
        name: Wool Trousers
        item_id: wool_trousers
        category: ARMOR
        slot: LEGS
        quality: COMMON
        base_value: 30
        effects: { armor: 1, magicResist: 3 }
      scholars_robe:
        name: "Scholar's Robe"
        item_id: scholars_robe
        category: ARMOR
        slot: CHEST
        quality: FINE
        base_value: 70
        effects: { armor: 3, magicResist: 8 }
      travelers_cloak:
        name: "Traveler's Cloak"
        item_id: travelers_cloak
        category: ARMOR
        slot: CHEST
        quality: FINE
        base_value: 55
        effects: { armor: 4, magicResist: 5 }
      merchants_hat:
        name: "Merchant's Hat"
        item_id: merchants_hat
        category: ARMOR
        slot: HEAD
        quality: FINE
        base_value: 45
        effects: { armor: 1, magicResist: 5 }
      herbalists_apron:
        name: "Herbalist's Apron"
        item_id: herbalists_apron
        category: ARMOR
        slot: CHEST
        quality: FINE
        base_value: 50
        effects: { armor: 2, magicResist: 4 }
      archmages_robe:
        name: "Archmage's Robe"
        item_id: archmages_robe
        category: ARMOR
        slot: CHEST
        quality: SUPERIOR
        base_value: 150
        effects: { armor: 4, magicResist: 14 }
      diplomats_regalia:
        name: "Diplomat's Regalia"
        item_id: diplomats_regalia
        category: ARMOR
        slot: CHEST
        quality: SUPERIOR
        base_value: 140
        effects: { armor: 3, magicResist: 12 }
      silk_hood_of_insight:
        name: "Silk Hood of Insight"
        item_id: silk_hood_of_insight
        category: ARMOR
        slot: HEAD
        quality: SUPERIOR
        base_value: 90
        effects: { armor: 2, magicResist: 10 }
      nobles_leggings:
        name: "Noble's Leggings"
        item_id: nobles_leggings
        category: ARMOR
        slot: LEGS
        quality: SUPERIOR
        base_value: 95
        effects: { armor: 4, magicResist: 8 }
      enchanted_cloak:
        name: "Enchanted Cloak"
        item_id: enchanted_cloak
        category: ARMOR
        slot: CHEST
        quality: SUPERIOR
        base_value: 180
        effects: { armor: 5, magicResist: 16 }

  # --- PROCESSING RECIPES (5) ---

  spin-cloth:
    id: spin-cloth
    name: Cloth
    description: "Raw cotton spun into usable cloth. Legacy recipe kept for ARMORER supply chain."
    category: MATERIAL
    base_value: 8
    tier: 1
    level_required: 1
    profession: TAILOR
    xp_reward: 8
    inputs:
      - item_id: cotton
        quantity: 3
    outputs:
      - item_id: cloth
        quantity: 2
    notes: "KEPT — legacy ARMORER chain. Cotton → Cloth → Cloth Padding for metal armor."
    dependency_chain: "Cotton →[TAILOR]→ Cloth"

  # make-cloth-padding: REMOVED (2026-02-18)
  # Cloth Padding was unused by any downstream recipe. Removed to eliminate dead-end crafting path.
  # Legacy spin-cloth (Cotton→Cloth) kept for WOODWORKER housing-bed recipe.

  tai-weave-cloth:
    id: tai-weave-cloth
    name: Woven Cloth
    description: "Sturdy woven cloth from raw wool. The foundation of all tailored goods."
    category: MATERIAL
    base_value: 20
    tier: 1
    level_required: 3
    profession: TAILOR
    xp_reward: 10
    inputs:
      - item_id: wool
        quantity: 3
    outputs:
      - item_id: woven_cloth
        quantity: 2
    notes: "Core T1 intermediate. Used in all Apprentice and Journeyman cloth armor."
    dependency_chain: "Sheep →[RANCHER]→ Wool →[TAILOR]→ Woven Cloth"

  tai-weave-fine-cloth:
    id: tai-weave-fine-cloth
    name: Fine Cloth
    description: "Luxurious fabric woven from fine wool. Used in superior garments."
    category: MATERIAL
    quality: FINE
    base_value: 38
    tier: 3
    level_required: 7
    profession: TAILOR
    xp_reward: 18
    inputs:
      - item_id: fine_wool
        quantity: 3
    outputs:
      - item_id: fine_cloth
        quantity: 2
    notes: "T3 intermediate. Fine Wool from L7+ RANCHER sheep (bonus product)."
    dependency_chain: "Sheep (L7+) →[RANCHER]→ Fine Wool →[TAILOR L7]→ Fine Cloth"

  tai-process-silk:
    id: tai-process-silk
    name: Silk Fabric
    description: "Shimmering silk fabric with natural magic affinity. The finest textile in Aethermere."
    category: MATERIAL
    quality: FINE
    base_value: 45
    tier: 3
    level_required: 7
    profession: TAILOR
    xp_reward: 20
    inputs:
      - item_id: silkworm_cocoons
        quantity: 3
    outputs:
      - item_id: silk_fabric
        quantity: 2
    notes: "T3 intermediate. Silkworm Cocoons from RANCHER Silkworm House (250g auto-producer)."
    dependency_chain: "Silkworm House →[RANCHER]→ Silkworm Cocoons →[TAILOR L7]→ Silk Fabric"

  # --- TIER 1: APPRENTICE ARMOR (Level 3-4) ---

  tai-cloth-hood:
    id: tai-cloth-hood
    name: Cloth Hood
    description: "A simple cloth hood offering minor protection and some magical resistance."
    category: ARMOR
    slot: HEAD
    base_value: 25
    tier: 1
    level_required: 3
    profession: TAILOR
    xp_reward: 12
    inputs:
      - item_id: woven_cloth
        quantity: 2
    outputs:
      - item_id: cloth_hood
        quantity: 1
    effects:
      armor: 1
      magicResist: 3
    dependency_chain: "Wool →[TAILOR]→ Woven Cloth →[TAILOR]→ Cloth Hood"

  tai-cloth-sash:
    id: tai-cloth-sash
    name: Cloth Sash
    description: "A reinforced cloth sash with leather backing. Worn on the off hand for magical protection."
    category: ARMOR
    slot: OFF_HAND
    base_value: 20
    tier: 1
    level_required: 3
    profession: TAILOR
    xp_reward: 10
    inputs:
      - item_id: woven_cloth
        quantity: 1
      - item_id: cured_leather
        quantity: 1
    outputs:
      - item_id: cloth_sash
        quantity: 1
    effects:
      armor: 1
      magicResist: 2
    dependency_chain: "Wool →[TAILOR]→ Woven Cloth + Animal Pelts →[TANNER]→ Cured Leather →[TAILOR]→ Cloth Sash"

  tai-cloth-robe:
    id: tai-cloth-robe
    name: Cloth Robe
    description: "A basic cloth robe offering modest physical protection and decent magical resistance."
    category: ARMOR
    slot: CHEST
    base_value: 45
    tier: 1
    level_required: 4
    profession: TAILOR
    xp_reward: 15
    inputs:
      - item_id: woven_cloth
        quantity: 4
      - item_id: cured_leather
        quantity: 1
    outputs:
      - item_id: cloth_robe
        quantity: 1
    effects:
      armor: 2
      magicResist: 5
    dependency_chain: "Wool →[TAILOR]→ Woven Cloth + Cured Leather →[TAILOR]→ Cloth Robe"

  tai-wool-trousers:
    id: tai-wool-trousers
    name: Wool Trousers
    description: "Warm, sturdy woolen trousers. Practical and lightly enchantment-friendly."
    category: ARMOR
    slot: LEGS
    base_value: 30
    tier: 1
    level_required: 4
    profession: TAILOR
    xp_reward: 12
    inputs:
      - item_id: woven_cloth
        quantity: 3
    outputs:
      - item_id: wool_trousers
        quantity: 1
    effects:
      armor: 1
      magicResist: 3
    dependency_chain: "Wool →[TAILOR]→ Woven Cloth →[TAILOR]→ Wool Trousers"

  # --- TIER 2: JOURNEYMAN ARMOR (Level 5-6) ---

  tai-scholars-robe:
    id: tai-scholars-robe
    name: "Scholar's Robe"
    description: "An elegant robe favored by academics and hedge mages. Strong magical resistance."
    category: ARMOR
    slot: CHEST
    base_value: 70
    tier: 2
    level_required: 5
    profession: TAILOR
    xp_reward: 22
    inputs:
      - item_id: woven_cloth
        quantity: 5
      - item_id: cured_leather
        quantity: 2
    outputs:
      - item_id: scholars_robe
        quantity: 1
    effects:
      armor: 3
      magicResist: 8
    dependency_chain: "Wool →[TAILOR]→ Woven Cloth + Cured Leather →[TAILOR]→ Scholar's Robe"

  tai-travelers-cloak:
    id: tai-travelers-cloak
    name: "Traveler's Cloak"
    description: "A road-worn cloak with leather reinforcement. Balanced protection for the wanderer."
    category: ARMOR
    slot: CHEST
    base_value: 55
    tier: 2
    level_required: 5
    profession: TAILOR
    xp_reward: 20
    inputs:
      - item_id: woven_cloth
        quantity: 3
      - item_id: cured_leather
        quantity: 2
    outputs:
      - item_id: travelers_cloak
        quantity: 1
    effects:
      armor: 4
      magicResist: 5
    dependency_chain: "Wool →[TAILOR]→ Woven Cloth + Cured Leather →[TAILOR]→ Traveler's Cloak"

  tai-merchants-hat:
    id: tai-merchants-hat
    name: "Merchant's Hat"
    description: "A fashionable hat that marks one as a person of commerce. Subtly warded."
    category: ARMOR
    slot: HEAD
    base_value: 45
    tier: 2
    level_required: 6
    profession: TAILOR
    xp_reward: 18
    inputs:
      - item_id: woven_cloth
        quantity: 2
      - item_id: cured_leather
        quantity: 1
    outputs:
      - item_id: merchants_hat
        quantity: 1
    effects:
      armor: 1
      magicResist: 5
    dependency_chain: "Wool →[TAILOR]→ Woven Cloth + Cured Leather →[TAILOR]→ Merchant's Hat"

  tai-herbalists-apron:
    id: tai-herbalists-apron
    name: "Herbalist's Apron"
    description: "A leather-trimmed cloth apron with herb-stained pockets. Practical for fieldwork."
    category: ARMOR
    slot: CHEST
    base_value: 50
    tier: 2
    level_required: 6
    profession: TAILOR
    xp_reward: 20
    inputs:
      - item_id: woven_cloth
        quantity: 3
      - item_id: cured_leather
        quantity: 2
    outputs:
      - item_id: herbalists_apron
        quantity: 1
    effects:
      armor: 2
      magicResist: 4
    dependency_chain: "Wool →[TAILOR]→ Woven Cloth + Cured Leather →[TAILOR]→ Herbalist's Apron"

  # --- TIER 3: CRAFTSMAN ARMOR (Level 7-8) ---

  tai-archmages-robe:
    id: tai-archmages-robe
    name: "Archmage's Robe"
    description: "A magnificent robe of silk and fine cloth, thrumming with latent magical energy. The pinnacle of mage attire."
    category: ARMOR
    slot: CHEST
    base_value: 150
    tier: 3
    level_required: 7
    profession: TAILOR
    xp_reward: 35
    inputs:
      - item_id: fine_cloth
        quantity: 4
      - item_id: silk_fabric
        quantity: 2
      - item_id: wolf_leather
        quantity: 1
    outputs:
      - item_id: archmages_robe
        quantity: 1
    effects:
      armor: 4
      magicResist: 14
    dependency_chain: "Fine Wool →[TAILOR]→ Fine Cloth + Silkworm Cocoons →[TAILOR]→ Silk Fabric + Wolf Pelts →[TANNER]→ Wolf Leather →[TAILOR]→ Archmage's Robe"

  tai-diplomats-regalia:
    id: tai-diplomats-regalia
    name: "Diplomat's Regalia"
    description: "Resplendent formal attire threaded with silver. Commands respect in any court."
    category: ARMOR
    slot: CHEST
    base_value: 140
    tier: 3
    level_required: 7
    profession: TAILOR
    xp_reward: 32
    inputs:
      - item_id: silk_fabric
        quantity: 3
      - item_id: fine_cloth
        quantity: 2
      - item_id: silver_ore
        quantity: 1
    outputs:
      - item_id: diplomats_regalia
        quantity: 1
    effects:
      armor: 3
      magicResist: 12
    dependency_chain: "Silkworm Cocoons →[TAILOR]→ Silk Fabric + Fine Wool →[TAILOR]→ Fine Cloth + Silver Ore →[TAILOR]→ Diplomat's Regalia"

  tai-silk-hood-insight:
    id: tai-silk-hood-insight
    name: "Silk Hood of Insight"
    description: "A gossamer silk hood that sharpens the mind and shields it from magical intrusion."
    category: ARMOR
    slot: HEAD
    base_value: 90
    tier: 3
    level_required: 7
    profession: TAILOR
    xp_reward: 28
    inputs:
      - item_id: silk_fabric
        quantity: 2
      - item_id: fine_cloth
        quantity: 1
    outputs:
      - item_id: silk_hood_of_insight
        quantity: 1
    effects:
      armor: 2
      magicResist: 10
    dependency_chain: "Silkworm Cocoons →[TAILOR]→ Silk Fabric + Fine Wool →[TAILOR]→ Fine Cloth →[TAILOR]→ Silk Hood of Insight"

  tai-nobles-leggings:
    id: tai-nobles-leggings
    name: "Noble's Leggings"
    description: "Fine cloth trousers reinforced with wolf leather. Fit for nobility."
    category: ARMOR
    slot: LEGS
    base_value: 95
    tier: 3
    level_required: 8
    profession: TAILOR
    xp_reward: 28
    inputs:
      - item_id: fine_cloth
        quantity: 3
      - item_id: wolf_leather
        quantity: 2
    outputs:
      - item_id: nobles_leggings
        quantity: 1
    effects:
      armor: 4
      magicResist: 8
    dependency_chain: "Fine Wool →[TAILOR]→ Fine Cloth + Wolf Pelts →[TANNER]→ Wolf Leather →[TAILOR]→ Noble's Leggings"

  tai-enchanted-cloak:
    id: tai-enchanted-cloak
    name: "Enchanted Cloak"
    description: "A cloak of layered silk, fine cloth, and bear leather, infused with glowcap essence. The most powerful wearable ward in Aethermere."
    category: ARMOR
    slot: CHEST
    base_value: 180
    tier: 3
    level_required: 8
    profession: TAILOR
    xp_reward: 40
    inputs:
      - item_id: silk_fabric
        quantity: 3
      - item_id: fine_cloth
        quantity: 3
      - item_id: bear_leather
        quantity: 2
      - item_id: glowcap_mushrooms
        quantity: 1
    outputs:
      - item_id: enchanted_cloak
        quantity: 1
    effects:
      armor: 5
      magicResist: 16
    dependency_chain: "Silkworm Cocoons →[TAILOR]→ Silk Fabric + Fine Wool →[TAILOR]→ Fine Cloth + Bear Hides →[TANNER]→ Bear Leather + Glowcap Mushrooms →[TAILOR]→ Enchanted Cloak"
    notes: "Top-tier TAILOR item. Requires inputs from RANCHER (silk, fine wool), TANNER (bear leather), and HERBALIST (glowcap mushrooms) — 4-profession supply chain."


# =============================================================================
# SECTION 5: DEPENDENCY CHAINS (QUICK REFERENCE)
# =============================================================================
# Read these bottom-to-top: raw resource → ... → final product
# Arrow labels show which profession does the transformation.
# =============================================================================

dependency_chains:

  # --- FOOD CHAIN (FARMER + FISHERMAN + HERBALIST + LUMBERJACK → COOK) ---
  # NOTE: All COOK recipes require 1× Wood Logs as fuel (LUMBERJACK dependency)
  basic_food:
    Apple + Wood Logs ──[COOK]──→ Apple Sauce
    Grain + Wood Logs ──[COOK]──→ Porridge
    Grain + Wood Logs ──[COOK]──→ Flour (intermediate)
    Wild Berries + Wood Logs ──[COOK]──→ Berry Jam (intermediate)
    Raw Fish + Wood Logs ──[COOK]──→ Grilled Fish
    Wild Herbs + Wood Logs ──[COOK]──→ Herbal Tea
    Vegetables + Wood Logs ──[COOK]──→ Vegetable Stew

  livestock_food:
    Eggs ──[COOK]──→ Scrambled Eggs
    Grain + Milk ──[COOK]──→ Creamy Porridge
    Eggs + Milk + Grain ──[COOK]──→ Farm Breakfast

  advanced_food:
    Flour + Wood Logs ──[COOK]──→ Bread Loaf
    Flour + Apple + Wood Logs ──[COOK]──→ Apple Pie
    Raw Fish + Grain + Herbs ──[COOK L5]──→ Fish Stew
    Vegetables + Herbs + Wood Logs ──[COOK]──→ Seasoned Roast Vegetables
    Flour + Berry Jam + Wood Logs ──[COOK]──→ Berry Tart
    Raw Fish + Wild Herbs ──[COOK L5]──→ Grilled Fish           # UPDATED 2026-02-20
    Raw Fish + Wood Logs ──[COOK L6]──→ Smoked Fish             # ADDED 2026-02-20

  premium_food:
    Bread + Apple + Herbs + Wood Logs ──[COOK]──→ Harvest Feast
    Grilled Fish + Bread + Berry Jam + Wood Logs ──[COOK]──→ Fisherman's Banquet
    Flour + Herbs + Berry Jam + Wood Logs ──[COOK]──→ Spiced Pastry

  # --- FISH CHAIN (FISHERMAN L7+ → COOK L7-8) --- ADDED 2026-02-20
  premium_fish_food:
    River Trout + Wild Herbs + Apples ──[COOK L7]──→ Pan-Seared Trout
    Lake Perch + Grain + Wild Herbs ──[COOK L7]──→ Perch Feast
    River Trout + Lake Perch + Grain + Eggs ──[COOK L8]──→ Fisherman's Pie
    River Trout + Wood Logs ──[COOK L8]──→ Smoked Trout Rations
    note: "Requires L7+ FISHERMAN gathering River Trout (22g) and Lake Perch (25g). COOK is the ONLY consumer of fish resources — 5 suppliers total."

  # --- FUEL CHAIN (LUMBERJACK → COOK) ---
  fuel:
    note: "COOKs in non-forest towns must trade for wood. Creates LUMBERJACK→COOK dependency."

  # --- METAL CHAIN (MINER → SMELTER → BLACKSMITH/ARMORER) ---
  metal_weapons_endgame:
    Iron Ore ──[SMELTER]──→ Iron Ingot ──[BLACKSMITH]──→ Iron Sword / Axe / Tools (L1-L75 ingot recipes)
  metal_weapons_earlygame:
    Iron Ore Chunks + Wood Logs ──[BLACKSMITH]──→ Iron Tools / Weapons / Armor (L3-L8 raw-ore recipes)
    Coal + Iron Ore Chunks ──[BLACKSMITH]──→ Steel Tools / Weapons / Armor (L5-L6, Coal from private mine)
    Silver Ore + Hardwood ──[BLACKSMITH@L7]──→ Specialist gear (Toolsmith / Weaponsmith / Armorer branch)
  metal_armor:
    Iron Ore ──[SMELTER]──→ Iron Ingot ──[ARMORER]──→ Chain Mail / Shield
    Raw Hide ──[TANNER]──→ Leather ──[ARMORER]──→ Reinforced Armor (ingot + leather)

  # --- LEATHER CHAIN (HUNTER → TANNER → goods / LEATHERWORKER / ARMORER) ---
  leather_processing:
    Animal Pelts ──[TANNER L3]──→ Cured Leather (shared intermediate — also sold to TAILOR)
    Wolf Pelts ──[TANNER L7]──→ Wolf Leather
    Bear Hides ──[TANNER L7]──→ Bear Leather

  leather_apprentice_goods:
    Cured Leather ──[TANNER L3]──→ Leather Cap (HEAD, 30g)
    Cured Leather + Animal Pelts ──[TANNER L3]──→ Leather Satchel (CONSUMABLE, +1 DEX/5 ticks)
    Cured Leather ──[TANNER L4]──→ Leather Vest (CHEST, 45g)
    Cured Leather ──[TANNER L4]──→ Leather Belt (LEGS, 25g)

  leather_journeyman_goods:
    Cured Leather + Animal Pelts ──[TANNER L5]──→ Leather Armor (CHEST, 65g)
    Cured Leather ──[TANNER L5]──→ Leather Bracers (OFF_HAND, 40g)
    Cured Leather + Animal Pelts ──[TANNER L6]──→ Leather Greaves (LEGS, 50g)
    Cured Leather + Animal Pelts ──[TANNER L6]──→ Quiver (TOOL, +25% hunting yield, 35 dur)

  leather_craftsman_goods:
    Wolf Leather + Cured Leather ──[TANNER L7]──→ Wolf Leather Armor (CHEST, 120g)
    Wolf Leather + Cured Leather ──[TANNER L7]──→ Wolf Leather Hood (HEAD, 75g)
    Bear Leather + Cured Leather + Animal Pelts ──[TANNER L8]──→ Bear Hide Cuirass (CHEST, 155g)
    Wolf Leather + Cured Leather + Bear Hides ──[TANNER L8]──→ Ranger's Quiver (TOOL, +40% hunting yield, 50 dur)

  leatherworker_goods:
    Cured Leather ──[LEATHERWORKER L1-L8]──→ Leather Gloves (HANDS) / Boots (FEET) / Backpack (BACK) / Waterskin
    Wolf Leather + Cured Leather ──[LEATHERWORKER L12-L22]──→ Wolf Leather Gloves / Boots / Toolbelt / Repair Kit / Ranger's Pack
    Bear Leather + Wolf Leather ──[LEATHERWORKER L28-L40]──→ Bear Hide Vambraces / Bear Leather Boots / Hunter's Kit / Explorer's Pack

  leather_future:
    Cured Leather ──[ARMORER]──→ Reinforced Armor (ingot + leather, future)

  # --- WOOD CHAIN (LUMBERJACK → WOODWORKER → FLETCHER) ---
  wood_goods:
    Wood Logs ──[WOODWORKER]──→ Planks / Handles ──[FLETCHER]──→ Bows / Arrows
    Wood Logs ──[WOODWORKER]──→ Furniture / Tools

  # --- MAGIC CHAIN (HERBALIST → ALCHEMIST → ENCHANTER) ---
  magic_items:
    Wild Herbs + Wild Berries + Clay ──[ALCHEMIST T1-T2]──→ Potions (heal, buff, cure)
    Medicinal Herbs + Glowcap Mushrooms + Clay ──[ALCHEMIST T3]──→ Greater Potions / Elixirs
    Potions / Reagents ──[ENCHANTER]──→ Enchanted Items (future)

  # --- TEXTILE CHAIN (RANCHER → TAILOR) ---
  # UPDATED: TAILOR profession LIVE — full textile chain implemented
  textile_processing:
    Sheep ──[RANCHER auto]──→ Wool ──[TAILOR L3]──→ Woven Cloth (core T1 intermediate)
    Sheep (L7+) ──[RANCHER]──→ Fine Wool ──[TAILOR L7]──→ Fine Cloth (T3 intermediate)
    Silkworm House ──[RANCHER auto]──→ Silkworm Cocoons ──[TAILOR L7]──→ Silk Fabric (T3 intermediate)
    Cotton ──[TAILOR L1]──→ Cloth ──[TAILOR L3]──→ Cloth Padding ──[ARMORER]──→ Metal Armor (legacy chain)

  textile_apprentice_goods:
    Woven Cloth ──[TAILOR L3]──→ Cloth Hood (HEAD, 25g, armor:1 magicResist:3)
    Woven Cloth + Cured Leather ──[TAILOR L3]──→ Cloth Sash (OFF_HAND, 20g, armor:1 magicResist:2)
    Woven Cloth + Cured Leather ──[TAILOR L4]──→ Cloth Robe (CHEST, 45g, armor:2 magicResist:5)
    Woven Cloth ──[TAILOR L4]──→ Wool Trousers (LEGS, 30g, armor:1 magicResist:3)

  textile_journeyman_goods:
    Woven Cloth + Cured Leather ──[TAILOR L5]──→ Scholar's Robe (CHEST, 70g, armor:3 magicResist:8)
    Woven Cloth + Cured Leather ──[TAILOR L5]──→ Traveler's Cloak (CHEST, 55g, armor:4 magicResist:5)
    Woven Cloth + Cured Leather ──[TAILOR L6]──→ Merchant's Hat (HEAD, 45g, armor:1 magicResist:5)
    Woven Cloth + Cured Leather ──[TAILOR L6]──→ Herbalist's Apron (CHEST, 50g, armor:2 magicResist:4)

  textile_craftsman_goods:
    Fine Cloth + Silk Fabric + Wolf Leather ──[TAILOR L7]──→ Archmage's Robe (CHEST, 150g, armor:4 magicResist:14)
    Silk Fabric + Fine Cloth + Silver Ore ──[TAILOR L7]──→ Diplomat's Regalia (CHEST, 140g, armor:3 magicResist:12)
    Silk Fabric + Fine Cloth ──[TAILOR L7]──→ Silk Hood of Insight (HEAD, 90g, armor:2 magicResist:10)
    Fine Cloth + Wolf Leather ──[TAILOR L8]──→ Noble's Leggings (LEGS, 95g, armor:4 magicResist:8)
    Silk Fabric + Fine Cloth + Bear Leather + Glowcap Mushrooms ──[TAILOR L8]──→ Enchanted Cloak (CHEST, 180g, armor:5 magicResist:16)

  # --- BUILDING CHAIN (MINER + LUMBERJACK → MASON) ---
  buildings:
    Stone Blocks + Wood Logs + Clay ──[MASON]──→ Building Materials → Housing System

  # --- KNOWLEDGE CHAIN (LUMBERJACK + HERBALIST → SCRIBE) ---
  scrolls:
    Wood Logs ──[SCRIBE]──→ Paper + Wild Herbs ──[SCRIBE]──→ Ink → Scrolls / Maps / Books


# =============================================================================
# SECTION 6: ECONOMY RULES
# =============================================================================

economy_rules:

  value_chain:
    principle: "Each profession step adds value"
    example: "Apple (3g) → Apple Sauce (8g) → Apple Pie (18g) → Harvest Feast (35g)"
    rule: "Crafted output base_value > sum of input base_values"

  rancher_economy:
    principle: "RANCHER is a gold-sink profession that generates passive items via livestock"
    chain: "FARMER →[gather]→ Grain →[RANCHER feed]→ Eggs/Milk/Wool →[COOK]→ meals"
    gold_sinks: "Buildings (100-150g), livestock (30-80g), ongoing Grain feed"
    grain_dependency: "RANCHERs must buy Grain from FARMERs or marketplace — creates cross-profession demand"
    risk: "Animals die from starvation, old age, disease, predator — ongoing investment needed"

  # UPDATED: 2026-02-17 — Single-town residency model
  housing_economy:
    principle: "Single-town residency — players own one home with storage in their resident town only"
    home_town: "Free Tier 1 cottage at character creation (auto-granted via giveStarterHouse)"
    multi_town: "REMOVED — players cannot buy houses in other towns"
    relocation: "500g to change home town (must be physically present, 30 game-day cooldown, all old property lost)"
    storage: "20 slots per cottage (each unique item type = 1 slot, unlimited quantity per slot)"
    remote_listing: "Items in house storage can be listed on the town's market from anywhere (free action)"
    future: "Tier 2-4 upgrades (500g-5000g) will increase storage slots and add rooms"

  tanner_economy:
    principle: "TANNER is a two-step pipeline profession: pelts → leather → goods"
    chain: "HUNTER →[gather]→ Animal Pelts / Wolf Pelts / Bear Hides →[TANNER cure]→ Cured Leather / Wolf Leather / Bear Leather →[TANNER craft]→ Armor / Tools / Goods →[Market]"
    shared_intermediate: "Cured Leather is a shared intermediate — TAILOR will buy Cured Leather for cloth-leather hybrid gear. This creates cross-profession demand beyond TANNER's own recipes."
    player_choice: "Leather armor offers less raw defense (AC) than equivalent metal armor, but grants DEX bonuses. Players choose based on build: heavy fighters prefer BLACKSMITH plate, rogues and rangers prefer TANNER leather."
    economic_chain: "HUNTER → TANNER → Market. HUNTERs sell pelts to TANNERs. TANNERs sell Cured Leather to TAILORs and finished leather goods to players. Quiver/Ranger's Quiver create a TANNER→HUNTER feedback loop (tools that boost the gatherer who supplies the crafter)."
    tool_feedback: "Quiver (+25% hunting yield, 35 dur) and Ranger's Quiver (+40% hunting yield, 50 dur) are TANNER-crafted TOOL items that equip in the HUNTER's TOOL slot. This creates circular demand: HUNTER needs TANNER tools, TANNER needs HUNTER pelts."

  tailor_economy:
    principle: "TAILOR is a marketplace-dependent dual-supply crafter — buys from RANCHER + TANNER"
    chain: "RANCHER →[auto-produce]→ Wool / Fine Wool / Silkworm Cocoons →[TAILOR process]→ Woven Cloth / Fine Cloth / Silk Fabric →[TAILOR craft]→ Cloth Armor →[Market]"
    dual_supply: "TAILOR requires Wool from RANCHER AND Cured Leather from TANNER for most recipes. This creates demand on two separate profession chains simultaneously."
    intermediates:
      woven_cloth: "T1 intermediate (20g) — used in all Apprentice and Journeyman armor. From Wool."
      fine_cloth: "T3 intermediate (38g) — used in all Craftsman armor. From Fine Wool (RANCHER L7+ sheep bonus)."
      silk_fabric: "T3 intermediate (45g) — used in top-tier armor. From Silkworm Cocoons (RANCHER Silkworm House)."
    armor_triangle:
      principle: "Three armor crafters serve different builds"
      BLACKSMITH: "Plate armor — highest AC, STR focus, heavy and expensive"
      TANNER: "Leather armor — moderate AC + DEX bonuses, balanced weight"
      TAILOR: "Cloth armor — lowest AC but highest magicResist, for mages/healers/diplomats (INT/WIS/CHA builds)"
    silkworm_house:
      principle: "Non-livestock auto-producing building — no animals to buy or feed"
      cost: 250
      level_required: 7
      product: "Silkworm Cocoons (38g)"
      note: "Gold sink for RANCHER Craftsman tier. Auto-produces cocoons every 3 ticks without livestock management overhead."
    fine_wool:
      principle: "Bonus product from L7+ RANCHER sheep alongside regular Wool"
      source: "Sheep Pen (L7+ RANCHER)"
      value: 30
      note: "Incentivizes RANCHER to level up — higher-level sheep produce both Wool and Fine Wool."
    player_choice: "Cloth armor has the lowest physical defense but highest magicResist. Mages, clerics, and diplomats prefer cloth. Warriors and rogues prefer plate or leather. This creates three distinct armor demand markets."

  scarcity_by_region:
    principle: "Different towns produce different resources"
    rule: "No town has all resource types. Players must travel or trade."
    example: "Ironvault has mines but no orchards. Must buy food from Heartlands."
    wood_scarcity: "COOKs in non-forest towns (no forest gathering spot) must buy Wood Logs from LUMBERJACKs or the marketplace. Creates cross-profession trade pressure."

  profession_limit:
    max_per_character: 3
    principle: "No self-sufficiency"
    example: "FARMER + COOK + MERCHANT = gather crops, cook food, sell it well"
    counter: "But they can't mine, smelt, or smith — need other players for weapons"

  durability_and_consumption:
    principle: "Items break or are consumed, creating perpetual demand"
    food: "Consumed on use — gone forever"
    equipment: "Has durability — breaks after use, needs repair or replacement"
    tools: "50-200 durability (by tier). -1 per gather action. Break at 0. Creates constant demand for BLACKSMITH crafted tools."
    potions: "Single use"
    buildings: "Require upkeep materials"

  equipment_system:
    principle: "6 equipment slots with computed combat stats"
    slots:
      WEAPON: { db_slot: MAIN_HAND, accepts: WEAPON }
      OFF_HAND: { db_slot: OFF_HAND, accepts: "WEAPON (shields) or ARMOR (shields)" }
      HEAD: { db_slot: HEAD, accepts: ARMOR }
      BODY: { db_slot: CHEST, accepts: ARMOR }
      LEGS: { db_slot: LEGS, accepts: ARMOR }
      TOOL: { db_slot: TOOL, accepts: TOOL }
    equip_action: "FREE — no daily action consumed"
    auto_swap: "Equipping to occupied slot automatically returns old item to inventory"
    computed_stats:
      totalDamage: "Sum of weapon damage stats"
      totalAC: "Sum of armor defense stats"
      totalStatBonuses: "Aggregated STR/DEX/CON/INT/WIS/CHA from equipment"
    tool_mechanics:
      yield_bonus: "Tools grant yieldBonus to matching profession gathering (5-25% by tier)"
      bare_hands_penalty: "No tool equipped = -25% yield on profession gathering"
      durability: "Tools lose 1 durability per gather action. Break at 0, auto-unequipped."
      profession_match: "Tool must match the gathering profession (Pickaxe for MINER, Hoe for FARMER, etc.)"
    bot_behavior:
      free_action: "A2 in sim engine — bots auto-equip matching tool before gathering"
      buy_from_market: "Bots buy tools from market if none in inventory (30% of gold max)"
      tool_replacement: "Broken tools detected on next tick, replacement purchased automatically"
    gold_sink: "Tool breakage creates ongoing demand for BLACKSMITH-crafted tools"

  quality_system:
    formula: "d20 + (ProfessionLevel / 5) + ToolBonus + WorkshopBonus + TierQualityBonus"
    tiers: [Poor, Common, Fine, Superior, Masterwork, Legendary]
    effect: "Higher quality = better stats/effects + higher sell value"
    tier_quality_bonus:
      APPRENTICE: 0
      JOURNEYMAN: 1
      CRAFTSMAN: 2
      EXPERT: 3
      MASTER: 4
      GRANDMASTER: 5
    note: "Applies to crafting. Gathering yield uses tier_yield_bonus instead."

  tier_yield_bonus:
    description: "Gathering professions get yield multiplier based on profession tier"
    APPRENTICE: "+0% (base yield)"
    JOURNEYMAN: "+25%"
    CRAFTSMAN: "+50%"
    EXPERT: "+75%"
    MASTER: "+100%"
    GRANDMASTER: "+150%"
    formula: "finalQuantity = ceil(baseQuantity * (1 + tierBonus))"
    note: "Only applies to unlocked spot types. Replaces old flat +50% bonus."

  # UPDATED: 2026-02-16 — Market buying fix
  simulation_market:
    mode: "Auction-based (buy orders → auction resolution each tick)"
    one_pass_cycle:
      step_1: "All bots list surplus items (free action, items exceeding keepItems threshold)"
      step_2: "All bots attempt one buy for missing crafting ingredients (free action)"
      auction_resolution: "Phase 4 of tick resolves buy orders — winner gets item, loser refunded"
    keepItems_logic: "Only keep items needed for THIS BOT's own profession recipes (not all recipes)"
    buy_search: "Global market search (no town filter) — any bot can buy any listing"
    pricing: "Sellers list at 15g flat. Buyers bid at asking + 15% (17g). Fee: 1g per transaction."


# =============================================================================
# SECTION 7: IMPLEMENTATION PRIORITY
# =============================================================================

implementation_order:

  # UPDATED: 2026-02-15
  phase_1:
    name: "FARMER + COOK (Food Chain)"
    status: COMPLETE
    completed_date: 2026-02-15
    tasks:
      - "✓ Add grain_field and vegetable_patch gathering spots (3 grain, 2 vegetable towns)"
      - "✓ Define all COOK recipe items in item registry (17 items)"
      - "✓ Seed 15 COOK recipes in database (7 T1 + 5 T2 + 3 T3)"
      - "✓ FARMER yield bonus: +50% at orchard, berry, grain_field, vegetable_patch"
      - "✓ Daily tick reorder: crafting before auto-consumption"
      - "✓ Update sim bots: COOK craft-first, FARMER gather-only"
      - "✓ Verified in 40-tick simulation (25 bots, 1000 actions, 0 errors)"
    notes: "COOK bot Henrik crafted Grilled Fish at ticks 20, 34, 37. All 4 COOKs properly prioritize crafting."

  # UPDATED: 2026-02-16
  simulation_intelligence_rewrite:
    name: "Simulation Intelligence Rewrite"
    status: COMPLETE
    completed_date: 2026-02-16
    description: "Full rewrite of bot decision engine with priority-based intelligence"
    verification_run:
      config: "25 bots, diverse L1-L7 start, 200g starting gold, 50 ticks"
      total_actions: 1250
      errors: 0
      success_rate: "100%"
      action_breakdown:
        gather: "79.4%"
        travel: "4.7%"
        travel_in_transit: "7.2%"
        craft: "1.0%"
        profession: "1.9%"
      true_idle_rate: "0% (all 'idle' entries were bots in transit, categorized correctly after fix)"
      profession_distribution:
        FARMER: 11
        COOK: 5
        MINER: 2
        FISHERMAN: 2
        LUMBERJACK: 2
        HUNTER: 1
        RANCHER: 1
        HERBALIST: 1
      cook_performance: "13 successful crafts, travel purposefully to ingredient/wood towns"
      avg_level_after_50_ticks: 8.2
      total_gold: "5013 across 25 bots (70g earned, 57g spent)"
      decision_logging: "Priority-based decisions logged with P-numbers and reason strings"
    tasks:
      - "✓ Rewrote bot decision engine with priority-based intelligence"
      - "✓ All 25 bots learned professions (11 FARMER, 5 COOK, 2 MINER, 2 FISHERMAN, 2 LUMBERJACK, 1 HUNTER, 1 RANCHER, 1 HERBALIST)"
      - "✓ COOK bots travel purposefully to ingredient/wood towns, 13 successful crafts"
      - "✓ True idle rate 0% — all bots active or correctly categorized as in-transit"
      - "✓ Verified in 50-tick simulation (25 bots, 1250 actions, 0 errors, 100% success rate)"

  # UPDATED: 2026-02-16
  round_2_bug_fixes:
    name: "Simulation Bug Fixes Round 2"
    status: COMPLETE
    completed_date: 2026-02-16
    description: "Fixed 8 bugs (6 original + 2 discovered during verification) affecting market, travel, assets, profession XP, and economy"
    bugs_fixed:
      - "Bug 1: Baked Apples orphan recipe — deleted orphan DB recipe that referenced non-existent item template"
      - "Bug 2: Dead market — fixed wrong inventory endpoint (/items/inventory → /characters/me/inventory) in 5 places"
      - "Bug 3: Eliminated travel — fixed missing explore/seek-ingredients travel reasons in engine"
      - "Bug 4: Failed asset purchases — fixed profession level check and asset availability query"
      - "Bug 5: Missing profession bonuses — fixed GATHER_SPOT_PROFESSION_MAP missing entries"
      - "Bug 6: Frozen economy — auction engine timing bypass for simulation mode"
      - "Bug 7: Wrong inventory endpoint — all 5 sim action inventory calls hit non-existent route (discovered during verification)"
      - "Bug 8: No profession XP in spot-based gathering — processGatherSpotAction never called addProfessionXP (discovered during verification)"
    verification_run:
      config: "50 bots, diverse L1-L7 start, 200g starting gold, 60 ticks"
      total_actions: 3000
      errors: 0
      success_rate: "100%"
      action_breakdown:
        gather: 2400
        travel: 455
        craft: 55
        market_list: 1489
        market_buy: 0
        road_encounter: 33
        profession: 50
        buy_asset: 19
      crafting_verification:
        total_crafts: 55
        recipes_used: [Porridge, "Berry Jam", "Grill Fish"]
        baked_apples: 0
        orphan_recipes: 0
        note: "All crafts use canonical recipes only — Baked Apples confirmed eliminated"
      market_verification:
        listings: 1489
        buys: 0
        note: "Market infrastructure works. Zero buys due to keepItems bug (fixed in market_buy_fix phase)."
      travel_verification:
        total_travels: 455
        bots_multi_town: 22
        road_encounters: 33
        exploring_reason: 0
        note: "All travel is purposeful (ingredient sourcing, field management, profession-based)"
      asset_verification:
        total_purchases: 19
        by_profession: { FARMER: 8, MINER: 5, HERBALIST: 3, LUMBERJACK: 1, FISHERMAN: 1, OTHER: 1 }
        note: "Profession XP fix enabled bots to reach L3 threshold for T1 assets"
      profession_bonus_verification:
        FARMER: 423
        MINER: 246
        HERBALIST: 200
        LUMBERJACK: 53
        FISHERMAN: 51
        note: "All gathering professions receive bonus yield at matching spots"
      economy_verification:
        starting_gold: 10000
        current_gold: 8594
        gold_earned: 609
        gold_spent: 2015
        note: "Gold is circulating — earned from market sales, spent on assets and market purchases"
      level_distribution:
        average: 9.66
        range: "6-13"
        breakdown: { L6: 3, L7: 5, L8: 7, L9: 9, L10: 8, L11: 7, L12: 7, L13: 4 }
      profession_distribution:
        COOK: 12
        FARMER: 11
        HERBALIST: 7
        MINER: 7
        HUNTER: 5
        RANCHER: 3
        FISHERMAN: 3
        LUMBERJACK: 2
    tasks:
      - "✓ Deleted Baked Apples orphan recipe from database seed"
      - "✓ Fixed inventory endpoint in 5 sim action functions"
      - "✓ Fixed travel reason engine for explore/ingredient-seeking"
      - "✓ Fixed asset purchase profession level checks"
      - "✓ Fixed GATHER_SPOT_PROFESSION_MAP completeness"
      - "✓ Fixed auction engine sim-mode timing bypass"
      - "✓ Added profession XP grant to processGatherSpotAction in daily-tick.ts"
      - "✓ Verified 60-tick simulation: 50 bots, 3000 actions, 0 errors"

  # UPDATED: 2026-02-16
  market_buy_fix:
    name: "Market Buy Fix (Zero Purchases → Full Economic Loop)"
    status: COMPLETE
    completed_date: 2026-02-16
    description: "Fixed 7 root causes preventing bot market purchases. Unlocked full economic loop: gather → list → buy → craft → sell."
    bugs_fixed:
      - "Root Cause 1: buySpecificItem used HTTP API (local, town-scoped) — rewrote to direct Prisma DB query (global market)"
      - "Root Cause 2: resolveAllTownAuctions pre-filtered auction cycles by age in sim mode — fixed to check getSimulationTick()"
      - "Root Cause 3: Field name mismatch (inputs vs ingredients) in recipe parsing — fixed in actions.ts and engine.ts"
      - "Root Cause 4: No profession filter — /crafting/recipes returns ALL 161 recipes, COOK bot tried to buy SMELTER ingredients"
      - "Root Cause 5: Only tried missing[0] — changed to iterate ALL missing items with raw material priority"
      - "Root Cause 6: keepItems too broad — built from ALL profession recipes, blocking ALL raw materials from listings"
      - "Root Cause 7: Cleanup FK constraint — reordered deletion (BuyOrders → TradeTransactions → MarketListings → Items)"
    verification_run:
      config: "25 bots, L1 start, 200g starting gold, 60 ticks"
      total_actions: 2042
      errors: 0
      success_rate: "97.7% (46 expected buy failures — no supply for some items)"
      action_breakdown:
        gather: 1017
        market_list: 453
        market_buy: "90 (44 successful, 46 no-supply)"
        market_auction: 16
        craft: 72
        travel: 373
        travel_arrived: 126
        road_encounter: 34
        profession: 25
      market_verification:
        listings: 453
        buy_attempts: 90
        buy_success: 44
        auction_resolutions: 16
        unique_items_listed: 9
        items_listed: [Apples, Vegetables, Grain, "Wood Logs", "Wild Herbs", "Iron Ore Chunks", "Stone Blocks", Clay, "Wild Berries"]
        items_bought: [Apples, Vegetables, "Wild Herbs"]
        gold_earned_by_sellers: 579
        gold_spent_total: 1551
      crafting_verification:
        total_crafts: 72
        cooks_crafting: 2
        recipes_used: ["Apple Sauce", "Vegetable Stew", "Grill Fish"]
      economic_loop_traced: "FARMER gathers Apples → lists on market → COOK buys → crafts Apple Sauce. Gold flows between bots."
      level_distribution:
        range: "L3-L9"
        breakdown: { L3: 1, L4: 1, L5: 2, L6: 8, L7: 3, L8: 2, L9: 8 }
      gold_distribution:
        range: "12g-277g"
        average: 162
        total: 4056
      profession_distribution:
        FARMER: 9
        COOK: 2
        HERBALIST: 4
        MINER: 2
        LUMBERJACK: 4
        FISHERMAN: 2
        RANCHER: 2
    tasks:
      - "✓ Rewrote buySpecificItem to use direct Prisma DB query (global market search)"
      - "✓ Fixed auction resolution timing for simulation mode"
      - "✓ Fixed recipe field name mismatch (inputs/ingredients)"
      - "✓ Added profession filter to buy logic (only buy ingredients for own recipes)"
      - "✓ Iterate all missing ingredients, not just first"
      - "✓ Scoped keepItems to bot's own profession recipes (ROOT CAUSE)"
      - "✓ Fixed cleanup FK constraint ordering"
      - "✓ Added stopRequested flag to runTicks for graceful stop"
      - "✓ Verified 60-tick simulation: 25 bots, 2042 actions, full economic loop working"

  # UPDATED: 2026-02-16 (tiers), 2026-02-17 (gathering spot redesign)
  universal_tier_system:
    name: "Universal Profession Tier System + All Gathering Professions"
    status: COMPLETE
    completed_date: 2026-02-17
    description: "Tier-scaled yield system. All 7 gathering professions formalized. grain_field/vegetable_patch/berry removed as public spots. hunting_ground added."
    changes:
      - "Profession tiers: APPRENTICE [3-4], JOURNEYMAN [5-6], CRAFTSMAN [7-8], EXPERT [9-10], MASTER [11-12], GRANDMASTER [13+]"
      - "Tier yield bonuses: +0%, +25%, +50%, +75%, +100%, +150%"
      - "Tier quality bonuses: +0, +1, +2, +3, +4, +5"
      - "FARMER: APPRENTICE=orchard only, private fields for Grain/Vegetables/Berries"
      - "HUNTER: APPRENTICE=hunting_ground (LIVE — no longer NOT_YET_IMPLEMENTED)"
      - "RANCHER: APPRENTICE + JOURNEYMAN LIVE (buildings, livestock, feed/produce in daily tick)"
      - "MINER/LUMBERJACK/HERBALIST/FISHERMAN: APPRENTICE live, higher tiers NOT_YET_IMPLEMENTED"
      - "9 towns reassigned: 4→orchard, 1→fishing, 4→hunting_ground"
      - "Asset tiers: T1=L3 (Apprentice), T2=L7 (Craftsman), T3=L11 (Master)"
      - "Simulation bots tier-aware: getProfSpotTypes uses getUnlockedSpotTypes()"
      - "Codex shows tier level ranges, yield bonus %, Coming Soon badges"
    files_modified:
      - "shared/src/data/professions/tiers.ts — level ranges updated"
      - "shared/src/data/professions/xp-curve.ts — getTierForLevel() updated"
      - "shared/src/data/professions/tier-unlocks.ts — NEW: unlock tables + helpers"
      - "shared/src/data/professions/gathering.ts — FARMER tierUnlocks updated"
      - "shared/src/data/professions/index.ts — new exports"
      - "shared/src/data/assets.ts — T2=L7, T3=L11, FIELD_TIER_CROPS"
      - "server/src/jobs/daily-tick.ts — universal tier bonus via getGatheringBonus()"
      - "server/src/lib/simulation/engine.ts — tier-aware getProfSpotTypes()"
      - "server/src/lib/simulation/actions.ts — professionLevels populated"
      - "server/src/lib/simulation/types.ts — professionLevels added to BotState"
      - "client/src/components/codex/CodexProfessions.tsx — tier display enhanced"
    verification_run:
      config: "20 bots, diverse L1-L7 start, 200g starting gold, 47 ticks"
      total_actions: 1380
      gathering_success_rate: "100% (434/434 gather actions)"
      farmer_tier_gating: "FARMER P4 at orchards, MINER P4 at quarry/clay, COOK P4 at fishing (for ingredients)"
      profession_travel: "HUNTER bots correctly seek hunting_ground towns, FARMER bots seek orchards"
      old_spots_eliminated: "0 references to grain_field/vegetable_patch/berry as public spots"
      other_professions: "MINER, HERBALIST, FISHERMAN, LUMBERJACK — all correct"
      errors: "0 gathering errors across 1332 actions"
    verification_ca52:
      config: "50 bots, diverse L1 start, 0g starting gold, 17+ ticks"
      total_actions: 1332
      gathering_success_rate: "100% (760/760 gather actions)"
      hunting_ground: "12 Wild Game Meat gathers at Alehearth Mountain Game Trails"
      professions_learned: "FARMER, MINER, FISHERMAN, HERBALIST, LUMBERJACK, COOK, RANCHER, HUNTER — all 8 seen"
      p4_examples: "FARMER→orchard, MINER→quarry/clay, COOK→fishing (ingredient-driven)"
      old_spots: "0 references to removed public spots"
      errors: "0 errors across all 1332 actions"

  # UPDATED: 2026-02-17 — Single-town residency + relocation
  housing_system:
    name: "Single-Town Residency — Houses with Storage Rooms"
    status: COMPLETE
    completed_date: 2026-02-17
    description: "Single-town residency model. One free Tier 1 cottage in home town only. 500g relocation to change home town (30-day cooldown, lose all old property)."
    changes:
      - "New Prisma models: House (@@unique characterId+townId), HouseStorage (normalized, @@unique houseId+itemTemplateId)"
      - "Free cottage granted at character creation and bot seed (giveStarterHouse helper)"
      - "Multi-town house buying REMOVED — POST /api/houses/buy returns 410 Gone"
      - "Building construction restricted to home town (POST /buildings/request-permit checks homeTownId)"
      - "Storage deposit/withdraw (in-town only) + remote market listing (from anywhere, free action)"
      - "Relocation system: POST /api/relocate/preview + POST /api/relocate/confirm"
      - "Relocation: 500g cost, 30 game-day cooldown, deletes all old-town property atomically"
      - "Character.lastRelocationGameDay field for cooldown tracking"
      - "GET /characters/me now returns homeTownName"
      - "TownPage: housing tile only shows for home town residents"
      - "HousingPage: single-town 'My Home' command center (always accessible from sidebar)"
      - "TownHallPage: relocation UI section for non-resident visitors"
    files_modified:
      - "database/prisma/schema.prisma — House, HouseStorage models, lastRelocationGameDay on Character"
      - "server/src/lib/starting-house.ts — giveStarterHouse helper"
      - "server/src/routes/houses.ts — 6 endpoints (buy disabled as 410)"
      - "server/src/routes/relocate.ts — NEW: preview + confirm relocation"
      - "server/src/routes/buildings.ts — homeTownId residency check on request-permit"
      - "server/src/routes/characters.ts — homeTown include, homeTownName in /me response"
      - "server/src/routes/index.ts — register relocate router"
      - "client/src/pages/TownPage.tsx — housing tile home-town only"
      - "client/src/pages/HousingPage.tsx — single-town My Home view"
      - "client/src/pages/TownHallPage.tsx — relocation UI for non-residents"
      - "client/src/components/layout/Sidebar.tsx — Housing always accessible"
      - "client/src/components/housing/HouseView.tsx — storage view component"
    future:
      - "Tier 2-4 upgrades (more storage, workshop room, display room)"
      - "Jobs Board integration (hired worker output → house storage)"

  equipment_system:
    name: "Basic Equipment System — 6 Slots + Tool Integration"
    status: COMPLETE
    completed_date: 2026-02-19
    description: "6-slot equipment system with dedicated TOOL slot, computed combat stats, tool yield bonuses, and simulation bot support."
    changes:
      - "New EquipSlot enum value: TOOL (separate from MAIN_HAND for weapons)"
      - "ITEM_TYPE_SLOT_MAP: TOOL items → TOOL slot (not MAIN_HAND)"
      - "Tool yield bonus integrated into spot-based gathering (processGatherSpotAction)"
      - "Bare-hands penalty: -25% yield when no tool equipped for matching profession"
      - "Tool durability decrement + break handling in spot-based gathering"
      - "InventoryPage.tsx rewritten: real API endpoints, 6 primary equipment slots, equip confirmation, combat stats"
      - "ProfilePage.tsx: equipment panel showing all 6 slots + combat stats (own profile only)"
      - "Simulation: ensureToolEquipped action (check → inventory → market buy → equip)"
      - "Simulation: A2 free action in engine — bots auto-equip matching tool before gathering"
      - "BLACKSMITH tools listed on market via existing surplus-listing mechanism"
    files_modified:
      - "database/prisma/schema.prisma — TOOL added to EquipSlot enum"
      - "database/prisma/migrations/20260219100000_add_tool_equip_slot — migration SQL"
      - "server/src/routes/equipment.ts — TOOL slot mapping"
      - "server/src/routes/tools.ts — TOOL slot (was MAIN_HAND)"
      - "server/src/routes/work.ts — getEquippedTool uses TOOL slot"
      - "server/src/routes/crafting.ts — craft tool bonus uses TOOL slot"
      - "server/src/jobs/daily-tick.ts — spot-based tool integration + TOOL slot references"
      - "server/src/lib/simulation/actions.ts — ensureToolEquipped, equipTool, checkEquippedTool"
      - "server/src/lib/simulation/engine.ts — A2 free action for tool management"
      - "client/src/pages/InventoryPage.tsx — full equipment UI rewrite"
      - "client/src/pages/ProfilePage.tsx — equipment panel + combat stats"

  phase_2:
    name: "MINER → SMELTER → BLACKSMITH (Metal Chain)"
    status: PLANNED
    tasks:
      - "Define Iron Ingot intermediate item"
      - "Create SMELTER recipes (ore → ingot)"
      - "Create BLACKSMITH recipes (ingot → weapons/tools)"
      - "Weapons need: damage stats, durability, equipment slot"
      - "Requires: equipment system, combat integration"

  rancher_livestock:
    name: "RANCHER Livestock System"
    status: COMPLETE
    completed_date: 2026-02-17
    description: "Full RANCHER livestock system — buildings, animals, feed/produce cycle, death mechanics, 3 COOK recipes, simulation bot support"
    changes:
      - "3 RANCHER buildings: Chicken Coop (100g, cap 5), Dairy Barn (150g, cap 3), Sheep Pen (120g, cap 4)"
      - "3 livestock types: chicken (30g, Eggs), cow (80g, Milk), sheep (50g, Wool)"
      - "Livestock Prisma model — individual animals with age, hunger, health, death tracking"
      - "Daily tick Step 4d: auto feed (Grain), auto produce (Eggs/Milk/Wool), random events, death"
      - "3 new COOK recipes: Scrambled Eggs (L3), Creamy Porridge (L3), Farm Breakfast (L5)"
      - "5 new items: Eggs, Milk, Scrambled Eggs, Creamy Porridge, Farm Breakfast"
      - "RANCHER bots in sim: buy buildings, buy livestock, buy Grain feed"
      - "RANCHER APPRENTICE + JOURNEYMAN tiers activated"
    files_modified:
      - "shared/src/data/items/item-names.ts — 5 new items"
      - "shared/src/data/assets.ts — RANCHER buildings, LIVESTOCK_DEFINITIONS, HUNGER_CONSTANTS"
      - "shared/src/data/professions/tier-unlocks.ts — APPRENTICE/JOURNEYMAN activated"
      - "shared/src/data/professions/gathering.ts — RANCHER tierUnlocks display"
      - "shared/src/data/gathering.ts — EGGS/MILK/WOOL items, RESOURCE_MAP, PROFESSION_MAP"
      - "shared/src/data/recipes/consumables.ts — 3 COOK recipes"
      - "database/prisma/schema.prisma — Livestock model"
      - "server/src/routes/rancher.ts — NEW: buy-livestock, buildings, livestock detail"
      - "server/src/routes/assets.ts — RANCHER buy overrides, harvest guard"
      - "server/src/jobs/daily-tick.ts — Step 4d livestock processing"
      - "server/src/lib/simulation/engine.ts — RANCHER bot actions"
      - "server/src/lib/simulation/actions.ts — buyLivestock, harvestAsset guard"
      - "client/src/components/codex/CodexWorld.tsx — RESOURCE_TYPE_LABELS"
    gold_sinks:
      building_purchase: "100-150g per building (3 slots)"
      livestock_purchase: "30-80g per animal"
      grain_feed: "Ongoing — 1-2 Grain per animal every 3 ticks"
      total_setup: "~400-600g for full 3-building RANCHER setup"

  phase_3:
    name: "HUNTER → TANNER (Leather Chain)"
    status: COMPLETE
    completed_date: 2026-02-17
    description: "Full TANNER profession — 15 recipes across 3 tiers. Two-step pipeline: pelts → leather → goods. HUNTER tiers expanded with pelt drops."
    changes:
      - "HUNTER tiers expanded: Apprentice (Wild Game Meat + Animal Pelts), Journeyman (+25% yield), Craftsman (Wolf Pelts + Bear Hides)"
      - "3 processing recipes: Cured Leather (L3), Wolf Leather (L7), Bear Leather (L7)"
      - "4 Apprentice goods: Leather Cap (HEAD), Leather Vest (CHEST), Leather Belt (LEGS), Leather Satchel (CONSUMABLE +1 DEX)"
      - "4 Journeyman goods: Leather Armor (CHEST), Leather Bracers (OFF_HAND), Leather Greaves (LEGS), Quiver (TOOL +25% hunting)"
      - "4 Craftsman goods: Wolf Leather Armor (CHEST), Wolf Leather Hood (HEAD), Bear Hide Cuirass (CHEST), Ranger's Quiver (TOOL +40% hunting)"
      - "6 new raw/intermediate items: Animal Pelts, Wolf Pelts, Bear Hides, Cured Leather, Wolf Leather, Bear Leather"
      - "12 new finished items: Leather Cap, Leather Vest, Leather Belt, Leather Satchel, Leather Armor, Leather Bracers, Leather Greaves, Quiver, Wolf Leather Armor, Wolf Leather Hood, Bear Hide Cuirass, Ranger's Quiver"
      - "Cured Leather as shared intermediate (future TAILOR cross-demand)"
      - "Quiver/Ranger's Quiver create TANNER→HUNTER feedback loop"
    tasks:
      - "✓ Added Animal Pelts (8g), Wolf Pelts (28g), Bear Hides (35g) to HUNTER gathering"
      - "✓ Added Cured Leather (18g), Wolf Leather (35g), Bear Leather (42g) processing recipes"
      - "✓ Created 12 TANNER finished goods recipes (armor, tools, consumable)"
      - "✓ Updated HUNTER tiers: Apprentice/Journeyman/Craftsman all LIVE"
      - "✓ TANNER profession fully defined with DEX primary stat, CRAFTING type"

  phase_3b:
    name: "RANCHER → TAILOR (Textile Chain)"
    status: COMPLETE
    completed_date: 2026-02-17
    description: "Full TAILOR profession — 18 recipes (5 processing + 13 armor). Cloth armor with low AC + high magicResist. RANCHER Craftsman tier expanded with Fine Wool and Silkworm Cocoons."
    changes:
      - "RANCHER Craftsman tier: Fine Wool (L7+ sheep bonus), Silkworm Cocoons (Silkworm House 250g auto-producer)"
      - "5 processing recipes: Spin Cloth (legacy), Cloth Padding (legacy), Weave Cloth (L3), Fine Cloth (L7), Silk Fabric (L7)"
      - "4 Apprentice armor: Cloth Hood (HEAD), Cloth Sash (OFF_HAND), Cloth Robe (CHEST), Wool Trousers (LEGS)"
      - "4 Journeyman armor: Scholar's Robe (CHEST), Traveler's Cloak (CHEST), Merchant's Hat (HEAD), Herbalist's Apron (CHEST)"
      - "5 Craftsman armor: Archmage's Robe (CHEST), Diplomat's Regalia (CHEST), Silk Hood of Insight (HEAD), Noble's Leggings (LEGS), Enchanted Cloak (CHEST)"
      - "5 new material items: Fine Wool (30g), Silkworm Cocoons (38g), Woven Cloth (20g), Fine Cloth (38g), Silk Fabric (45g)"
      - "13 new armor items with magicResist stat (25g-180g range)"
      - "Armor triangle established: BLACKSMITH (plate/STR) vs TANNER (leather/DEX) vs TAILOR (cloth/magicResist)"
      - "Dual-supply crafter pattern: TAILOR buys Wool from RANCHER + Cured Leather from TANNER"
    tasks:
      - "✓ Added Fine Wool (30g) and Silkworm Cocoons (38g) to RANCHER Craftsman tier"
      - "✓ Added Woven Cloth, Fine Cloth, Silk Fabric processing intermediates"
      - "✓ Created 13 TAILOR cloth armor recipes (all with magicResist stat)"
      - "✓ Updated RANCHER Craftsman tier from NOT_YET_IMPLEMENTED to LIVE"
      - "✓ TAILOR profession fully defined with CHA primary stat, CRAFTING type"
      - "✓ Legacy spin-cloth KEPT for WOODWORKER housing-bed recipe (cloth-padding REMOVED — unused)"

  phase_4:
    name: "HERBALIST → ALCHEMIST (Potion Chain)"
    status: PLANNED
    tasks:
      - "Create ALCHEMIST recipes (herbs → potions)"
      - "Potions: HP restore, buffs, combat utility"
      - "Requires: consumable item usage system, buff system"

  phase_5:
    name: "Remaining Crafting Professions"
    status: PLANNED
    professions: [BREWER, WOODWORKER, FLETCHER, MASON, SCRIBE, ENCHANTER, JEWELER, ARMORER]

  phase_6:
    name: "Service Professions"
    status: PLANNED
    professions: [INNKEEPER, HEALER, STABLE_MASTER, BANKER, COURIER]
    notes: "Service profs interact with other systems (housing, travel, banking) — build after those systems exist"


# =============================================================================
# SECTION 8: PRIVATE ASSET OWNERSHIP
# UPDATED: 2026-02-15
# =============================================================================
# Gathering professions can buy private production assets that produce
# higher yields than public spots. Growth cycle, worker hiring, gold sinks.
# =============================================================================

asset_ownership:

  overview:
    status: EXISTS_IN_GAME
    description: "Private fields, mines, and timber plots that gathering professions purchase and manage"
    coexists_with: "Public gathering spots (both systems active)"

  pricing:
    formula: "baseCost * slotNumber"
    max_slots_per_tier: 3
    tiers:
      T1: { level_required: 3, label: "Apprentice", base_cost: 100, growth_ticks: 3, yield: "3-5" }
      T2: { level_required: 7, label: "Craftsman", base_cost: 200, growth_ticks: 5, yield: "5-8" }
      T3: { level_required: 11, label: "Master", base_cost: 300, growth_ticks: 8, yield: "8-12" }
    notes: "UPDATED 2026-02-16 — T2 raised from L5→L7 (Craftsman), T3 raised from L7→L11 (Master)"

  growth_cycle:
    states: [EMPTY, GROWING, READY, WITHERED]
    planting: "FREE — no daily action cost"
    harvesting: "Costs 1 daily action"
    wither_window: "3 ticks after READY"
    items_go_to: "Owner's house storage (both self-harvest and hired worker)"

  # UPDATED: 2026-02-18 — One-shot jobs board system (replaces permanent hire)
  jobs_board:
    overview: "One-shot task board. Accept = execute = complete instantly. No permanent employment."
    lifecycle: "Owner posts job → worker accepts → execute + complete → gold + items + XP"
    status_flow: "OPEN → COMPLETED | EXPIRED | CANCELLED"
    posting:
      action_cost: "FREE (no daily action consumed)"
      remote: true
      validation: "Owner must afford pay, asset must be ready/empty/pendingYield, no existing OPEN job"
    acceptance:
      action_cost: "1 daily action (consume slot)"
      requires_presence: true  # Worker must be in same town
      instant_execution: true  # Accept = execute = complete in one transaction
    profession_bonus:
      matching: "Full yield (100%), full XP (100%)"
      non_matching: "Half yield (50%), half XP (50%)"
    products_destination: "Owner's house storage (not inventory)"
    gold_transfer: "Owner → worker on completion"
    job_types:
      harvest_field: "FARMER field with cropState=READY"
      plant_field: "FARMER field with cropState=EMPTY"
      gather_eggs: "RANCHER chicken_coop with pendingYield > 0"
      milk_cows: "RANCHER dairy_barn with pendingYield > 0"
      shear_sheep: "RANCHER sheep_pen with pendingYield > 0"
    auto_posting: "REMOVED — job posting is always a deliberate player/bot choice"
    endpoints:
      post: "POST /api/jobs/post { assetId, jobType, pay }"
      accept: "POST /api/jobs/:id/accept"
      browse: "GET /api/jobs/town/:townId"
      cancel: "POST /api/jobs/:id/cancel"
      mine: "GET /api/jobs/mine"

  profession_assets:
    FARMER: [grain_field, vegetable_patch, apple_orchard, berry_field]
    MINER: [iron_mine_claim, quarry_claim, clay_pit_rights]
    LUMBERJACK: [timber_plot]
    FISHERMAN: [fishing_rights]
    HERBALIST: [herb_garden_plot]
    RANCHER: [chicken_coop, dairy_barn, sheep_pen, silkworm_house]
    HUNTER: [hunting_ground_rights]

  residency_rules:
    purchase: "Must be RESIDENT (homeTownId) of the town"
    plant_harvest: "Must be PRESENT (currentTownId) in the town"

  # UPDATED: 2026-02-18 — RANCHER livestock subsystem (pendingYield model)
  rancher_livestock:
    overview: "RANCHER buildings accumulate pendingYield from livestock. Manual collection required. Silkworm House is a non-livestock auto-producer."
    building_types:
      chicken_coop: { baseCost: 100, levelRequired: 3, capacity: 5, animal: chicken }
      dairy_barn: { baseCost: 150, levelRequired: 3, capacity: 3, animal: cow }
      sheep_pen: { baseCost: 120, levelRequired: 5, capacity: 4, animal: sheep }
      silkworm_house: { baseCost: 250, levelRequired: 7, capacity: 0, animal: none, product: "Silkworm Cocoons", note: "Non-livestock auto-producer. No animals to buy/feed. Auto-produces every 3 ticks." }
    lifecycle:
      buy_building: "POST /api/assets/buy (sets cropState=READY permanently)"
      buy_animal: "POST /api/rancher/buy-livestock (NPC vendor, fixed price)"
      feed: "Auto in daily tick Step 4d (consumes Grain from owner's inventory)"
      produce: "Auto in daily tick Step 4d (increments pendingYield on OwnedAsset)"
      collect: "POST /api/assets/:id/collect (1 daily action, creates items in house storage)"
      death: "Auto in daily tick (starvation, old_age, disease, predator)"
    pending_yield:
      field: "OwnedAsset.pendingYield (integer count)"
      since: "OwnedAsset.pendingYieldSince (game day when yield first accumulated)"
      reset: "Set to 0 on collection"
      auto_post_after: "REMOVED — no auto-posting; player/bot must post manually"
    daily_tick_step: "4d (after Step 4c asset growth, before Step 5)"

  # UPDATED: 2026-02-17 — Single-town residency model
  housing:
    overview: "Single-town residency. One free Tier 1 cottage in home town only. Relocation system to change home town."
    model: "House (separate from Building system — auto-granted, normalized HouseStorage table)"
    tiers:
      tier_1: { name: "Basic Cottage", cost: "FREE (home town only)", storage_slots: 20, status: IMPLEMENTED }
      tier_2: { name: "Improved House", cost: "500g upgrade", storage_slots: 40, status: PLANNED }
      tier_3: { name: "Manor", cost: "1500g upgrade", storage_slots: 80, status: PLANNED }
      tier_4: { name: "Estate", cost: "5000g upgrade", storage_slots: 150, status: PLANNED }
    storage_mechanics:
      slot_system: "Each unique item template = 1 slot. Quantity unlimited per slot."
      deposit: "Must be physically in town (moves items from inventory → storage)"
      withdraw: "Must be physically in town (moves items from storage → inventory)"
      remote_list: "List items from storage on town market from ANYWHERE (free action, no daily action consumed)"
    relocation:
      cost: 500
      cooldown_days: 30
      requirement: "Must be physically present in target town"
      losses: "All fields, rancher buildings, livestock, workshops, and house storage items in old home town are permanently deleted"
      new_home: "Free starter cottage auto-created in new home town"
      preview_endpoint: "POST /api/relocate/preview { targetTownId }"
      confirm_endpoint: "POST /api/relocate/confirm { targetTownId }"
    endpoints:
      list_houses: "GET /api/houses/mine"
      buy_house: "POST /api/houses/buy — DISABLED (returns 410 Gone)"
      view_storage: "GET /api/houses/:houseId/storage"
      deposit: "POST /api/houses/:houseId/storage/deposit { itemTemplateId, quantity }"
      withdraw: "POST /api/houses/:houseId/storage/withdraw { itemTemplateId, quantity }"
      list_on_market: "POST /api/houses/:houseId/storage/list { itemTemplateId, quantity, price }"
      check_town: "GET /api/houses/town/:townId"
    constraints:
      one_per_character: "Single home town — one house per character (in their homeTownId town)"
      building_residency: "POST /buildings/request-permit requires homeTownId match"
      no_sell: "Houses are permanent (no sell/abandon in Tier 1)"
      cascade_delete: "Character deletion cascades to houses and storage"

# =============================================================================
# SECTION 9: SIMULATION SUPPLY CHAIN DIAGNOSTIC (2026-02-18)
# =============================================================================
# Diagnostic: 50-bot sim run identified ~11% error rate (525/4782 actions).
# Root cause: 100% of failures were market_buy — crafters couldn't find ingredients.
# Eight fixes applied; verified with 60-tick, 50-bot simulation.
# =============================================================================

simulation_supply_chain_diagnostic:
  date: "2026-02-18"
  pre_fix_error_rate: "11.0% (525 failures / 4782 total actions)"
  post_fix_error_rate: "13.8% overall; 5.2% excluding structural market_buy mismatches"

  fixes_applied:
    fix_1_listing_threshold:
      file: "server/src/lib/simulation/actions.ts"
      change: "Lower surplus listing threshold from keep-5 to keep-2"
      impact: "Gatherers list items on market earlier (after accumulating 3+ instead of 6+)"

    fix_2_item_to_spot_type:
      file: "server/src/lib/simulation/engine.ts"
      change: "Add 15 new ITEM_TO_SPOT_TYPE entries for FARMER/RANCHER/TANNER/TAILOR supply chains"
      items_added: [Grain, Vegetables, Wild Berries, Cotton, Wool, Fine Wool, Silkworm Cocoons, Cured Leather, Wolf Leather, Bear Leather, Woven Cloth, Fine Cloth, Silk Fabric]
      impact: "Bot travel AI can now route to correct resource towns for all supply chain items"

    fix_3_dead_recipe:
      file: "shared/src/data/recipes/tailor.ts"
      change: "Remove make-cloth-padding recipe — Cloth Padding unused by any downstream recipe"
      related: ["database/seeds/run-tailor.ts", "shared/src/data/professions/crafting.ts"]
      impact: "TAILOR bots no longer waste actions trying to buy Cotton for dead-end recipe"

    fix_4_error_observability:
      file: "server/src/lib/simulation/controller.ts"
      change: "Push free market failures to errors[] with detail messages; suppress 'Already have order' from failure count"
      impact: "All sim errors now visible in tick results and bot logs"

    fix_5_idle_neutral:
      file: "server/src/lib/simulation/controller.ts"
      change: "Treat idle bots (no valid action) as neutral success instead of failure"
      impact: "Bots waiting for travel or with nothing to do don't inflate error rate"

    fix_6_tickdate_timezone:
      file: "server/src/jobs/daily-tick.ts"
      change: "Append T00:00:00.000Z to all 7 bare new Date(tickDateStr) calls"
      impact: "Daily tick date range queries use explicit UTC, preventing timezone drift"

    fix_7_achievement_filter:
      file: "server/src/services/achievements.ts"
      change: "Replace broken Prisma JSON path filter (not: undefined is no-op) with simple findMany()"
      impact: "Achievement checks now evaluate all achievements, not a broken subset"

    fix_8_seed_profession_distribution:
      file: "server/src/lib/simulation/seed.ts"
      change: "Pre-compute profAssignments Map guaranteeing min 2 per profession; persist to PlayerProfession DB table"
      impact: "All 13 professions seeded with 3-4 bots each. refreshBotState() no longer wipes seed professions"

  verification_results:
    ticks: 60
    bots: 50
    total_actions: 4841
    total_successes: 4175
    total_failures: 666
    error_rate: "13.76%"
    all_errors_are: "market_buy (crafters seeking items not yet on market)"
    profession_distribution: "All 13 professions: 3-4 bots each (MINER:4, FARMER:4, LUMBERJACK:4, HERBALIST:4, FISHERMAN:4, HUNTER:4, RANCHER:4, COOK:4, BREWER:4, BLACKSMITH:4, TANNER:4, TAILOR:3, ALCHEMIST:3)"
    warmup_phase: "Ticks 1-2 high (18-31%) — expected, market empty at start"
    steady_state: "Ticks 3-9 average 5.6% — near target"
    late_phase: "Ticks 10-60 average 14.4% — structural undersupply"

  structural_limitation:
    description: "Remaining market_buy failures are structural: sim bots gather via gatherFromSpot (produces Apples, Wild Herbs, Iron Ore, etc.) but items like Grain, Wild Berries, Medicinal Herbs come from FARMER private asset harvest cycle (plant→grow→harvest). Sim bots don't run the crop cycle."
    top_missing_items:
      - { item: "Wild Herbs", failures: 463, source: "HERBALIST spot gathering — supply insufficient for COOK+ALCHEMIST+BREWER demand" }
      - { item: "Wild Berries", failures: 341, source: "FARMER asset harvest only — not produced by spot gathering" }
      - { item: "Grain", failures: 335, source: "FARMER asset harvest only — not produced by spot gathering" }
      - { item: "Raw Fish", failures: 123, source: "FISHERMAN spot — supply insufficient for COOK demand" }
      - { item: "Cloth", failures: 101, source: "TAILOR intermediate (Cotton→Cloth) — Cotton from FARMER asset" }
      - { item: "Silkworm Cocoons", failures: 101, source: "RANCHER Craftsman L7+ asset — most bots below L7" }
    future_fix: "Implement crop plant→grow→harvest cycle in sim engine, or add spot-based production for Grain/Berries"

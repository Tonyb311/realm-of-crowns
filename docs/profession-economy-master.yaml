# =============================================================================
# REALM OF CROWNS — PROFESSION & ECONOMY MASTER REFERENCE
# =============================================================================
# This is the SINGLE SOURCE OF TRUTH for all professions, resources, recipes,
# and their interdependencies. Every agent prompt references this document.
#
# FORMAT: YAML-style structured data optimized for AI dependency tracing.
# To trace a chain: Find any item → check its recipe.inputs → trace each
# input back to its source (gathered or crafted) → repeat until you hit
# a raw gathered resource.
#
# LAST UPDATED: 2026-02-17
# STATUS: All 7 gathering professions formalized and LIVE. FARMER, HUNTER, MINER, LUMBERJACK,
# HERBALIST, FISHERMAN APPRENTICE tiers fully live. RANCHER livestock system LIVE —
# buildings (Chicken Coop, Dairy Barn, Sheep Pen), livestock purchase, auto feed/produce
# in daily tick, animal death mechanics (starvation, old age, disease, predator).
# COOK recipes expanded: +3 livestock recipes (Scrambled Eggs, Creamy Porridge, Farm Breakfast).
# grain_field, vegetable_patch, berry removed as public spots → FARMER private fields only.
# hunting_ground added (4 towns). Universal tier system verified.
# Simulation verification: 50 bots, 17+ ticks, 1332 actions, 0 errors.
# =============================================================================


# =============================================================================
# SECTION 1: PUBLIC GATHERING SPOTS & RAW RESOURCES
# =============================================================================
# These are the 8 public spot types across 69 towns (after 2026-02-17 redesign).
# Every resource can be gathered by ANY player (no profession req for public spots).
# Gathering professions get TIER-SCALED BONUS YIELD at their specialty spots.
# grain_field, vegetable_patch, berry are now FARMER PRIVATE FIELDS ONLY.
# hunting_ground added as new public spot type (4 towns).
# =============================================================================

gathering_spot_types:

  orchard:
    resource: Apple
    item_id: apple
    category: FOOD
    base_value: 3
    yield: 1-3
    edible: true
    hp_restore: 5
    description: "A crisp, red apple. Eaten raw or used in cooking."
    gather_professions: [FARMER]       # These professions get bonus yield here
    craft_consumers: [COOK, BREWER]    # These professions use this as input
    regions: [Heartlands, Crossroads, Suncoast]

  # berry_thicket: REMOVED as public spot (2026-02-17)
  # Wild Berries now produced by FARMER private fields (berry_field asset, T2)

  herb_garden:
    resource: Wild Herbs
    item_id: wild_herbs
    category: FOOD
    base_value: 5
    yield: 1-2
    edible: true
    hp_restore: 3
    description: "Fragrant wild herbs. Used in cooking, brewing, and alchemy."
    gather_professions: [HERBALIST]
    craft_consumers: [COOK, BREWER, ALCHEMIST]
    regions: [Heartlands, Silverwood, Crossroads, Shadowmere]

  fishing_pond:
    resource: Raw Fish
    item_id: raw_fish
    category: FOOD
    base_value: 4
    yield: 1-3
    edible: true
    hp_restore: 8
    description: "A fresh-caught fish. Better cooked, but edible raw in a pinch."
    gather_professions: [FISHERMAN]
    craft_consumers: [COOK]
    regions: [Crossroads, Shadowmere, Suncoast]

  forest:
    resource: Wood Logs
    item_id: wood_logs
    category: MATERIAL
    base_value: 5
    yield: 1-3
    edible: false
    description: "Rough-cut timber. Used by woodworkers, fletchers, and builders."
    gather_professions: [LUMBERJACK]
    craft_consumers: [WOODWORKER, FLETCHER, MASON, SCRIBE, COOK]
    regions: [Silverwood, Crossroads, Frozen Reaches]

  mine:
    resource: Iron Ore
    item_id: iron_ore
    category: MATERIAL
    base_value: 6
    yield: 1-2
    edible: false
    description: "Raw iron ore. Must be smelted before a blacksmith can work it."
    gather_professions: [MINER]
    craft_consumers: [SMELTER]
    regions: [Ironvault, Ashenfang, Frozen Reaches]

  quarry:
    resource: Stone Blocks
    item_id: stone_blocks
    category: MATERIAL
    base_value: 7
    yield: 1-2
    edible: false
    description: "Rough-hewn stone. Used by masons and builders."
    gather_professions: [MINER]
    craft_consumers: [MASON, JEWELER]
    regions: [Ironvault, Ashenfang, Frozen Reaches]

  clay_pit:
    resource: Clay
    item_id: clay
    category: MATERIAL
    base_value: 4
    yield: 1-3
    edible: false
    description: "Wet clay from the riverbank. Used in pottery, building, and alchemy."
    gather_professions: [MINER]
    craft_consumers: [MASON, ALCHEMIST]
    regions: [Ashenfang, Shadowmere, Suncoast]

  hunting_ground:
    resource: Wild Game Meat
    item_id: wild_game_meat
    category: FOOD
    base_value: 5
    yield: 1-3
    edible: true
    hp_restore: 8
    description: "Venison, boar, and rabbit harvested from the wilds. Lean and flavorful."
    gather_professions: [HUNTER]
    craft_consumers: [COOK]
    regions: [Ironvault, Frozen Reaches, Twilight March]
    towns: [Alehearth, Frostfang, "Harmony Point", "The Crosswinds Inn"]
    status: LIVE  # Added 2026-02-17

  # --- FARMER PRIVATE FIELD ONLY (no public spots) ---
  # grain_field: REMOVED as public spot (2026-02-17). Grain now FARMER-private-field only.
  #   Towns reassigned: Millhaven→orchard, Greenhollow→orchard, Sandrift→fishing
  # vegetable_patch: REMOVED as public spot (2026-02-17). Vegetables now FARMER-private-field only.
  #   Towns reassigned: Whitefield→orchard, Peddler's Rest→orchard


# =============================================================================
# SECTION 2: PLANNED GATHERING SPOTS (NOT YET IMPLEMENTED)
# UPDATED: 2026-02-17 — hunting_ground moved to Section 1 (now live)
# grain_field, vegetable_patch now FARMER private fields only (not public spots)
# =============================================================================
# Remaining spots that still need to be added.
# Priority: Add when implementing the paired crafting profession.
# =============================================================================

planned_gathering_spots:

  pasture:
    status: NEEDED_FOR_TANNER
    resource: Raw Hide
    item_id: raw_hide
    category: MATERIAL
    base_value: 5
    yield: 1-2
    edible: false
    description: "Untreated animal hide. Must be tanned before leatherworking."
    gather_professions: [RANCHER]
    craft_consumers: [TANNER]
    assign_to_regions: [Heartlands, Crossroads]

  # RANCHER livestock products (auto-produced by animals in daily tick):
  # - Eggs (chicken) → COOK (Scrambled Eggs, Farm Breakfast)
  # - Milk (cow) → COOK (Creamy Porridge, Farm Breakfast)
  # - Wool (sheep) → TAILOR (future textile chain)
  # - Raw Hide → TANNER → LEATHERWORKER (future leather chain)
  # RANCHER buildings: chicken_coop (cap 5), dairy_barn (cap 3), sheep_pen (cap 4)
  # Livestock require Grain feed every 3 ticks. No feed → hunger → death.

  # hunting_ground: MOVED to Section 1 (2026-02-17) — now LIVE with 4 towns
    gather_professions: [HUNTER]
    craft_consumers: [COOK, TANNER]
    assign_to_regions: [Silverwood, Frozen Reaches]


# =============================================================================
# SECTION 3: PROFESSIONS — FULL REGISTRY
# =============================================================================
# 28 professions: 7 Gathering, 15 Crafting, 6 Service
# Max 3 professions per character.
# Profession unlocks at character Level 3.
# =============================================================================

professions:

  # ---------------------------------------------------------------------------
  # GATHERING PROFESSIONS (7)
  # These DON'T craft. They gather raw resources with bonus yield.
  # ---------------------------------------------------------------------------

  FARMER:
    type: GATHERING
    unlock_level: 3
    description: "Tends crops and orchards. Tier-scaled bonus yield at agricultural gathering spots."
    bonus_spots: [orchard, berry_thicket, grain_field, vegetable_patch]
    tier_unlocks:
      APPRENTICE: { level: "3-4", spots: [grain_field, vegetable_patch], yield_bonus: "+0%" }
      JOURNEYMAN: { level: "5-6", spots: [orchard, berry], yield_bonus: "+25%" }
      CRAFTSMAN: { level: "7-8", spots: [hops_field, vineyard], yield_bonus: "+50%", status: NOT_YET_IMPLEMENTED }
      EXPERT: { level: "9-10", spots: [cotton_field, flax_field], yield_bonus: "+75%", status: NOT_YET_IMPLEMENTED }
      MASTER: { level: "11-12", spots: [rare_herb, exotic_fruit], yield_bonus: "+100%", status: NOT_YET_IMPLEMENTED }
      GRANDMASTER: { level: "13+", spots: [legendary_crop, magical_seedling], yield_bonus: "+150%", status: NOT_YET_IMPLEMENTED }
    feeds_into: [COOK, BREWER]
    status: EXISTS_IN_GAME
    notes: "Tier-scaled bonus replaced flat +50%. APPRENTICE/JOURNEYMAN spots live; CRAFTSMAN+ Coming Soon."

  RANCHER:
    type: GATHERING
    unlock_level: 3
    description: "Raises livestock in buildings. Animals auto-produce Eggs, Milk, Wool every 3 ticks if fed Grain."
    asset_based: true
    buildings:
      chicken_coop: { baseCost: 100, levelRequired: 3, capacity: 5, animal: chicken, product: Eggs }
      dairy_barn: { baseCost: 150, levelRequired: 3, capacity: 3, animal: cow, product: Milk }
      sheep_pen: { baseCost: 120, levelRequired: 5, capacity: 4, animal: sheep, product: Wool }
    livestock:
      chicken: { price: 30, maxAge: 120, feedCost: 1, product: Eggs, yield: "1-2" }
      cow: { price: 80, maxAge: 180, feedCost: 2, product: Milk, yield: 1 }
      sheep: { price: 50, maxAge: 150, feedCost: 1, product: Wool, yield: 1 }
    feed_mechanics:
      feed_interval: "every 3 ticks (currentDay % 3 === 0)"
      feed_item: Grain
      hunger_per_miss: 25
      starving_threshold: 50   # Production halved
      death_threshold: 100     # Animal dies
    death_causes: [starvation, old_age, disease, predator]
    random_events:
      disease: { chance: "1%", health_loss: 25 }
      predator: { chance: "0.5%", instant_kill: true }
    tier_unlocks:
      APPRENTICE: { level: "3-4", spots: [chicken_coop, dairy_barn], crops: [Eggs, Milk], assetBased: true }
      JOURNEYMAN: { level: "5-6", spots: [sheep_pen], crops: [Wool], assetBased: true }
      CRAFTSMAN: { status: NOT_YET_IMPLEMENTED }
      EXPERT: { status: NOT_YET_IMPLEMENTED }
      MASTER: { status: NOT_YET_IMPLEMENTED }
      GRANDMASTER: { status: NOT_YET_IMPLEMENTED }
    feeds_into: [TANNER, TAILOR, COOK]
    status: EXISTS_IN_GAME
    notes: "APPRENTICE + JOURNEYMAN LIVE. Buildings as OwnedAsset (cropState=READY permanently). Livestock in separate Prisma model. Feed/produce automatic in daily tick Step 4d."

  FISHERMAN:
    type: GATHERING
    unlock_level: 3
    description: "Catches fish from rivers, lakes, and the sea."
    bonus_spots: [fishing_pond]
    tier_unlocks:
      APPRENTICE: { level: "3-4", spots: [fishing], yield_bonus: "+0%" }
    feeds_into: [COOK]
    status: EXISTS_IN_GAME
    notes: "Tier bonus active for fishing spots. Higher tiers NOT_YET_IMPLEMENTED."

  LUMBERJACK:
    type: GATHERING
    unlock_level: 3
    description: "Fells trees and prepares timber."
    bonus_spots: [forest]
    tier_unlocks:
      APPRENTICE: { level: "3-4", spots: [forest], yield_bonus: "+0%" }
    feeds_into: [WOODWORKER, FLETCHER, MASON, SCRIBE, COOK]
    status: EXISTS_IN_GAME
    notes: "Tier bonus active for forest spots. Higher tiers NOT_YET_IMPLEMENTED."

  MINER:
    type: GATHERING
    unlock_level: 3
    description: "Extracts ore, stone, gems, and clay from the earth."
    bonus_spots: [mine, quarry, clay_pit]
    tier_unlocks:
      APPRENTICE: { level: "3-4", spots: [mine, quarry, clay], yield_bonus: "+0%" }
    feeds_into: [SMELTER, MASON, JEWELER]
    status: EXISTS_IN_GAME
    notes: "Tier bonus active for mine/quarry/clay spots. Higher tiers NOT_YET_IMPLEMENTED."

  HERBALIST:
    type: GATHERING
    unlock_level: 3
    description: "Forages for medicinal and magical herbs."
    bonus_spots: [herb_garden]              # UPDATED: 2026-02-15 — berry_thicket reassigned to FARMER
    tier_unlocks:
      APPRENTICE: { level: "3-4", spots: [herb], yield_bonus: "+0%" }
    feeds_into: [ALCHEMIST, COOK, BREWER]
    status: EXISTS_IN_GAME
    notes: "Tier bonus active for herb spots. Higher tiers NOT_YET_IMPLEMENTED."

  HUNTER:
    type: GATHERING
    unlock_level: 3
    description: "Tracks and hunts wild game for meat and pelts."
    bonus_spots: [hunting_ground]
    tier_unlocks:
      APPRENTICE: { spots: [], status: NOT_YET_IMPLEMENTED, note: "No hunting spots exist yet" }
    feeds_into: [COOK, TANNER, FLETCHER]
    status: PLANNED
    notes: "Hunting grounds not yet created. Tier bonus framework in place."

  # ---------------------------------------------------------------------------
  # CRAFTING PROFESSIONS (15)
  # These transform gathered/intermediate resources into finished goods.
  # Each consumes daily action. Each requires the profession to craft.
  # ---------------------------------------------------------------------------

  COOK:
    type: CRAFTING
    unlock_level: 3
    description: "Transforms raw ingredients into meals that restore HP and grant buffs."
    depends_on_gatherers: [FARMER, FISHERMAN, RANCHER, HUNTER, HERBALIST, LUMBERJACK]
    raw_inputs: [apple, wild_berries, wild_herbs, raw_fish, grain, vegetables, game_meat, wood_logs, eggs, milk]
    intermediate_inputs: [flour]          # Things COOK makes and reuses
    output_categories: [FOOD, DRINK]
    status: EXISTS_IN_GAME                # UPDATED: 2026-02-17 — 18 recipes (15 original + 3 livestock)
    # See SECTION 4 for full recipe tree

  BREWER:
    type: CRAFTING
    unlock_level: 5
    description: "Brews ale, wine, mead, and spirits from agricultural ingredients."
    depends_on_gatherers: [FARMER, HERBALIST]
    raw_inputs: [grain, wild_berries, wild_herbs, apple]
    intermediate_inputs: []
    output_categories: [DRINK]
    status: PLANNED
    notes: "Second food-chain profession. Drinks provide buffs, not HP."

  SMELTER:
    type: CRAFTING
    unlock_level: 3
    description: "Smelts raw ore into usable metal ingots and alloys."
    depends_on_gatherers: [MINER]
    raw_inputs: [iron_ore]
    intermediate_inputs: []
    output_categories: [MATERIAL]
    outputs_used_by: [BLACKSMITH, ARMORER, JEWELER]
    status: PLANNED
    notes: "Bottleneck profession — BLACKSMITH and ARMORER both need ingots"

  BLACKSMITH:
    type: CRAFTING
    unlock_level: 5
    description: "Forges weapons and metal tools from ingots."
    depends_on_gatherers: []             # Doesn't use raw resources directly
    intermediate_inputs: [iron_ingot]    # From SMELTER
    output_categories: [WEAPON, TOOL]
    status: PLANNED
    notes: "Requires SMELTER output. Classic 3-step chain: MINER → SMELTER → BLACKSMITH"

  ARMORER:
    type: CRAFTING
    unlock_level: 5
    description: "Crafts metal armor and shields."
    depends_on_gatherers: []
    intermediate_inputs: [iron_ingot, leather]  # SMELTER + TANNER
    output_categories: [ARMOR, SHIELD]
    status: PLANNED
    notes: "Cross-chain: needs both SMELTER and TANNER outputs"

  WOODWORKER:
    type: CRAFTING
    unlock_level: 3
    description: "Shapes timber into furniture, tools, and building components."
    depends_on_gatherers: [LUMBERJACK]
    raw_inputs: [wood_logs]
    intermediate_inputs: []
    output_categories: [TOOL, FURNITURE, MATERIAL]
    outputs_used_by: [FLETCHER]
    status: PLANNED

  TANNER:
    type: CRAFTING
    unlock_level: 3
    description: "Processes raw hides into workable leather."
    depends_on_gatherers: [RANCHER, HUNTER]
    raw_inputs: [raw_hide]
    intermediate_inputs: []
    output_categories: [MATERIAL]
    outputs_used_by: [LEATHERWORKER, ARMORER, TAILOR]
    status: PLANNED
    notes: "Bottleneck like SMELTER — multiple professions need leather"

  LEATHERWORKER:
    type: CRAFTING
    unlock_level: 5
    description: "Crafts leather armor, bags, belts, and accessories."
    depends_on_gatherers: []
    intermediate_inputs: [leather]       # From TANNER
    output_categories: [ARMOR, ACCESSORY, CONTAINER]
    status: PLANNED

  TAILOR:
    type: CRAFTING
    unlock_level: 3
    description: "Weaves cloth and sews clothing and robes."
    depends_on_gatherers: [RANCHER]
    raw_inputs: []
    intermediate_inputs: [wool_cloth]    # Eventually from RANCHER → TAILOR pipeline
    output_categories: [ARMOR, CLOTHING]
    status: PLANNED
    notes: "Wool now produced by RANCHER sheep. TAILOR recipes not yet implemented."

  ALCHEMIST:
    type: CRAFTING
    unlock_level: 5
    description: "Brews potions, elixirs, and magical reagents."
    depends_on_gatherers: [HERBALIST]
    raw_inputs: [wild_herbs]
    intermediate_inputs: []
    output_categories: [POTION, REAGENT]
    status: PLANNED

  ENCHANTER:
    type: CRAFTING
    unlock_level: 7
    description: "Imbues items with magical properties."
    depends_on_gatherers: []
    intermediate_inputs: [reagent]       # From ALCHEMIST
    output_categories: [ENCHANTMENT]
    status: PLANNED
    notes: "End-of-chain. Takes finished items + reagents → enchanted items"

  JEWELER:
    type: CRAFTING
    unlock_level: 5
    description: "Cuts gems and crafts jewelry and accessories."
    depends_on_gatherers: [MINER]
    raw_inputs: [stone_blocks]           # Eventually needs gems (new resource)
    intermediate_inputs: [iron_ingot]    # For settings
    output_categories: [ACCESSORY, TRADE_GOOD]
    status: PLANNED

  FLETCHER:
    type: CRAFTING
    unlock_level: 5
    description: "Crafts bows, crossbows, and ammunition."
    depends_on_gatherers: [LUMBERJACK, HUNTER]
    raw_inputs: [wood_logs]
    intermediate_inputs: [leather]       # From TANNER (bowstrings, grips)
    output_categories: [WEAPON, AMMO]
    status: PLANNED

  MASON:
    type: CRAFTING
    unlock_level: 5
    description: "Works stone into building materials and structures."
    depends_on_gatherers: [MINER, LUMBERJACK]
    raw_inputs: [stone_blocks, wood_logs, clay]
    intermediate_inputs: []
    output_categories: [BUILDING_MATERIAL]
    status: PLANNED
    notes: "Feeds into Housing system (player-owned buildings)"

  SCRIBE:
    type: CRAFTING
    unlock_level: 5
    description: "Creates scrolls, books, maps, and written works."
    depends_on_gatherers: [LUMBERJACK, HERBALIST]
    raw_inputs: [wood_logs, wild_herbs]   # Wood→paper, herbs→ink
    intermediate_inputs: []
    output_categories: [SCROLL, BOOK, MAP]
    status: PLANNED

  # ---------------------------------------------------------------------------
  # SERVICE PROFESSIONS (6)
  # These don't craft items — they provide services, run businesses,
  # or interact with other game systems.
  # ---------------------------------------------------------------------------

  MERCHANT:
    type: SERVICE
    unlock_level: 3
    description: "Trades goods with bonuses. Lower market fees, better buy/sell prices."
    mechanics: "Reduced market listing fees. CHA bonus on auction bids. Can run a shop."
    status: EXISTS_IN_GAME

  INNKEEPER:
    type: SERVICE
    unlock_level: 5
    description: "Runs a tavern. Sells food/drink, provides rest bonuses."
    mechanics: "Stocks food from COOKs and drinks from BREWERs. Rest bonus for visitors."
    depends_on: [COOK, BREWER]
    status: PLANNED

  HEALER:
    type: SERVICE
    unlock_level: 5
    description: "Heals other players. Uses potions from ALCHEMISTs."
    mechanics: "Can heal other characters. Consumes potions. Earns gold per heal."
    depends_on: [ALCHEMIST]
    status: PLANNED

  STABLE_MASTER:
    type: SERVICE
    unlock_level: 5
    description: "Manages mounts and speeds up travel."
    mechanics: "Reduces travel time for customers. Can breed/sell mounts."
    status: PLANNED

  BANKER:
    type: SERVICE
    unlock_level: 7
    description: "Manages gold storage, loans, and interest."
    mechanics: "Secure gold storage. Can issue loans. Earns interest."
    status: PLANNED

  COURIER:
    type: SERVICE
    unlock_level: 3
    description: "Delivers items between towns for other players."
    mechanics: "Can carry items for others. Faster travel. Delivery quests."
    status: PLANNED


# =============================================================================
# SECTION 4: COOK RECIPE TREE (FIRST CRAFTING PROFESSION)
# =============================================================================
# COOK is the first crafting profession to be fully implemented.
# It establishes the pattern for all other crafting professions.
#
# Design principles:
# - Every recipe uses resources that exist (or will exist) as gathered items
# - Progressive complexity: T1 = 1 input, T2 = 2 inputs, T3 = 2-3 inputs
# - Intermediate ingredients (Flour) are crafted by COOK and reused in higher tiers
# - Crafted food > raw food in both HP restore and sell value
# - Food grants buffs at higher tiers (economic incentive to level COOK)
# =============================================================================

cook_recipes:

  # --- INTERMEDIATES (craft these to use in higher-tier recipes) ---

  flour:
    id: flour
    name: Flour
    description: "Finely ground grain. The foundation of all baking."
    category: INGREDIENT
    base_value: 5
    tier: 1
    level_required: 3
    profession: COOK
    xp_reward: 8
    inputs:
      - item_id: grain
        quantity: 2
      - item_id: wood_logs
        quantity: 1
    outputs:
      - item_id: flour
        quantity: 1
    notes: "Intermediate ingredient. Not edible. Used in Bread, Pie, Pastry, Feast."

  # --- TIER 1: APPRENTICE (Level 3-4) ---
  # Single input, basic food. First things a new COOK makes.

  apple_sauce:
    id: apple_sauce
    name: Apple Sauce
    description: "Sweet stewed apples. Simple comfort food."
    category: FOOD
    base_value: 8
    tier: 1
    level_required: 3
    profession: COOK
    xp_reward: 10
    inputs:
      - item_id: apple
        quantity: 3
      - item_id: wood_logs
        quantity: 1
    outputs:
      - item_id: apple_sauce
        quantity: 1
    effects:
      hp_restore: 15
    crafting_note: "3 Apples (9g raw) → 1 Apple Sauce (8g + 15 HP). Value is in the HP, not resale."

  porridge:
    id: porridge
    name: Porridge
    description: "Thick, hearty grain porridge. Keeps you going all day."
    category: FOOD
    base_value: 7
    tier: 1
    level_required: 3
    profession: COOK
    xp_reward: 10
    inputs:
      - item_id: grain
        quantity: 2
      - item_id: wood_logs
        quantity: 1
    outputs:
      - item_id: porridge
        quantity: 1
    effects:
      hp_restore: 12

  berry_jam:
    id: berry_jam
    name: Berry Jam
    description: "Sweet preserved berries. Delicious on bread."
    category: INGREDIENT
    base_value: 6
    tier: 1
    level_required: 3
    profession: COOK
    xp_reward: 8
    inputs:
      - item_id: wild_berries
        quantity: 3
      - item_id: wood_logs
        quantity: 1
    outputs:
      - item_id: berry_jam
        quantity: 1
    notes: "Intermediate + edible. Can eat for 8 HP or use in Tier 2 recipes."
    effects:
      hp_restore: 8

  grilled_fish:
    id: grilled_fish
    name: Grilled Fish
    description: "Simply grilled over an open flame. Much better than raw."
    category: FOOD
    base_value: 10
    tier: 1
    level_required: 3
    profession: COOK
    xp_reward: 10
    inputs:
      - item_id: raw_fish
        quantity: 2
      - item_id: wood_logs
        quantity: 1
    outputs:
      - item_id: grilled_fish
        quantity: 1
    effects:
      hp_restore: 20

  herbal_tea:
    id: herbal_tea
    name: Herbal Tea
    description: "A soothing brew of wild herbs. Restores body and spirit."
    category: DRINK
    base_value: 10
    tier: 1
    level_required: 3
    profession: COOK
    xp_reward: 10
    inputs:
      - item_id: wild_herbs
        quantity: 2
      - item_id: wood_logs
        quantity: 1
    outputs:
      - item_id: herbal_tea
        quantity: 1
    effects:
      hp_restore: 10
      buff: "calm"
      buff_duration_ticks: 1
      buff_description: "+1 WIS for 1 tick"

  vegetable_stew:
    id: vegetable_stew
    name: Vegetable Stew
    description: "A thick, warming stew of root vegetables."
    category: FOOD
    base_value: 8
    tier: 1
    level_required: 3
    profession: COOK
    xp_reward: 10
    inputs:
      - item_id: vegetables
        quantity: 3
      - item_id: wood_logs
        quantity: 1
    outputs:
      - item_id: vegetable_stew
        quantity: 1
    effects:
      hp_restore: 15

  # --- TIER 2: JOURNEYMAN (Level 5-6) ---
  # Two inputs OR uses an intermediate from Tier 1.

  bread_loaf:
    id: bread_loaf
    name: Bread Loaf
    description: "A crusty golden loaf. The staff of life."
    category: FOOD
    base_value: 12
    tier: 2
    level_required: 5
    profession: COOK
    xp_reward: 15
    inputs:
      - item_id: flour
        quantity: 2
      - item_id: wood_logs
        quantity: 1
    outputs:
      - item_id: bread_loaf
        quantity: 1
    effects:
      hp_restore: 20
    dependency_chain: "Grain →[COOK]→ Flour →[COOK]→ Bread Loaf"

  apple_pie:
    id: apple_pie
    name: Apple Pie
    description: "Warm apple pie with a flaky crust. A countryside classic."
    category: FOOD
    base_value: 18
    tier: 2
    level_required: 5
    profession: COOK
    xp_reward: 18
    inputs:
      - item_id: flour
        quantity: 1
      - item_id: apple
        quantity: 3
      - item_id: wood_logs
        quantity: 1
    outputs:
      - item_id: apple_pie
        quantity: 1
    effects:
      hp_restore: 30
    dependency_chain: "Grain →[COOK]→ Flour + Apples →[COOK]→ Apple Pie"

  fish_stew:
    id: fish_stew
    name: Fish Stew
    description: "A hearty chowder with fresh fish and herbs."
    category: FOOD
    base_value: 16
    tier: 2
    level_required: 5
    profession: COOK
    xp_reward: 18
    inputs:
      - item_id: raw_fish
        quantity: 2
      - item_id: wild_herbs
        quantity: 1
      - item_id: wood_logs
        quantity: 1
    outputs:
      - item_id: fish_stew
        quantity: 1
    effects:
      hp_restore: 28
      buff: "well_fed"
      buff_duration_ticks: 2
      buff_description: "+1 CON for 2 ticks"

  seasoned_roast_vegetables:
    id: seasoned_roast_vegetables
    name: Seasoned Roast Vegetables
    description: "Roasted roots glazed with herbal seasoning."
    category: FOOD
    base_value: 14
    tier: 2
    level_required: 5
    profession: COOK
    xp_reward: 15
    inputs:
      - item_id: vegetables
        quantity: 2
      - item_id: wild_herbs
        quantity: 1
      - item_id: wood_logs
        quantity: 1
    outputs:
      - item_id: seasoned_roast_vegetables
        quantity: 1
    effects:
      hp_restore: 22
      buff: "nourished"
      buff_duration_ticks: 1
      buff_description: "+1 STR for 1 tick"

  berry_tart:
    id: berry_tart
    name: Berry Tart
    description: "A crisp pastry shell filled with sweet berry jam."
    category: FOOD
    base_value: 16
    tier: 2
    level_required: 5
    profession: COOK
    xp_reward: 18
    inputs:
      - item_id: flour
        quantity: 1
      - item_id: berry_jam
        quantity: 1
      - item_id: wood_logs
        quantity: 1
    outputs:
      - item_id: berry_tart
        quantity: 1
    effects:
      hp_restore: 25
    dependency_chain: "Grain →[COOK]→ Flour + Berries →[COOK]→ Jam →[COOK]→ Berry Tart"

  # --- TIER 3: EXPERT (Level 7+) ---
  # 2-3 inputs, premium effects, cross-resource ingredients.

  harvest_feast:
    id: harvest_feast
    name: Harvest Feast
    description: "A grand platter of bread, roasted fruit, and herbed vegetables. Fit for a lord."
    category: FOOD
    base_value: 35
    tier: 3
    level_required: 7
    profession: COOK
    xp_reward: 30
    inputs:
      - item_id: bread_loaf
        quantity: 1
      - item_id: apple
        quantity: 2
      - item_id: wild_herbs
        quantity: 2
      - item_id: wood_logs
        quantity: 1
    outputs:
      - item_id: harvest_feast
        quantity: 1
    effects:
      hp_restore: 50
      buff: "feast_spirit"
      buff_duration_ticks: 3
      buff_description: "+2 CON, +1 CHA for 3 ticks"
    dependency_chain: "Grain →[COOK]→ Flour →[COOK]→ Bread + Apples + Herbs →[COOK]→ Harvest Feast"

  fisherman_banquet:
    id: fisherman_banquet
    name: Fisherman's Banquet
    description: "Grilled fish on herb bread with berry glaze. A coastal delicacy."
    category: FOOD
    base_value: 32
    tier: 3
    level_required: 7
    profession: COOK
    xp_reward: 30
    inputs:
      - item_id: grilled_fish
        quantity: 1
      - item_id: bread_loaf
        quantity: 1
      - item_id: berry_jam
        quantity: 1
      - item_id: wood_logs
        quantity: 1
    outputs:
      - item_id: fisherman_banquet
        quantity: 1
    effects:
      hp_restore: 45
      buff: "sea_strength"
      buff_duration_ticks: 3
      buff_description: "+2 STR, +1 DEX for 3 ticks"
    dependency_chain: "Fish →[COOK]→ Grilled Fish + Grain →[COOK]→ Flour →[COOK]→ Bread + Berries →[COOK]→ Jam →[COOK]→ Banquet"

  spiced_pastry:
    id: spiced_pastry
    name: Spiced Pastry
    description: "A delicate pastry layered with herbed honey and berry filling. A luxury trade good."
    category: TRADE_GOOD
    base_value: 40
    tier: 3
    level_required: 7
    profession: COOK
    xp_reward: 25
    inputs:
      - item_id: flour
        quantity: 2
      - item_id: wild_herbs
        quantity: 2
      - item_id: berry_jam
        quantity: 1
      - item_id: wood_logs
        quantity: 1
    outputs:
      - item_id: spiced_pastry
        quantity: 1
    effects:
      hp_restore: 20
    notes: "High sell value, moderate HP. Designed as a trade good — COOKs make these to sell, not eat."
    dependency_chain: "Grain →[COOK]→ Flour + Herbs + Berries →[COOK]→ Jam →[COOK]→ Spiced Pastry"

  # --- LIVESTOCK RECIPES (RANCHER → COOK) --- ADDED 2026-02-17

  scrambled_eggs:
    id: cook-scrambled-eggs
    name: Scrambled Eggs
    description: "Fluffy scrambled eggs. Simple, nutritious farm food."
    category: FOOD
    base_value: 12
    tier: 1
    level_required: 3
    profession: COOK
    xp_reward: 10
    inputs:
      - item_id: eggs
        quantity: 3
    outputs:
      - item_id: scrambled_eggs
        quantity: 2
    effects:
      hp_regen: 3
    dependency_chain: "Chicken →[RANCHER auto]→ Eggs →[COOK]→ Scrambled Eggs"

  creamy_porridge:
    id: cook-creamy-porridge
    name: Creamy Porridge
    description: "Rich porridge made with fresh milk. Hearty and warming."
    category: FOOD
    base_value: 15
    tier: 1
    level_required: 3
    profession: COOK
    xp_reward: 12
    inputs:
      - item_id: grain
        quantity: 2
      - item_id: milk
        quantity: 1
    outputs:
      - item_id: creamy_porridge
        quantity: 2
    effects:
      hp_regen: 2
      buff: "constitution"
      buff_value: 1
    dependency_chain: "FARMER →[gather]→ Grain + Cow →[RANCHER auto]→ Milk →[COOK]→ Creamy Porridge"

  farm_breakfast:
    id: cook-farm-breakfast
    name: Farm Breakfast
    description: "A hearty farmer's breakfast — eggs, porridge, and fresh milk."
    category: FOOD
    base_value: 25
    tier: 2
    level_required: 5
    profession: COOK
    xp_reward: 18
    inputs:
      - item_id: eggs
        quantity: 2
      - item_id: milk
        quantity: 1
      - item_id: grain
        quantity: 1
    outputs:
      - item_id: farm_breakfast
        quantity: 2
    effects:
      hp_regen: 3
      buff: "all_stats"
      buff_value: 1
    dependency_chain: "Chicken →[RANCHER auto]→ Eggs + Cow →[RANCHER auto]→ Milk + FARMER →[gather]→ Grain →[COOK]→ Farm Breakfast"


# =============================================================================
# SECTION 5: DEPENDENCY CHAINS (QUICK REFERENCE)
# =============================================================================
# Read these bottom-to-top: raw resource → ... → final product
# Arrow labels show which profession does the transformation.
# =============================================================================

dependency_chains:

  # --- FOOD CHAIN (FARMER + FISHERMAN + HERBALIST + LUMBERJACK → COOK) ---
  # NOTE: All COOK recipes require 1× Wood Logs as fuel (LUMBERJACK dependency)
  basic_food:
    Apple + Wood Logs ──[COOK]──→ Apple Sauce
    Grain + Wood Logs ──[COOK]──→ Porridge
    Grain + Wood Logs ──[COOK]──→ Flour (intermediate)
    Wild Berries + Wood Logs ──[COOK]──→ Berry Jam (intermediate)
    Raw Fish + Wood Logs ──[COOK]──→ Grilled Fish
    Wild Herbs + Wood Logs ──[COOK]──→ Herbal Tea
    Vegetables + Wood Logs ──[COOK]──→ Vegetable Stew

  livestock_food:
    Eggs ──[COOK]──→ Scrambled Eggs
    Grain + Milk ──[COOK]──→ Creamy Porridge
    Eggs + Milk + Grain ──[COOK]──→ Farm Breakfast

  advanced_food:
    Flour + Wood Logs ──[COOK]──→ Bread Loaf
    Flour + Apple + Wood Logs ──[COOK]──→ Apple Pie
    Fish + Herbs + Wood Logs ──[COOK]──→ Fish Stew
    Vegetables + Herbs + Wood Logs ──[COOK]──→ Seasoned Roast Vegetables
    Flour + Berry Jam + Wood Logs ──[COOK]──→ Berry Tart

  premium_food:
    Bread + Apple + Herbs + Wood Logs ──[COOK]──→ Harvest Feast
    Grilled Fish + Bread + Berry Jam + Wood Logs ──[COOK]──→ Fisherman's Banquet
    Flour + Herbs + Berry Jam + Wood Logs ──[COOK]──→ Spiced Pastry

  # --- FUEL CHAIN (LUMBERJACK → COOK) ---
  fuel:
    Wood Logs ──[universal fuel]──→ All 15 COOK recipes require 1× Wood Logs
    note: "COOKs in non-forest towns must trade for wood. Creates LUMBERJACK→COOK dependency."

  # --- METAL CHAIN (MINER → SMELTER → BLACKSMITH/ARMORER) ---
  metal_weapons:
    Iron Ore ──[SMELTER]──→ Iron Ingot ──[BLACKSMITH]──→ Iron Sword / Axe / Tools
  metal_armor:
    Iron Ore ──[SMELTER]──→ Iron Ingot ──[ARMORER]──→ Chain Mail / Shield
    Raw Hide ──[TANNER]──→ Leather ──[ARMORER]──→ Reinforced Armor (ingot + leather)

  # --- LEATHER CHAIN (RANCHER/HUNTER → TANNER → LEATHERWORKER/ARMORER) ---
  leather_goods:
    Raw Hide ──[TANNER]──→ Leather ──[LEATHERWORKER]──→ Leather Armor / Bags / Belts

  # --- WOOD CHAIN (LUMBERJACK → WOODWORKER → FLETCHER) ---
  wood_goods:
    Wood Logs ──[WOODWORKER]──→ Planks / Handles ──[FLETCHER]──→ Bows / Arrows
    Wood Logs ──[WOODWORKER]──→ Furniture / Tools

  # --- MAGIC CHAIN (HERBALIST → ALCHEMIST → ENCHANTER) ---
  magic_items:
    Wild Herbs ──[ALCHEMIST]──→ Potions / Reagents ──[ENCHANTER]──→ Enchanted Items

  # --- TEXTILE CHAIN (RANCHER → TAILOR) ---
  clothing:
    Sheep ──[RANCHER auto]──→ Wool ──[TAILOR]──→ Cloth ──[TAILOR]──→ Robes / Clothing
    # Wool is now produced by RANCHER sheep. TAILOR recipes not yet implemented.

  # --- BUILDING CHAIN (MINER + LUMBERJACK → MASON) ---
  buildings:
    Stone Blocks + Wood Logs + Clay ──[MASON]──→ Building Materials → Housing System

  # --- KNOWLEDGE CHAIN (LUMBERJACK + HERBALIST → SCRIBE) ---
  scrolls:
    Wood Logs ──[SCRIBE]──→ Paper + Wild Herbs ──[SCRIBE]──→ Ink → Scrolls / Maps / Books


# =============================================================================
# SECTION 6: ECONOMY RULES
# =============================================================================

economy_rules:

  value_chain:
    principle: "Each profession step adds value"
    example: "Apple (3g) → Apple Sauce (8g) → Apple Pie (18g) → Harvest Feast (35g)"
    rule: "Crafted output base_value > sum of input base_values"

  rancher_economy:
    principle: "RANCHER is a gold-sink profession that generates passive items via livestock"
    chain: "FARMER →[gather]→ Grain →[RANCHER feed]→ Eggs/Milk/Wool →[COOK]→ meals"
    gold_sinks: "Buildings (100-150g), livestock (30-80g), ongoing Grain feed"
    grain_dependency: "RANCHERs must buy Grain from FARMERs or marketplace — creates cross-profession demand"
    risk: "Animals die from starvation, old age, disease, predator — ongoing investment needed"

  scarcity_by_region:
    principle: "Different towns produce different resources"
    rule: "No town has all resource types. Players must travel or trade."
    example: "Ironvault has mines but no orchards. Must buy food from Heartlands."
    wood_scarcity: "COOKs in non-forest towns (no forest gathering spot) must buy Wood Logs from LUMBERJACKs or the marketplace. Creates cross-profession trade pressure."

  profession_limit:
    max_per_character: 3
    principle: "No self-sufficiency"
    example: "FARMER + COOK + MERCHANT = gather crops, cook food, sell it well"
    counter: "But they can't mine, smelt, or smith — need other players for weapons"

  durability_and_consumption:
    principle: "Items break or are consumed, creating perpetual demand"
    food: "Consumed on use — gone forever"
    equipment: "Has durability — breaks after use, needs repair or replacement"
    potions: "Single use"
    buildings: "Require upkeep materials"

  quality_system:
    formula: "d20 + (ProfessionLevel / 5) + ToolBonus + WorkshopBonus + TierQualityBonus"
    tiers: [Poor, Common, Fine, Superior, Masterwork, Legendary]
    effect: "Higher quality = better stats/effects + higher sell value"
    tier_quality_bonus:
      APPRENTICE: 0
      JOURNEYMAN: 1
      CRAFTSMAN: 2
      EXPERT: 3
      MASTER: 4
      GRANDMASTER: 5
    note: "Applies to crafting. Gathering yield uses tier_yield_bonus instead."

  tier_yield_bonus:
    description: "Gathering professions get yield multiplier based on profession tier"
    APPRENTICE: "+0% (base yield)"
    JOURNEYMAN: "+25%"
    CRAFTSMAN: "+50%"
    EXPERT: "+75%"
    MASTER: "+100%"
    GRANDMASTER: "+150%"
    formula: "finalQuantity = ceil(baseQuantity * (1 + tierBonus))"
    note: "Only applies to unlocked spot types. Replaces old flat +50% bonus."

  # UPDATED: 2026-02-16 — Market buying fix
  simulation_market:
    mode: "Auction-based (buy orders → auction resolution each tick)"
    one_pass_cycle:
      step_1: "All bots list surplus items (free action, items exceeding keepItems threshold)"
      step_2: "All bots attempt one buy for missing crafting ingredients (free action)"
      auction_resolution: "Phase 4 of tick resolves buy orders — winner gets item, loser refunded"
    keepItems_logic: "Only keep items needed for THIS BOT's own profession recipes (not all recipes)"
    buy_search: "Global market search (no town filter) — any bot can buy any listing"
    pricing: "Sellers list at 15g flat. Buyers bid at asking + 15% (17g). Fee: 1g per transaction."


# =============================================================================
# SECTION 7: IMPLEMENTATION PRIORITY
# =============================================================================

implementation_order:

  # UPDATED: 2026-02-15
  phase_1:
    name: "FARMER + COOK (Food Chain)"
    status: COMPLETE
    completed_date: 2026-02-15
    tasks:
      - "✓ Add grain_field and vegetable_patch gathering spots (3 grain, 2 vegetable towns)"
      - "✓ Define all COOK recipe items in item registry (17 items)"
      - "✓ Seed 15 COOK recipes in database (7 T1 + 5 T2 + 3 T3)"
      - "✓ FARMER yield bonus: +50% at orchard, berry, grain_field, vegetable_patch"
      - "✓ Daily tick reorder: crafting before auto-consumption"
      - "✓ Update sim bots: COOK craft-first, FARMER gather-only"
      - "✓ Verified in 40-tick simulation (25 bots, 1000 actions, 0 errors)"
    notes: "COOK bot Henrik crafted Grilled Fish at ticks 20, 34, 37. All 4 COOKs properly prioritize crafting."

  # UPDATED: 2026-02-16
  simulation_intelligence_rewrite:
    name: "Simulation Intelligence Rewrite"
    status: COMPLETE
    completed_date: 2026-02-16
    description: "Full rewrite of bot decision engine with priority-based intelligence"
    verification_run:
      config: "25 bots, diverse L1-L7 start, 200g starting gold, 50 ticks"
      total_actions: 1250
      errors: 0
      success_rate: "100%"
      action_breakdown:
        gather: "79.4%"
        travel: "4.7%"
        travel_in_transit: "7.2%"
        craft: "1.0%"
        profession: "1.9%"
      true_idle_rate: "0% (all 'idle' entries were bots in transit, categorized correctly after fix)"
      profession_distribution:
        FARMER: 11
        COOK: 5
        MINER: 2
        FISHERMAN: 2
        LUMBERJACK: 2
        HUNTER: 1
        RANCHER: 1
        HERBALIST: 1
      cook_performance: "13 successful crafts, travel purposefully to ingredient/wood towns"
      avg_level_after_50_ticks: 8.2
      total_gold: "5013 across 25 bots (70g earned, 57g spent)"
      decision_logging: "Priority-based decisions logged with P-numbers and reason strings"
    tasks:
      - "✓ Rewrote bot decision engine with priority-based intelligence"
      - "✓ All 25 bots learned professions (11 FARMER, 5 COOK, 2 MINER, 2 FISHERMAN, 2 LUMBERJACK, 1 HUNTER, 1 RANCHER, 1 HERBALIST)"
      - "✓ COOK bots travel purposefully to ingredient/wood towns, 13 successful crafts"
      - "✓ True idle rate 0% — all bots active or correctly categorized as in-transit"
      - "✓ Verified in 50-tick simulation (25 bots, 1250 actions, 0 errors, 100% success rate)"

  # UPDATED: 2026-02-16
  round_2_bug_fixes:
    name: "Simulation Bug Fixes Round 2"
    status: COMPLETE
    completed_date: 2026-02-16
    description: "Fixed 8 bugs (6 original + 2 discovered during verification) affecting market, travel, assets, profession XP, and economy"
    bugs_fixed:
      - "Bug 1: Baked Apples orphan recipe — deleted orphan DB recipe that referenced non-existent item template"
      - "Bug 2: Dead market — fixed wrong inventory endpoint (/items/inventory → /characters/me/inventory) in 5 places"
      - "Bug 3: Eliminated travel — fixed missing explore/seek-ingredients travel reasons in engine"
      - "Bug 4: Failed asset purchases — fixed profession level check and asset availability query"
      - "Bug 5: Missing profession bonuses — fixed GATHER_SPOT_PROFESSION_MAP missing entries"
      - "Bug 6: Frozen economy — auction engine timing bypass for simulation mode"
      - "Bug 7: Wrong inventory endpoint — all 5 sim action inventory calls hit non-existent route (discovered during verification)"
      - "Bug 8: No profession XP in spot-based gathering — processGatherSpotAction never called addProfessionXP (discovered during verification)"
    verification_run:
      config: "50 bots, diverse L1-L7 start, 200g starting gold, 60 ticks"
      total_actions: 3000
      errors: 0
      success_rate: "100%"
      action_breakdown:
        gather: 2400
        travel: 455
        craft: 55
        market_list: 1489
        market_buy: 0
        road_encounter: 33
        profession: 50
        buy_asset: 19
      crafting_verification:
        total_crafts: 55
        recipes_used: [Porridge, "Berry Jam", "Grill Fish"]
        baked_apples: 0
        orphan_recipes: 0
        note: "All crafts use canonical recipes only — Baked Apples confirmed eliminated"
      market_verification:
        listings: 1489
        buys: 0
        note: "Market infrastructure works. Zero buys due to keepItems bug (fixed in market_buy_fix phase)."
      travel_verification:
        total_travels: 455
        bots_multi_town: 22
        road_encounters: 33
        exploring_reason: 0
        note: "All travel is purposeful (ingredient sourcing, field management, profession-based)"
      asset_verification:
        total_purchases: 19
        by_profession: { FARMER: 8, MINER: 5, HERBALIST: 3, LUMBERJACK: 1, FISHERMAN: 1, OTHER: 1 }
        note: "Profession XP fix enabled bots to reach L3 threshold for T1 assets"
      profession_bonus_verification:
        FARMER: 423
        MINER: 246
        HERBALIST: 200
        LUMBERJACK: 53
        FISHERMAN: 51
        note: "All gathering professions receive bonus yield at matching spots"
      economy_verification:
        starting_gold: 10000
        current_gold: 8594
        gold_earned: 609
        gold_spent: 2015
        note: "Gold is circulating — earned from market sales, spent on assets and market purchases"
      level_distribution:
        average: 9.66
        range: "6-13"
        breakdown: { L6: 3, L7: 5, L8: 7, L9: 9, L10: 8, L11: 7, L12: 7, L13: 4 }
      profession_distribution:
        COOK: 12
        FARMER: 11
        HERBALIST: 7
        MINER: 7
        HUNTER: 5
        RANCHER: 3
        FISHERMAN: 3
        LUMBERJACK: 2
    tasks:
      - "✓ Deleted Baked Apples orphan recipe from database seed"
      - "✓ Fixed inventory endpoint in 5 sim action functions"
      - "✓ Fixed travel reason engine for explore/ingredient-seeking"
      - "✓ Fixed asset purchase profession level checks"
      - "✓ Fixed GATHER_SPOT_PROFESSION_MAP completeness"
      - "✓ Fixed auction engine sim-mode timing bypass"
      - "✓ Added profession XP grant to processGatherSpotAction in daily-tick.ts"
      - "✓ Verified 60-tick simulation: 50 bots, 3000 actions, 0 errors"

  # UPDATED: 2026-02-16
  market_buy_fix:
    name: "Market Buy Fix (Zero Purchases → Full Economic Loop)"
    status: COMPLETE
    completed_date: 2026-02-16
    description: "Fixed 7 root causes preventing bot market purchases. Unlocked full economic loop: gather → list → buy → craft → sell."
    bugs_fixed:
      - "Root Cause 1: buySpecificItem used HTTP API (local, town-scoped) — rewrote to direct Prisma DB query (global market)"
      - "Root Cause 2: resolveAllTownAuctions pre-filtered auction cycles by age in sim mode — fixed to check getSimulationTick()"
      - "Root Cause 3: Field name mismatch (inputs vs ingredients) in recipe parsing — fixed in actions.ts and engine.ts"
      - "Root Cause 4: No profession filter — /crafting/recipes returns ALL 161 recipes, COOK bot tried to buy SMELTER ingredients"
      - "Root Cause 5: Only tried missing[0] — changed to iterate ALL missing items with raw material priority"
      - "Root Cause 6: keepItems too broad — built from ALL profession recipes, blocking ALL raw materials from listings"
      - "Root Cause 7: Cleanup FK constraint — reordered deletion (BuyOrders → TradeTransactions → MarketListings → Items)"
    verification_run:
      config: "25 bots, L1 start, 200g starting gold, 60 ticks"
      total_actions: 2042
      errors: 0
      success_rate: "97.7% (46 expected buy failures — no supply for some items)"
      action_breakdown:
        gather: 1017
        market_list: 453
        market_buy: "90 (44 successful, 46 no-supply)"
        market_auction: 16
        craft: 72
        travel: 373
        travel_arrived: 126
        road_encounter: 34
        profession: 25
      market_verification:
        listings: 453
        buy_attempts: 90
        buy_success: 44
        auction_resolutions: 16
        unique_items_listed: 9
        items_listed: [Apples, Vegetables, Grain, "Wood Logs", "Wild Herbs", "Iron Ore Chunks", "Stone Blocks", Clay, "Wild Berries"]
        items_bought: [Apples, Vegetables, "Wild Herbs"]
        gold_earned_by_sellers: 579
        gold_spent_total: 1551
      crafting_verification:
        total_crafts: 72
        cooks_crafting: 2
        recipes_used: ["Apple Sauce", "Vegetable Stew", "Grill Fish"]
      economic_loop_traced: "FARMER gathers Apples → lists on market → COOK buys → crafts Apple Sauce. Gold flows between bots."
      level_distribution:
        range: "L3-L9"
        breakdown: { L3: 1, L4: 1, L5: 2, L6: 8, L7: 3, L8: 2, L9: 8 }
      gold_distribution:
        range: "12g-277g"
        average: 162
        total: 4056
      profession_distribution:
        FARMER: 9
        COOK: 2
        HERBALIST: 4
        MINER: 2
        LUMBERJACK: 4
        FISHERMAN: 2
        RANCHER: 2
    tasks:
      - "✓ Rewrote buySpecificItem to use direct Prisma DB query (global market search)"
      - "✓ Fixed auction resolution timing for simulation mode"
      - "✓ Fixed recipe field name mismatch (inputs/ingredients)"
      - "✓ Added profession filter to buy logic (only buy ingredients for own recipes)"
      - "✓ Iterate all missing ingredients, not just first"
      - "✓ Scoped keepItems to bot's own profession recipes (ROOT CAUSE)"
      - "✓ Fixed cleanup FK constraint ordering"
      - "✓ Added stopRequested flag to runTicks for graceful stop"
      - "✓ Verified 60-tick simulation: 25 bots, 2042 actions, full economic loop working"

  # UPDATED: 2026-02-16 (tiers), 2026-02-17 (gathering spot redesign)
  universal_tier_system:
    name: "Universal Profession Tier System + All Gathering Professions"
    status: COMPLETE
    completed_date: 2026-02-17
    description: "Tier-scaled yield system. All 7 gathering professions formalized. grain_field/vegetable_patch/berry removed as public spots. hunting_ground added."
    changes:
      - "Profession tiers: APPRENTICE [3-4], JOURNEYMAN [5-6], CRAFTSMAN [7-8], EXPERT [9-10], MASTER [11-12], GRANDMASTER [13+]"
      - "Tier yield bonuses: +0%, +25%, +50%, +75%, +100%, +150%"
      - "Tier quality bonuses: +0, +1, +2, +3, +4, +5"
      - "FARMER: APPRENTICE=orchard only, private fields for Grain/Vegetables/Berries"
      - "HUNTER: APPRENTICE=hunting_ground (LIVE — no longer NOT_YET_IMPLEMENTED)"
      - "RANCHER: APPRENTICE + JOURNEYMAN LIVE (buildings, livestock, feed/produce in daily tick)"
      - "MINER/LUMBERJACK/HERBALIST/FISHERMAN: APPRENTICE live, higher tiers NOT_YET_IMPLEMENTED"
      - "9 towns reassigned: 4→orchard, 1→fishing, 4→hunting_ground"
      - "Asset tiers: T1=L3 (Apprentice), T2=L7 (Craftsman), T3=L11 (Master)"
      - "Simulation bots tier-aware: getProfSpotTypes uses getUnlockedSpotTypes()"
      - "Codex shows tier level ranges, yield bonus %, Coming Soon badges"
    files_modified:
      - "shared/src/data/professions/tiers.ts — level ranges updated"
      - "shared/src/data/professions/xp-curve.ts — getTierForLevel() updated"
      - "shared/src/data/professions/tier-unlocks.ts — NEW: unlock tables + helpers"
      - "shared/src/data/professions/gathering.ts — FARMER tierUnlocks updated"
      - "shared/src/data/professions/index.ts — new exports"
      - "shared/src/data/assets.ts — T2=L7, T3=L11, FIELD_TIER_CROPS"
      - "server/src/jobs/daily-tick.ts — universal tier bonus via getGatheringBonus()"
      - "server/src/lib/simulation/engine.ts — tier-aware getProfSpotTypes()"
      - "server/src/lib/simulation/actions.ts — professionLevels populated"
      - "server/src/lib/simulation/types.ts — professionLevels added to BotState"
      - "client/src/components/codex/CodexProfessions.tsx — tier display enhanced"
    verification_run:
      config: "20 bots, diverse L1-L7 start, 200g starting gold, 47 ticks"
      total_actions: 1380
      gathering_success_rate: "100% (434/434 gather actions)"
      farmer_tier_gating: "FARMER P4 at orchards, MINER P4 at quarry/clay, COOK P4 at fishing (for ingredients)"
      profession_travel: "HUNTER bots correctly seek hunting_ground towns, FARMER bots seek orchards"
      old_spots_eliminated: "0 references to grain_field/vegetable_patch/berry as public spots"
      other_professions: "MINER, HERBALIST, FISHERMAN, LUMBERJACK — all correct"
      errors: "0 gathering errors across 1332 actions"
    verification_ca52:
      config: "50 bots, diverse L1 start, 0g starting gold, 17+ ticks"
      total_actions: 1332
      gathering_success_rate: "100% (760/760 gather actions)"
      hunting_ground: "12 Wild Game Meat gathers at Alehearth Mountain Game Trails"
      professions_learned: "FARMER, MINER, FISHERMAN, HERBALIST, LUMBERJACK, COOK, RANCHER, HUNTER — all 8 seen"
      p4_examples: "FARMER→orchard, MINER→quarry/clay, COOK→fishing (ingredient-driven)"
      old_spots: "0 references to removed public spots"
      errors: "0 errors across all 1332 actions"

  phase_2:
    name: "MINER → SMELTER → BLACKSMITH (Metal Chain)"
    status: PLANNED
    tasks:
      - "Define Iron Ingot intermediate item"
      - "Create SMELTER recipes (ore → ingot)"
      - "Create BLACKSMITH recipes (ingot → weapons/tools)"
      - "Weapons need: damage stats, durability, equipment slot"
      - "Requires: equipment system, combat integration"

  rancher_livestock:
    name: "RANCHER Livestock System"
    status: COMPLETE
    completed_date: 2026-02-17
    description: "Full RANCHER livestock system — buildings, animals, feed/produce cycle, death mechanics, 3 COOK recipes, simulation bot support"
    changes:
      - "3 RANCHER buildings: Chicken Coop (100g, cap 5), Dairy Barn (150g, cap 3), Sheep Pen (120g, cap 4)"
      - "3 livestock types: chicken (30g, Eggs), cow (80g, Milk), sheep (50g, Wool)"
      - "Livestock Prisma model — individual animals with age, hunger, health, death tracking"
      - "Daily tick Step 4d: auto feed (Grain), auto produce (Eggs/Milk/Wool), random events, death"
      - "3 new COOK recipes: Scrambled Eggs (L3), Creamy Porridge (L3), Farm Breakfast (L5)"
      - "5 new items: Eggs, Milk, Scrambled Eggs, Creamy Porridge, Farm Breakfast"
      - "RANCHER bots in sim: buy buildings, buy livestock, buy Grain feed"
      - "RANCHER APPRENTICE + JOURNEYMAN tiers activated"
    files_modified:
      - "shared/src/data/items/item-names.ts — 5 new items"
      - "shared/src/data/assets.ts — RANCHER buildings, LIVESTOCK_DEFINITIONS, HUNGER_CONSTANTS"
      - "shared/src/data/professions/tier-unlocks.ts — APPRENTICE/JOURNEYMAN activated"
      - "shared/src/data/professions/gathering.ts — RANCHER tierUnlocks display"
      - "shared/src/data/gathering.ts — EGGS/MILK/WOOL items, RESOURCE_MAP, PROFESSION_MAP"
      - "shared/src/data/recipes/consumables.ts — 3 COOK recipes"
      - "database/prisma/schema.prisma — Livestock model"
      - "server/src/routes/rancher.ts — NEW: buy-livestock, buildings, livestock detail"
      - "server/src/routes/assets.ts — RANCHER buy overrides, harvest guard"
      - "server/src/jobs/daily-tick.ts — Step 4d livestock processing"
      - "server/src/lib/simulation/engine.ts — RANCHER bot actions"
      - "server/src/lib/simulation/actions.ts — buyLivestock, harvestAsset guard"
      - "client/src/components/codex/CodexWorld.tsx — RESOURCE_TYPE_LABELS"
    gold_sinks:
      building_purchase: "100-150g per building (3 slots)"
      livestock_purchase: "30-80g per animal"
      grain_feed: "Ongoing — 1-2 Grain per animal every 3 ticks"
      total_setup: "~400-600g for full 3-building RANCHER setup"

  phase_3:
    name: "RANCHER → TANNER → LEATHERWORKER (Leather Chain)"
    status: PLANNED
    tasks:
      - "Raw Hide production from RANCHER (extend livestock or add butcher mechanic)"
      - "Create TANNER recipes (hide → leather)"
      - "Create LEATHERWORKER recipes (leather → armor/bags)"
      - "Requires: armor stats, equipment system"

  phase_4:
    name: "HERBALIST → ALCHEMIST (Potion Chain)"
    status: PLANNED
    tasks:
      - "Create ALCHEMIST recipes (herbs → potions)"
      - "Potions: HP restore, buffs, combat utility"
      - "Requires: consumable item usage system, buff system"

  phase_5:
    name: "Remaining Crafting Professions"
    status: PLANNED
    professions: [BREWER, WOODWORKER, FLETCHER, TAILOR, MASON, SCRIBE, ENCHANTER, JEWELER, ARMORER]

  phase_6:
    name: "Service Professions"
    status: PLANNED
    professions: [INNKEEPER, HEALER, STABLE_MASTER, BANKER, COURIER]
    notes: "Service profs interact with other systems (housing, travel, banking) — build after those systems exist"


# =============================================================================
# SECTION 8: PRIVATE ASSET OWNERSHIP
# UPDATED: 2026-02-15
# =============================================================================
# Gathering professions can buy private production assets that produce
# higher yields than public spots. Growth cycle, worker hiring, gold sinks.
# =============================================================================

asset_ownership:

  overview:
    status: EXISTS_IN_GAME
    description: "Private fields, mines, and timber plots that gathering professions purchase and manage"
    coexists_with: "Public gathering spots (both systems active)"

  pricing:
    formula: "baseCost * slotNumber"
    max_slots_per_tier: 3
    tiers:
      T1: { level_required: 3, label: "Apprentice", base_cost: 100, growth_ticks: 3, yield: "3-5" }
      T2: { level_required: 7, label: "Craftsman", base_cost: 200, growth_ticks: 5, yield: "5-8" }
      T3: { level_required: 11, label: "Master", base_cost: 300, growth_ticks: 8, yield: "8-12" }
    notes: "UPDATED 2026-02-16 — T2 raised from L5→L7 (Craftsman), T3 raised from L7→L11 (Master)"

  growth_cycle:
    states: [EMPTY, GROWING, READY, WITHERED]
    planting: "FREE — no daily action cost"
    harvesting: "Costs 1 daily action"
    wither_window: "3 ticks after READY"
    items_go_to: "OWNER (even if worker harvests)"

  worker_system:
    job_posting: "Owner posts listing with wage per harvest"
    job_acceptance: "Worker must be in same town"
    wage_transfer: "Owner pays worker on each harvest"
    worker_action: "Worker spends their daily action, owner spends nothing"

  profession_assets:
    FARMER: [grain_field, vegetable_patch, apple_orchard, berry_field]
    MINER: [iron_mine_claim, quarry_claim, clay_pit_rights]
    LUMBERJACK: [timber_plot]
    FISHERMAN: [fishing_rights]
    HERBALIST: [herb_garden_plot]
    RANCHER: [chicken_coop, dairy_barn, sheep_pen]
    HUNTER: [hunting_ground_rights]

  residency_rules:
    purchase: "Must be RESIDENT (homeTownId) of the town"
    plant_harvest: "Must be PRESENT (currentTownId) in the town"

  # UPDATED: 2026-02-17 — RANCHER livestock subsystem
  rancher_livestock:
    overview: "RANCHER buildings permanently READY (no plant/harvest cycle). Livestock are separate entities."
    building_types:
      chicken_coop: { baseCost: 100, levelRequired: 3, capacity: 5, animal: chicken }
      dairy_barn: { baseCost: 150, levelRequired: 3, capacity: 3, animal: cow }
      sheep_pen: { baseCost: 120, levelRequired: 5, capacity: 4, animal: sheep }
    lifecycle:
      buy_building: "POST /api/assets/buy (sets cropState=READY permanently)"
      buy_animal: "POST /api/rancher/buy-livestock (NPC vendor, fixed price)"
      feed: "Auto in daily tick Step 4d (consumes Grain from owner's inventory)"
      produce: "Auto in daily tick Step 4d (creates product items in owner's inventory)"
      death: "Auto in daily tick (starvation, old_age, disease, predator)"
    daily_tick_step: "4d (after Step 4c asset growth, before Step 5)"

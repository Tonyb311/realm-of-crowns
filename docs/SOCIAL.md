# Social Systems

> Auto-generated from implementation code. Last updated: 2026-02-08.

## Overview

Realm of Crowns includes a full suite of social features: **guilds**, **multi-channel messaging**, **friends lists**, and **notifications**. All social interactions support real-time updates via Socket.io.

---

## Guilds

**Source:** `server/src/routes/guilds.ts`

### Creating a Guild

- Endpoint: `POST /guilds/create`
- **Cost**: 500 gold (deducted from character's balance).
- Creator automatically becomes the **Leader**.
- Guild name must be unique.

### Guild Ranks

| Rank | Permissions |
|------|-------------|
| `leader` | All permissions, transfer leadership, disband |
| `co-leader` | Same as officer + promote members |
| `officer` | Invite, kick (lower ranks only), update guild info |
| `member` | Basic access, donate, leave |

Rank hierarchy is enforced: an officer cannot kick another officer or higher.

### Guild Operations

| Method | Path | Description |
|--------|------|-------------|
| `POST` | `/guilds/create` | Create a guild (500g) |
| `GET` | `/guilds` | List/search guilds (paginated) |
| `GET` | `/guilds/:guildId` | Get guild details |
| `PUT` | `/guilds/:guildId` | Update guild info (officer+) |
| `DELETE` | `/guilds/:guildId` | Disband guild (leader only, returns treasury) |
| `POST` | `/guilds/:guildId/invite` | Invite a player (officer+) |
| `POST` | `/guilds/:guildId/join` | Join an open guild |
| `POST` | `/guilds/:guildId/kick/:memberId` | Kick a member (officer+, rank hierarchy enforced) |
| `POST` | `/guilds/:guildId/leave` | Leave the guild |
| `POST` | `/guilds/:guildId/promote` | Promote a member (leader only) |
| `POST` | `/guilds/:guildId/donate` | Donate gold to guild treasury |
| `GET` | `/guilds/:guildId/quests` | Guild quests (placeholder) |
| `POST` | `/guilds/:guildId/transfer` | Transfer leadership to another member |

### Disband Behavior

When a guild is disbanded:
- Only the **leader** can disband.
- All remaining **treasury gold** is returned to the leader's character.
- All members are removed.

---

## Messaging

**Source:** `server/src/routes/messages.ts`

### Channel Types

| Channel | Scope | Validation |
|---------|-------|------------|
| `GLOBAL` | All players server-wide | None |
| `TOWN` | All players in the same town | Must be in a town |
| `GUILD` | Guild members only | Must be in a guild |
| `PARTY` | Party members only | Must be in a party |
| `WHISPER` | Private, 1-to-1 | Must specify recipient |
| `TRADE` | Trade-focused channel | None |
| `SYSTEM` | System announcements | Server-generated only |

### Message Operations

| Method | Path | Description |
|--------|------|-------------|
| `POST` | `/messages/send` | Send a message (channel + content + optional recipientId for whispers) |
| `GET` | `/messages/inbox` | Get whisper history |
| `GET` | `/messages/conversation/:otherCharacterId` | Get conversation thread with specific player |
| `GET` | `/messages/channel/:channelType` | Get channel message history |
| `PUT` | `/messages/:messageId/read` | Mark a message as read |
| `DELETE` | `/messages/:messageId` | Delete your own message |

### Validation

- Each channel type has specific validation rules enforced server-side.
- For `WHISPER`, a valid `recipientId` is required.
- For `GUILD`, the sender must belong to a guild.
- For `TOWN`, the sender must currently be located in a town.

---

## Friends

**Source:** `server/src/routes/friends.ts`

### Friendship States

| Status | Description |
|--------|-------------|
| `PENDING` | Request sent, awaiting response |
| `ACCEPTED` | Mutual friendship established |
| `DECLINED` | Request was declined |
| `BLOCKED` | One player has blocked the other |

### Friend Operations

| Method | Path | Description |
|--------|------|-------------|
| `POST` | `/friends/request` | Send a friend request (triggers notification + Socket.io event) |
| `POST` | `/friends/accept/:requestId` | Accept a friend request |
| `POST` | `/friends/decline/:requestId` | Decline a friend request |
| `DELETE` | `/friends/:friendId` | Remove a friend |
| `GET` | `/friends` | List all friends (includes online status) |
| `GET` | `/friends/pending` | View pending requests (incoming + outgoing) |

### Online Status

- The friend list endpoint returns each friend's **online/offline status**.
- Status is tracked via Socket.io connection state.

---

## Notifications

**Source:** `server/src/routes/notifications.ts`

### Notification Types

Notifications are generated by various systems:
- Friend requests
- Guild invitations
- Quest completion alerts
- Combat results
- Election events
- System announcements

### Notification Operations

| Method | Path | Description |
|--------|------|-------------|
| `GET` | `/notifications` | List notifications (paginated, optional `unread` filter) |
| `PUT` | `/notifications/:id/read` | Mark a single notification as read |
| `PUT` | `/notifications/read-all` | Mark all notifications as read |
| `DELETE` | `/notifications/:id` | Delete a notification |

---

## Real-Time Events

All social systems emit Socket.io events for real-time client updates:
- **Friend requests** trigger an immediate notification to the target player.
- **Guild invites** notify the invited player.
- **Messages** are broadcast to the appropriate channel subscribers.
- **Combat results** are pushed to participants.

The client subscribes to relevant channels on connection and receives events without polling.
